import{n as ut}from"../vendor-crypto-browserify-NMg_40A5.js";/*! noble-ed25519 - MIT License (c) 2019 Paul Miller (paulmillr.com) */const b=BigInt(0),l=BigInt(1),_=BigInt(2),lt=BigInt(8),k=BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h=Object.freeze({a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),P:BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),l:k,n:k,h:BigInt(8),Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960")}),nt=BigInt("0x10000000000000000000000000000000000000000000000000000000000000000"),z=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");BigInt("6853475219497561581579357271197624642482790079785650197046958215289687604742");const yt=BigInt("25063068953384623474111414158702152701244531502492656460079210482610430750235"),wt=BigInt("54469307008909316920995813868745141605393597292927456921205312896311721017578"),ht=BigInt("1159843021668779879193775521855586647937357759715417654439879720876111806838"),dt=BigInt("40440834346308536858101042469323190826248399146238708352240133220865137265952");class u{constructor(t,n,r,i){this.x=t,this.y=n,this.z=r,this.t=i}static fromAffine(t){if(!(t instanceof g))throw new TypeError("ExtendedPoint#fromAffine: expected Point");return t.equals(g.ZERO)?u.ZERO:new u(t.x,t.y,l,s(t.x*t.y))}static toAffineBatch(t){const n=gt(t.map(r=>r.z));return t.map((r,i)=>r.toAffine(n[i]))}static normalizeZ(t){return this.toAffineBatch(t).map(this.fromAffine)}equals(t){$(t);const{x:n,y:r,z:i}=this,{x:o,y:c,z:f}=t,a=s(n*f),w=s(o*i),d=s(r*f),y=s(c*i);return a===w&&d===y}negate(){return new u(s(-this.x),this.y,this.z,s(-this.t))}double(){const{x:t,y:n,z:r}=this,{a:i}=h,o=s(t*t),c=s(n*n),f=s(_*s(r*r)),a=s(i*o),w=t+n,d=s(s(w*w)-o-c),y=a+c,p=y-f,B=a-c,E=s(d*p),m=s(y*B),A=s(d*B),x=s(p*y);return new u(E,m,x,A)}add(t){$(t);const{x:n,y:r,z:i,t:o}=this,{x:c,y:f,z:a,t:w}=t,d=s((r-n)*(f+c)),y=s((r+n)*(f-c)),p=s(y-d);if(p===b)return this.double();const B=s(i*_*w),E=s(o*_*a),m=E+B,A=y+d,x=E-B,T=s(m*p),ct=s(A*x),ft=s(m*x),at=s(p*A);return new u(T,ct,at,ft)}subtract(t){return this.add(t.negate())}precomputeWindow(t){const n=1+256/t,r=[];let i=this,o=i;for(let c=0;c<n;c++){o=i,r.push(o);for(let f=1;f<2**(t-1);f++)o=o.add(i),r.push(o);i=o.double()}return r}wNAF(t,n){!n&&this.equals(u.BASE)&&(n=g.BASE);const r=n&&n._WINDOW_SIZE||1;if(256%r)throw new Error("Point#wNAF: Invalid precomputation window, must be power of 2");let i=n&&P.get(n);i||(i=this.precomputeWindow(r),n&&r!==1&&(i=u.normalizeZ(i),P.set(n,i)));let o=u.ZERO,c=u.BASE;const f=1+256/r,a=2**(r-1),w=BigInt(2**r-1),d=2**r,y=BigInt(r);for(let p=0;p<f;p++){const B=p*a;let E=Number(t&w);t>>=y,E>a&&(E-=d,t+=l);const m=B,A=B+Math.abs(E)-1,x=p%2!==0,T=E<0;E===0?c=c.add(L(x,i[m])):o=o.add(L(T,i[A]))}return u.normalizeZ([o,c])[0]}multiply(t,n){return this.wNAF(G(t,h.l),n)}multiplyUnsafe(t){let n=G(t,h.l,!1);const r=u.BASE,i=u.ZERO;if(n===b)return i;if(this.equals(i)||n===l)return this;if(this.equals(r))return this.wNAF(n);let o=i,c=this;for(;n>b;)n&l&&(o=o.add(c)),c=c.double(),n>>=l;return o}isSmallOrder(){return this.multiplyUnsafe(h.h).equals(u.ZERO)}isTorsionFree(){let t=this.multiplyUnsafe(h.l/_).double();return h.l%_&&(t=t.add(this)),t.equals(u.ZERO)}toAffine(t){const{x:n,y:r,z:i}=this,o=this.equals(u.ZERO);t==null&&(t=o?lt:V(i));const c=s(n*t),f=s(r*t),a=s(i*t);if(o)return g.ZERO;if(a!==l)throw new Error("invZ was invalid");return new g(c,f)}fromRistrettoBytes(){F()}toRistrettoBytes(){F()}fromRistrettoHash(){F()}}u.BASE=new u(h.Gx,h.Gy,l,s(h.Gx*h.Gy));u.ZERO=new u(b,l,l,b);function L(e,t){const n=t.negate();return e?n:t}function $(e){if(!(e instanceof u))throw new TypeError("ExtendedPoint expected")}function X(e){if(!(e instanceof S))throw new TypeError("RistrettoPoint expected")}function F(){throw new Error("Legacy method: switch to RistrettoPoint")}class S{constructor(t){this.ep=t}static calcElligatorRistrettoMap(t){const{d:n}=h,r=s(z*t*t),i=s((r+l)*ht);let o=BigInt(-1);const c=s((o-n*r)*s(r+n));let{isValid:f,value:a}=K(i,c),w=s(a*t);U(w)||(w=s(-w)),f||(a=w),f||(o=r);const d=s(o*(r-l)*dt-c),y=a*a,p=s((a+a)*c),B=s(d*yt),E=s(l-y),m=s(l+y);return new u(s(p*m),s(E*B),s(B*m),s(p*E))}static hashToCurve(t){t=I(t,64);const n=Y(t.slice(0,32)),r=this.calcElligatorRistrettoMap(n),i=Y(t.slice(32,64)),o=this.calcElligatorRistrettoMap(i);return new S(r.add(o))}static fromHex(t){t=I(t,32);const{a:n,d:r}=h,i="RistrettoPoint.fromHex: the hex is not valid encoding of RistrettoPoint",o=Y(t);if(!bt(H(o),t)||U(o))throw new Error(i);const c=s(o*o),f=s(l+n*c),a=s(l-n*c),w=s(f*f),d=s(a*a),y=s(n*r*w-d),{isValid:p,value:B}=tt(s(y*d)),E=s(B*a),m=s(B*E*y);let A=s((o+o)*E);U(A)&&(A=s(-A));const x=s(f*m),T=s(A*x);if(!p||U(T)||x===b)throw new Error(i);return new S(new u(A,x,l,T))}toRawBytes(){let{x:t,y:n,z:r,t:i}=this.ep;const o=s(s(r+n)*s(r-n)),c=s(t*n),f=s(c*c),{value:a}=tt(s(o*f)),w=s(a*o),d=s(a*c),y=s(w*d*i);let p;if(U(i*y)){let E=s(n*z),m=s(t*z);t=E,n=m,p=s(w*wt)}else p=d;U(t*y)&&(n=s(-n));let B=s((r-n)*p);return U(B)&&(B=s(-B)),H(B)}toHex(){return D(this.toRawBytes())}toString(){return this.toHex()}equals(t){X(t);const n=this.ep,r=t.ep,i=s(n.x*r.y)===s(n.y*r.x),o=s(n.y*r.y)===s(n.x*r.x);return i||o}add(t){return X(t),new S(this.ep.add(t.ep))}subtract(t){return X(t),new S(this.ep.subtract(t.ep))}multiply(t){return new S(this.ep.multiply(t))}multiplyUnsafe(t){return new S(this.ep.multiplyUnsafe(t))}}S.BASE=new S(u.BASE);S.ZERO=new S(u.ZERO);const P=new WeakMap;class g{constructor(t,n){this.x=t,this.y=n}_setWindowSize(t){this._WINDOW_SIZE=t,P.delete(this)}static fromHex(t,n=!0){const{d:r,P:i}=h;t=I(t,32);const o=t.slice();o[31]=t[31]&-129;const c=W(o);if(n&&c>=i)throw new Error("Expected 0 < hex < P");if(!n&&c>=nt)throw new Error("Expected 0 < hex < 2**256");const f=s(c*c),a=s(f-l),w=s(r*f+l);let{isValid:d,value:y}=K(a,w);if(!d)throw new Error("Point.fromHex: invalid y coordinate");const p=(y&l)===l;return(t[31]&128)!==0!==p&&(y=s(-y)),new g(y,c)}static async fromPrivateKey(t){return(await j(t)).point}toRawBytes(){const t=H(this.y);return t[31]|=this.x&l?128:0,t}toHex(){return D(this.toRawBytes())}toX25519(){const{y:t}=this,n=s((l+t)*V(l-t));return H(n)}isTorsionFree(){return u.fromAffine(this).isTorsionFree()}equals(t){return this.x===t.x&&this.y===t.y}negate(){return new g(s(-this.x),this.y)}add(t){return u.fromAffine(this).add(u.fromAffine(t)).toAffine()}subtract(t){return this.add(t.negate())}multiply(t){return u.fromAffine(this).multiply(t,this).toAffine()}}g.BASE=new g(h.Gx,h.Gy);g.ZERO=new g(b,l);class N{constructor(t,n){this.r=t,this.s=n,this.assertValidity()}static fromHex(t){const n=I(t,64),r=g.fromHex(n.slice(0,32),!1),i=W(n.slice(32,64));return new N(r,i)}assertValidity(){const{r:t,s:n}=this;if(!(t instanceof g))throw new Error("Expected Point instance");return G(n,h.l,!1),this}toRawBytes(){const t=new Uint8Array(64);return t.set(this.r.toRawBytes()),t.set(H(this.s),32),t}toHex(){return D(this.toRawBytes())}}function J(...e){if(!e.every(r=>r instanceof Uint8Array))throw new Error("Expected Uint8Array list");if(e.length===1)return e[0];const t=e.reduce((r,i)=>r+i.length,0),n=new Uint8Array(t);for(let r=0,i=0;r<e.length;r++){const o=e[r];n.set(o,i),i+=o.length}return n}const pt=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function D(e){if(!(e instanceof Uint8Array))throw new Error("Uint8Array expected");let t="";for(let n=0;n<e.length;n++)t+=pt[e[n]];return t}function C(e){if(typeof e!="string")throw new TypeError("hexToBytes: expected string, got "+typeof e);if(e.length%2)throw new Error("hexToBytes: received invalid unpadded hex");const t=new Uint8Array(e.length/2);for(let n=0;n<t.length;n++){const r=n*2,i=e.slice(r,r+2),o=Number.parseInt(i,16);if(Number.isNaN(o)||o<0)throw new Error("Invalid byte sequence");t[n]=o}return t}function et(e){const n=e.toString(16).padStart(64,"0");return C(n)}function H(e){return et(e).reverse()}function U(e){return(s(e)&l)===l}function W(e){if(!(e instanceof Uint8Array))throw new Error("Expected Uint8Array");return BigInt("0x"+D(Uint8Array.from(e).reverse()))}const Bt=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff");function Y(e){return s(W(e)&Bt)}function s(e,t=h.P){const n=e%t;return n>=b?n:t+n}function V(e,t=h.P){if(e===b||t<=b)throw new Error(`invert: expected positive integers, got n=${e} mod=${t}`);let n=s(e,t),r=t,i=b,o=l;for(;n!==b;){const f=r/n,a=r%n,w=i-o*f;r=n,n=a,i=o,o=w}if(r!==l)throw new Error("invert: does not exist");return s(i,t)}function gt(e,t=h.P){const n=new Array(e.length),r=e.reduce((o,c,f)=>c===b?o:(n[f]=o,s(o*c,t)),l),i=V(r,t);return e.reduceRight((o,c,f)=>c===b?o:(n[f]=s(o*n[f],t),s(o*c,t)),i),n}function R(e,t){const{P:n}=h;let r=e;for(;t-- >b;)r*=r,r%=n;return r}function Et(e){const{P:t}=h,n=BigInt(5),r=BigInt(10),i=BigInt(20),o=BigInt(40),c=BigInt(80),a=e*e%t*e%t,w=R(a,_)*a%t,d=R(w,l)*e%t,y=R(d,n)*d%t,p=R(y,r)*y%t,B=R(p,i)*p%t,E=R(B,o)*B%t,m=R(E,c)*E%t,A=R(m,c)*E%t,x=R(A,r)*y%t;return{pow_p_5_8:R(x,_)*e%t,b2:a}}function K(e,t){const n=s(t*t*t),r=s(n*n*t),i=Et(e*r).pow_p_5_8;let o=s(e*n*i);const c=s(t*o*o),f=o,a=s(o*z),w=c===e,d=c===s(-e),y=c===s(-e*z);return w&&(o=f),(d||y)&&(o=a),U(o)&&(o=s(-o)),{isValid:w||d,value:o}}function tt(e){return K(l,e)}function O(e){return s(W(e),h.l)}function bt(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function I(e,t){const n=e instanceof Uint8Array?Uint8Array.from(e):C(e);if(typeof t=="number"&&n.length!==t)throw new Error(`Expected ${t} bytes`);return n}function G(e,t,n=!0){if(!t)throw new TypeError("Specify max value");if(typeof e=="number"&&Number.isSafeInteger(e)&&(e=BigInt(e)),typeof e=="bigint"&&e<t){if(n){if(b<e)return e}else if(b<=e)return e}throw new TypeError("Expected valid scalar: 0 < scalar < max")}function mt(e){return e[0]&=248,e[31]&=127,e[31]|=64,e}function st(e){if(e=typeof e=="bigint"||typeof e=="number"?et(G(e,nt)):I(e),e.length!==32)throw new Error("Expected 32 bytes");return e}function rt(e){const t=mt(e.slice(0,32)),n=e.slice(32,64),r=O(t),i=g.BASE.multiply(r),o=i.toRawBytes();return{head:t,prefix:n,scalar:r,point:i,pointBytes:o}}let q;function M(...e){if(typeof q!="function")throw new Error("utils.sha512Sync must be set to use sync methods");return q(...e)}async function j(e){return rt(await Z.sha512(st(e)))}function Q(e){return rt(M(st(e)))}function At(e){return Q(e).pointBytes}async function It(e,t){e=I(e);const{prefix:n,scalar:r,pointBytes:i}=await j(t),o=O(await Z.sha512(n,e)),c=g.BASE.multiply(o),f=O(await Z.sha512(c.toRawBytes(),i,e)),a=s(o+f*r,h.l);return new N(c,a).toRawBytes()}function xt(e,t){e=I(e);const{prefix:n,scalar:r,pointBytes:i}=Q(t),o=O(M(n,e)),c=g.BASE.multiply(o),f=O(M(c.toRawBytes(),i,e)),a=s(o+f*r,h.l);return new N(c,a).toRawBytes()}function ot(e,t,n){t=I(t),n instanceof g||(n=g.fromHex(n,!1));const{r,s:i}=e instanceof N?e.assertValidity():N.fromHex(e),o=u.BASE.multiplyUnsafe(i);return{r,s:i,SB:o,pub:n,msg:t}}function it(e,t,n,r){const i=O(r),o=u.fromAffine(e).multiplyUnsafe(i);return u.fromAffine(t).add(o).subtract(n).multiplyUnsafe(h.h).equals(u.ZERO)}async function vt(e,t,n){const{r,SB:i,msg:o,pub:c}=ot(e,t,n),f=await Z.sha512(r.toRawBytes(),c.toRawBytes(),o);return it(c,r,i,f)}function St(e,t,n){const{r,SB:i,msg:o,pub:c}=ot(e,t,n),f=M(r.toRawBytes(),c.toRawBytes(),o);return it(c,r,i,f)}const Ut={getExtendedPublicKey:Q,getPublicKey:At,sign:xt,verify:St};g.BASE._setWindowSize(8);const v={node:ut,web:typeof self=="object"&&"crypto"in self?self.crypto:void 0},Z={bytesToHex:D,hexToBytes:C,concatBytes:J,getExtendedPublicKey:j,mod:s,invert:V,TORSION_SUBGROUP:["0100000000000000000000000000000000000000000000000000000000000000","c7176a703d4dd84fba3c0b760d10670f2a2053fa2c39ccc64ec7fd7792ac037a","0000000000000000000000000000000000000000000000000000000000000080","26e8958fc2b227b045c3f489f2ef98f0d5dfac05d3c63339b13802886d53fc05","ecffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff7f","26e8958fc2b227b045c3f489f2ef98f0d5dfac05d3c63339b13802886d53fc85","0000000000000000000000000000000000000000000000000000000000000000","c7176a703d4dd84fba3c0b760d10670f2a2053fa2c39ccc64ec7fd7792ac03fa"],hashToPrivateScalar:e=>{if(e=I(e),e.length<40||e.length>1024)throw new Error("Expected 40-1024 bytes of private key as per FIPS 186");return s(W(e),h.l-l)+l},randomBytes:(e=32)=>{if(v.web)return v.web.getRandomValues(new Uint8Array(e));if(v.node){const{randomBytes:t}=v.node;return new Uint8Array(t(e).buffer)}else throw new Error("The environment doesn't have randomBytes function")},randomPrivateKey:()=>Z.randomBytes(32),sha512:async(...e)=>{const t=J(...e);if(v.web){const n=await v.web.subtle.digest("SHA-512",t.buffer);return new Uint8Array(n)}else{if(v.node)return Uint8Array.from(v.node.createHash("sha512").update(t).digest());throw new Error("The environment doesn't have sha512 function")}},precompute(e=8,t=g.BASE){const n=t.equals(g.BASE)?t:new g(t.x,t.y);return n._setWindowSize(e),n.multiply(_),n},sha512Sync:void 0};Object.defineProperties(Z,{sha512Sync:{configurable:!1,get(){return q},set(e){q||(q=e)}}});export{It as a,Ut as s,vt as v};

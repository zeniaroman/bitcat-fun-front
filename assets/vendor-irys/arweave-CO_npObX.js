var Ar=Object.defineProperty;var Br=(b,i,n)=>i in b?Ar(b,i,{enumerable:!0,configurable:!0,writable:!0,value:n}):b[i]=n;var A=(b,i,n)=>Br(b,typeof i!="symbol"?i+"":i,n);import{B as Kt}from"../vendor-bignumber.js-Dj_rIxHg.js";import{b as fr}from"../vendor-base64-js-C2zTC7ec.js";import{b as zt}from"../vendor-buffer-DVXvU5G6.js";import{r as Rr}from"../vendor-async-retry-DWdC6xTk.js";import{a as Tr}from"../vendor-axios-Hz4xvOoZ.js";import{g as ur}from"../solana-vendors-DGPAp7Fj.js";import{r as qt}from"../vendor-inherits-BICa84dG.js";import{r as be}from"../vendor-safer-buffer-CIAg7E_-.js";import{r as Cr}from"../vendor-minimalistic-assert-OF9c2MWr.js";import{r as qr}from"../vendor-asn1.js-Cgb4HcA4.js";function Tt(b){let i=0;for(const y of b)i+=y.byteLength;const n=new Uint8Array(i);let a=0;n.set(new Uint8Array(b[0]),a),a+=b[0].byteLength;for(let y=1;y<b.length;y++)n.set(new Uint8Array(b[y]),a),a+=b[y].byteLength;return n}function lr(b){const i=kt(b);return ke(i)}function ke(b){return new TextDecoder("utf-8",{fatal:!0}).decode(b)}function _t(b){return new TextEncoder().encode(b)}function _e(b){return St(_t(b))}function kt(b){return new Uint8Array(fr.toByteArray(pr(b)))}function cr(b){return fr.fromByteArray(new Uint8Array(b))}function St(b){return dr(cr(b))}function dr(b){return b.replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,"")}function pr(b){b=b.replace(/\-/g,"+").replace(/\_/g,"/");let i;return b.length%4==0?i=0:i=4-b.length%4,b.concat("=".repeat(i))}function Dr(b){return new Kt(b).shiftedBy(-12)}function Ir(b){return new Kt(b).shiftedBy(12)}const Ur=Object.freeze(Object.defineProperty({__proto__:null,arToWinston:Ir,b64UrlDecode:pr,b64UrlEncode:dr,b64UrlToBuffer:kt,b64UrlToString:lr,bufferToString:ke,bufferTob64:cr,bufferTob64Url:St,concatBuffers:Tt,stringToB64Url:_e,stringToBuffer:_t,winstonToAr:Dr},Symbol.toStringTag,{value:"Module"}));class Nr{constructor(){A(this,"keyLength",4096);A(this,"publicExponent",65537);A(this,"hashAlgorithm","sha256");A(this,"driver");this.driver=crypto==null?void 0:crypto.subtle}async generateJWK(){const i=await this.driver.generateKey({name:"RSA-PSS",modulusLength:4096,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!0,["sign"]),n=await this.driver.exportKey("jwk",i.privateKey);return{kty:n.kty,e:n.e,n:n.n,d:n.d,p:n.p,q:n.q,dp:n.dp,dq:n.dq,qi:n.qi}}async sign(i,n,{saltLength:a}={saltLength:32}){const y=await this.driver.sign({name:"RSA-PSS",saltLength:a},await this.jwkToCryptoKey(i),n);return new Uint8Array(y)}async hash(i,n="SHA-256"){const a=await this.driver.digest(n,i);return new Uint8Array(a)}async verify(i,n,a){const y={kty:"RSA",e:"AQAB",n:i},s=await this.jwkToPublicCryptoKey(y),_=await this.driver.digest("SHA-256",n),x=await this.driver.verify({name:"RSA-PSS",saltLength:0},s,a,n),S=await this.driver.verify({name:"RSA-PSS",saltLength:32},s,a,n),v=await this.driver.verify({name:"RSA-PSS",saltLength:Math.ceil((s.algorithm.modulusLength-1)/8)-_.byteLength-2},s,a,n);return x||S||v}async jwkToCryptoKey(i){return this.driver.importKey("jwk",i,{name:"RSA-PSS",hash:{name:"SHA-256"}},!1,["sign"])}async jwkToPublicCryptoKey(i){return this.driver.importKey("jwk",i,{name:"RSA-PSS",hash:{name:"SHA-256"}},!1,["verify"])}async encrypt(i,n,a){const y=await this.driver.importKey("raw",typeof n=="string"?_t(n):n,{name:"PBKDF2",length:32},!1,["deriveKey"]),s=await this.driver.deriveKey({name:"PBKDF2",salt:_t(a||"salt"),iterations:1e5,hash:"SHA-256"},y,{name:"AES-CBC",length:256},!1,["encrypt","decrypt"]),_=new Uint8Array(16);crypto.getRandomValues(_);const x=await this.driver.encrypt({name:"AES-CBC",iv:_},s,i);return Tt([_,x])}async decrypt(i,n,a){const y=await this.driver.importKey("raw",typeof n=="string"?_t(n):n,{name:"PBKDF2",length:32},!1,["deriveKey"]),s=await this.driver.deriveKey({name:"PBKDF2",salt:_t(a||"salt"),iterations:1e5,hash:"SHA-256"},y,{name:"AES-CBC",length:256},!1,["encrypt","decrypt"]),_=i.slice(0,16),x=await this.driver.decrypt({name:"AES-CBC",iv:_},s,i.slice(16));return Tt([x])}}class Nt extends Error{constructor(n,a={}){var i=(...bi)=>(super(...bi),A(this,"type"),A(this,"response"),this);a.message?i(a.message):i(),this.type=n,this.response=a.response}getType(){return this.type}}function Ot(b){let i=b.data;if(typeof b.data=="string")try{i=JSON.parse(b.data)}catch{}if(b.data instanceof ArrayBuffer||b.data instanceof Uint8Array)try{i=JSON.parse(i.toString())}catch{}return i?i.error||i:b.statusText||"unknown"}class Or{constructor(i,n){A(this,"api");A(this,"network");this.api=i,this.network=n}async getByHash(i){const n=await this.api.get(`block/hash/${i}`);if(n.status===200)return n.data;throw n.status===404?new Nt("BLOCK_NOT_FOUND"):new Error(`Error while loading block data: ${n}`)}async getByHeight(i){const n=await this.api.get(`block/height/${i}`);if(n.status===200)return n.data;throw n.status===404?new Nt("BLOCK_NOT_FOUND"):new Error(`Error while loading block data: ${n}`)}async getCurrent(){const{current:i}=await this.network.getInfo();return await this.getByHash(i)}}const Rt=256*1024,Pr=32*1024,Ut=32,It=32;class Hr{constructor(i){A(this,"crypto");this.crypto=i.deps.crypto}async chunkData(i){const n=[];let a=i,y=0;for(;a.byteLength>=Rt;){let s=Rt;const _=a.byteLength-Rt;_>0&&_<Pr&&(s=Math.ceil(a.byteLength/2));const x=a.slice(0,s),S=await this.crypto.hash(x);y+=x.byteLength,n.push({dataHash:S,minByteRange:y-x.byteLength,maxByteRange:y}),a=a.slice(s)}return n.push({dataHash:await this.crypto.hash(a),minByteRange:y,maxByteRange:y+a.byteLength}),n}async generateLeaves(i){return Promise.all(i.map(async({dataHash:n,minByteRange:a,maxByteRange:y})=>({type:"leaf",id:await this.hash(await Promise.all([this.hash(n),this.hash(Lt(y))])),dataHash:n,minByteRange:a,maxByteRange:y})))}async computeRootHash(i){return(await this.generateTree(i)).id}async generateTree(i){return await this.buildLayers(await this.generateLeaves(await this.chunkData(i)))}async generateTransactionChunks(i){const n=await this.chunkData(i),a=await this.generateLeaves(n),y=await this.buildLayers(a),s=await this.generateProofs(y),_=n.slice(-1)[0];return _.maxByteRange-_.minByteRange===0&&(n.splice(n.length-1,1),s.splice(s.length-1,1)),{data_root:y.id,chunks:n,proofs:s}}async buildLayers(i,n=0){if(i.length<2)return i[0];const a=[];for(let y=0;y<i.length;y+=2)a.push(await this.hashBranch(i[y],i[y+1]));return this.buildLayers(a,n+1)}generateProofs(i){const n=this.resolveBranchProofs(i);return Array.isArray(n)?gr(n):[n]}resolveBranchProofs(i,n=new Uint8Array,a=0){if(i.type=="leaf")return{offset:i.maxByteRange-1,proof:Tt([n,i.dataHash,Lt(i.maxByteRange)])};if(i.type=="branch"){const y=Tt([n,i.leftChild.id,i.rightChild.id,Lt(i.byteRange)]);return[this.resolveBranchProofs(i.leftChild,y,a+1),this.resolveBranchProofs(i.rightChild,y,a+1)]}throw new Error("Unexpected node type")}async validatePath(i,n,a,y,s){if(y<=0)return!1;if(n>=y)return this.validatePath(i,0,y-1,y,s);if(n<0)return this.validatePath(i,0,0,y,s);if(s.length==It+Ut){const d=s.slice(0,It),M=s.slice(d.length,d.length+Ut),k=await this.hash([await this.hash(d),await this.hash(M)]);return Ze(i,k)?{offset:y-1,leftBound:a,rightBound:y,chunkSize:y-a}:!1}const _=s.slice(0,It),x=s.slice(_.length,_.length+It),S=s.slice(_.length+x.length,_.length+x.length+Ut),v=Fe(S),f=s.slice(_.length+x.length+S.length),g=await this.hash([await this.hash(_),await this.hash(x),await this.hash(S)]);return Ze(i,g)?n<v?await this.validatePath(_,n,a,Math.min(y,v),f):await this.validatePath(x,n,Math.max(a,v),y,f):!1}async hashBranch(i,n){return n?{type:"branch",id:await this.hash([await this.hash(i.id),await this.hash(n.id),await this.hash(Lt(i.maxByteRange))]),byteRange:i.maxByteRange,maxByteRange:n.maxByteRange,leftChild:i,rightChild:n}:i}async hash(i){return Array.isArray(i)&&(i=Se.utils.concatBuffers(i)),new Uint8Array(await this.crypto.hash(i))}async debug(i,n=""){if(i.byteLength<1)return n;const a=i.slice(0,It),y=i.slice(a.length,a.length+It),s=i.slice(a.length+y.length,a.length+y.length+Ut),_=Fe(s),x=i.slice(a.length+y.length+s.length),S=await this.hash([await this.hash(a),await this.hash(y),await this.hash(s)]),v=`${n}
${JSON.stringify(zt.Buffer.from(a))},${JSON.stringify(zt.Buffer.from(y))},${_} => ${JSON.stringify(S)}`;return this.debug(x,v)}}function gr(b){const i=[];return b.forEach(n=>{Array.isArray(n)?i.push(...gr(n)):i.push(n)}),i}function Lt(b){const i=new Uint8Array(Ut);for(let n=i.length-1;n>=0;n--){const a=b%256;i[n]=a,b=(b-a)/256}return i}function Fe(b){let i=0;for(let n=0;n<b.length;n++)i*=256,i+=b[n];return i}const Ze=(b,i)=>b.every((n,a)=>i[a]===n);class Lr{constructor(i){A(this,"api");this.api=i}async getTransactionMetadata(i){const n=await this.api.get(`tx/${i}/offset`);if(n.status===200)return n.data;throw new Error(`Unable to get transaction offset: ${Ot(n)}`)}async getChunk(i){const n=await this.api.get(`chunk/${i}`);if(n.status===200)return n.data;throw new Error(`Unable to get chunk: ${Ot(n)}`)}async getChunkData(i){const n=await this.getChunk(i);return kt(n.chunk)}firstChunkOffset(i){return parseInt(i.offset)-parseInt(i.size)+1}async downloadChunkedData(i,n){const a=await this.getTransactionMetadata(i),y=parseInt(a.size),s=new Uint8Array(y);let _=0;for await(const x of this.concurrentChunkDownloader(i,n))s.set(x,_),_+=x.length;return s}async*concurrentChunkDownloader(i,n){const a={concurrency:10,...n},y=await this.getTransactionMetadata(i),s=new Kt(y.offset),_=new Kt(y.size),x=s.minus(_).plus(1);let S=0;const v=Math.ceil(_.dividedBy(Rt).toNumber()),f=E=>this.getChunkData(E.toString()).then(C=>(S+=C.length,C)),g=[],d=v-2,M=Math.min(d,a.concurrency);let k=0;for(let E=0;E<M;E++)g.push(f(x.plus(Rt*k++)));for(;k<d;)g.push(f(x.plus(Rt*k++))),yield g.shift();for(;g.length>0;)yield g.shift();if(yield f(x.plus(Rt*k++)),_.isGreaterThan(S)&&(yield f(x.plus(Rt*k++))),!_.isEqualTo(S))throw new Error(`got ${S}B, expected ${_.toString()}B`)}}function $r(b,i){const n=b;return n.deepHash=new i.deepHash({deps:{utils:{stringToBuffer:_t,concatBuffers:Tt},crypto:b}}),n}class jr{constructor({deps:i}){A(this,"crypto");A(this,"utils");this.crypto=i.crypto,this.utils=i.utils}async deepHash(i){if(Array.isArray(i)){const y=this.utils.concatBuffers([this.utils.stringToBuffer("list"),this.utils.stringToBuffer(i.length.toString())]);return await this.deepHashChunks(i,await this.crypto.hash(y,"SHA-384"))}const n=this.utils.concatBuffers([this.utils.stringToBuffer("blob"),this.utils.stringToBuffer(i.byteLength.toString())]),a=this.utils.concatBuffers([await this.crypto.hash(n,"SHA-384"),await this.crypto.hash(i,"SHA-384")]);return await this.crypto.hash(a,"SHA-384")}async deepHashChunks(i,n){if(i.length<1)return n;const a=this.utils.concatBuffers([n,await this.deepHash(i[0])]),y=await this.crypto.hash(a,"SHA-384");return await this.deepHashChunks(i.slice(1),y)}}class Je{constructor(i){A(this,"_instance");A(this,"cookieMap",new Map);A(this,"config");i&&this.applyConfig(i)}applyConfig(i){this.config=this.mergeDefaults(i),this._instance=void 0}getConfig(){return this.config}async requestInterceptor(i){const n=this.cookieMap.get(new URL(i.baseURL??"").host);return n&&(i.headers.cookie=n),i}async responseInterceptor(i){var a;const n=(a=i.headers)==null?void 0:a["set-cookie"];return n&&this.cookieMap.set(i.request.host,n),i}mergeDefaults(i){return i.headers??(i.headers={}),i.network&&!Object.keys(i.headers).includes("x-network")&&(i.headers["x-network"]=i.network),{url:i.url,timeout:i.timeout??2e4,logging:i.logging??!1,logger:i.logger??console.log,headers:{...i.headers,"x-irys-arweave-version":Se.VERSION},withCredentials:i.withCredentials??!1,retry:{retries:3,maxTimeout:5e3}}}async get(i,n){var a;try{return await this.request(i,{...n,method:"GET"})}catch(y){if((a=y.response)!=null&&a.status)return y.response;throw y}}async post(i,n,a){var y;try{return await this.request(i,{data:n,...a,method:"POST"})}catch(s){if((y=s.response)!=null&&y.status)return s.response;throw s}}get instance(){if(this._instance)return this._instance;const i=Tr.create({baseURL:this.config.url.toString(),timeout:this.config.timeout,maxContentLength:1024*1024*512,headers:this.config.headers,withCredentials:this.config.withCredentials});return this.config.withCredentials&&(i.interceptors.request.use(this.requestInterceptor.bind(this)),i.interceptors.response.use(this.responseInterceptor.bind(this))),this.config.logging&&(i.interceptors.request.use(n=>(this.config.logger(`Requesting: ${n.baseURL}/${n.url}`),n)),i.interceptors.response.use(n=>(this.config.logger(`Response: ${n.config.url} - ${n.status}`),n))),this._instance=i}async request(i,n){const a=this.instance,y=(n==null?void 0:n.url)??new URL(i,this.config.url).toString();return Rr(s=>a({...n,url:y}),{...this.config.retry,...n==null?void 0:n.retry})}}const Ge=b=>typeof b!="string"&&"url"in b,Kr={maxAttempts:15,randomlySelect:!0};class zr{constructor({gateways:i,miners:n,opts:a}){A(this,"minerInstances",[]);A(this,"globalConfig");A(this,"gatewayInstances",[]);this.globalConfig=(a==null?void 0:a.globalConfig)??{},n&&this.addMiners(n),i&&this.addGateways(i)}async addPeersFrom(i,n){const a=(await this.get("",{url:new URL("/peers",i).toString()})).data;this.addMiners(a.slice(0,n==null?void 0:n.limit).map(y=>`http://${y}`))}addMiners(i){i.forEach(n=>this.minerInstances.push(new Je(Ge(n)?n:{url:new URL(n),...this.globalConfig})))}addGateways(i){i.forEach(n=>this.gatewayInstances.push(new Je(Ge(n)?n:{url:new URL(n),...this.globalConfig})))}async get(i,n){return this.request(i,{...n,method:"GET"})}async post(i,n,a){return this.request(i,{data:n,...a,method:"POST"})}async request(i,n){const a={...Kr,...n==null?void 0:n.fallback};let y=0;const s=n!=null&&n.gatewayOnly?this.gatewayInstances:this.gatewayInstances.concat(this.minerInstances),_=Math.min(Math.max(a==null?void 0:a.maxAttempts,1),s.length),x=a==null?void 0:a.onFallback;if(s.length===0)throw new Error("Unable to run request due to 0 configured gateways/miners.");for(;y++<_;){const S=s.at(a!=null&&a.randomlySelect?Math.floor(Math.random()*s.length):y-1);if(S)try{return await S.request(i,{...n})}catch(v){if(x==null||x(v,S),y>=_)throw v}}throw new Error("unreachable")}}class mr{get(i,n){if(!Object.getOwnPropertyNames(this).includes(i))throw new Error(`Field "${i}" is not a property of the Arweave Transaction class.`);if(this[i]instanceof Uint8Array)return n&&n.decode&&n.string?ke(this[i]):n&&n.decode&&!n.string?this[i]:St(this[i]);if(this[i]instanceof Array){if((n==null?void 0:n.decode)!==void 0||(n==null?void 0:n.string)!==void 0)throw i==="tags"&&console.warn(`Did you mean to use 'transaction["tags"]' ?`),new Error("Cannot decode or stringify an array.");return this[i]}return n&&n.decode==!0?n&&n.string?lr(this[i]):kt(this[i]):this[i]}}class Fr extends mr{constructor(n,a){super();A(this,"name");A(this,"value");this.name=n,this.value=a}}class bt extends mr{constructor({attributes:n,deps:a}){super();A(this,"format",2);A(this,"id","");A(this,"last_tx","");A(this,"owner","");A(this,"tags",[]);A(this,"target","");A(this,"quantity","0");A(this,"data_size","0");A(this,"data",new Uint8Array);A(this,"data_root","");A(this,"reward","0");A(this,"signature","");A(this,"merkle");A(this,"deepHash");A(this,"chunks");this.merkle=a.merkle,this.deepHash=a.deepHash,Object.assign(this,n),typeof this.data=="string"&&(this.data=kt(this.data)),n.tags&&(this.tags=n.tags)}addTag(n,a){this.tags.push({name:_e(n),value:_e(a)})}toJSON(){return{format:this.format,id:this.id,last_tx:this.last_tx,owner:this.owner,tags:this.tags,target:this.target,quantity:this.quantity,data:St(this.data),data_size:this.data_size,data_root:this.data_root,data_tree:this.data_tree,reward:this.reward,signature:this.signature}}setOwner(n){this.owner=n}setSignature({id:n,owner:a,reward:y,tags:s,signature:_}){this.id=n,this.owner=a,y&&(this.reward=y),s&&(this.tags=s),this.signature=_}async prepareChunks(n){!this.chunks&&n.byteLength>0&&(this.chunks=await this.merkle.generateTransactionChunks(n),this.data_root=St(this.chunks.data_root)),!this.chunks&&n.byteLength===0&&(this.chunks={chunks:[],data_root:new Uint8Array,proofs:[]},this.data_root="")}getChunk(n,a){if(!this.chunks)throw new Error("Chunks have not been prepared");const y=this.chunks.proofs[n],s=this.chunks.chunks[n];return{data_root:this.data_root,data_size:this.data_size,data_path:St(y.proof),offset:y.offset.toString(),chunk:St(a.slice(s.minByteRange,s.maxByteRange))}}async getSignatureData(){switch(this.format){case 1:const n=this.tags.reduce((y,s)=>Tt([y,kt(s.name),kt(s.value)]),new Uint8Array);return Tt([this.get("owner",{decode:!0,string:!1}),this.get("target",{decode:!0,string:!1}),this.get("data",{decode:!0,string:!1}),_t(this.quantity),_t(this.reward),this.get("last_tx",{decode:!0,string:!1}),n]);case 2:this.data_root||await this.prepareChunks(this.data);const a=this.tags.map(y=>[kt(y.name),kt(y.value)]);return await this.deepHash.deepHash([_t(this.format.toString()),this.get("owner",{decode:!0,string:!1}),this.get("target",{decode:!0,string:!1}),_t(this.quantity),_t(this.reward),this.get("last_tx",{decode:!0,string:!1}),a,_t(this.data_size),this.get("data_root",{decode:!0,string:!1})]);default:throw new Error(`Unexpected transaction format: ${this.format}`)}}}class Zr{constructor(i){A(this,"api");this.api=i}getInfo(){return this.api.get("info").then(i=>i.data)}getPeers(){return this.api.get("peers").then(i=>i.data)}}const We=1,Jr=["invalid_json","chunk_too_big","data_path_too_big","offset_too_big","data_size_too_big","chunk_proof_ratio_not_attractive","invalid_proof"],Ve=1e3*40;class Pt{constructor({deps:i,transaction:n}){A(this,"chunkIndex",0);A(this,"txPosted",!1);A(this,"transaction");A(this,"lastRequestTimeEnd",0);A(this,"totalErrors",0);A(this,"data");A(this,"lastResponseStatus",0);A(this,"lastResponseError","");A(this,"crypto");A(this,"api");A(this,"merkle");A(this,"deepHash");if(!n.id)throw new Error("Transaction is not signed");if(!n.chunks)throw new Error("Transaction chunks not prepared");this.api=i.api,this.crypto=i.crypto,this.merkle=i.merkle,this.deepHash=i.deepHash,this.data=n.data,this.transaction=new bt({attributes:Object.assign({},n,{data:new Uint8Array(0)}),deps:{merkle:i.merkle,deepHash:i.deepHash}})}get isComplete(){return this.txPosted&&this.chunkIndex===this.transaction.chunks.chunks.length}get totalChunks(){return this.transaction.chunks.chunks.length}get uploadedChunks(){return this.chunkIndex}get pctComplete(){return Math.trunc(this.uploadedChunks/this.totalChunks*100)}async uploadChunk(i){if(this.isComplete)throw new Error("Upload is already complete");if(this.lastResponseError!==""?this.totalErrors++:this.totalErrors=0,this.totalErrors===100)throw new Error(`Unable to complete upload: ${this.lastResponseStatus}: ${this.lastResponseError}`);let n=this.lastResponseError===""?0:Math.max(this.lastRequestTimeEnd+Ve-Date.now(),Ve);if(n>0&&(n=n-n*Math.random()*.3,await new Promise(_=>setTimeout(_,n))),this.lastResponseError="",!this.txPosted){await this.postTransaction();return}i&&(this.chunkIndex=i);const a=this.transaction.getChunk(i||this.chunkIndex,this.data);if(!await this.merkle.validatePath(this.transaction.chunks.data_root,parseInt(a.offset),0,parseInt(a.data_size),kt(a.data_path)))throw new Error(`Unable to validate chunk ${this.chunkIndex}`);const s=await this.api.post("chunk",this.transaction.getChunk(this.chunkIndex,this.data)).catch(_=>(console.error(_.message),{status:-1,data:{error:_.message}}));if(this.lastRequestTimeEnd=Date.now(),this.lastResponseStatus=s.status,this.lastResponseStatus==200)this.chunkIndex++;else if(this.lastResponseError=Ot(s),Jr.includes(this.lastResponseError))throw new Error(`Fatal error uploading chunk ${this.chunkIndex}: ${this.lastResponseError}`)}static async fromSerialized({serialized:i,data:n,deps:a}){if(!i||typeof i.chunkIndex!="number"||typeof i.transaction!="object")throw new Error("Serialized object does not match expected format.");const y=new bt(i.transaction);y.chunks||await y.prepareChunks(n);const s=new Pt({deps:a,transaction:y});if(s.chunkIndex=i.chunkIndex,s.lastRequestTimeEnd=i.lastRequestTimeEnd,s.lastResponseError=i.lastResponseError,s.lastResponseStatus=i.lastResponseStatus,s.txPosted=i.txPosted,s.data=n,s.transaction.data_root!==i.transaction.data_root)throw new Error("Data mismatch: Uploader doesn't match provided data.");return s}static async fromTransactionId(i,n){const a=await i.get(`tx/${n}`);if(a.status!==200)throw new Error(`Tx ${n} not found: ${a.status}`);const y=a.data;return y.data=new Uint8Array(0),{txPosted:!0,chunkIndex:0,lastResponseError:"",lastRequestTimeEnd:0,lastResponseStatus:0,transaction:y}}toJSON(){return{chunkIndex:this.chunkIndex,transaction:this.transaction,lastRequestTimeEnd:this.lastRequestTimeEnd,lastResponseStatus:this.lastResponseStatus,lastResponseError:this.lastResponseError,txPosted:this.txPosted}}async postTransaction(){if(this.totalChunks<=We){this.transaction.data=this.data;const a=await this.api.post("tx",this.transaction).catch(y=>(console.error(y),{status:-1,data:{error:y.message}}));if(this.lastRequestTimeEnd=Date.now(),this.lastResponseStatus=a.status,this.transaction.data=new Uint8Array(0),a.status>=200&&a.status<300){this.txPosted=!0,this.chunkIndex=We;return}throw this.lastResponseError=Ot(a),new Error(`Unable to upload transaction: ${a.status}, ${this.lastResponseError}`)}const n=await this.api.post("tx",this.transaction);if(this.lastRequestTimeEnd=Date.now(),this.lastResponseStatus=n.status,!(n.status>=200&&n.status<300))throw this.lastResponseError=Ot(n),new Error(`Unable to upload transaction: ${n.status}, ${this.lastResponseError}`);this.txPosted=!0}}class Gr{constructor({deps:i}){A(this,"api");A(this,"crypto");A(this,"chunks");A(this,"merkle");A(this,"deepHash");this.api=i.api,this.crypto=i.crypto,this.chunks=i.chunks,this.merkle=i.merkle,this.deepHash=i.deepHash}getTransactionAnchor(){return this.api.get("tx_anchor",{transformResponse:[]}).then(i=>i.data)}getPrice(i,n){const a=n?`price/${i}/${n}`:`price/${i}`;return this.api.get(a,{transformResponse:[function(y){return y}]}).then(y=>y.data)}async get(i){const n=await this.api.get(`tx/${i}`);if(n.status==200){const a=parseInt(n.data.data_size);if(n.data.format>=2&&a>0&&a<=1024*1024*12){const y=await this.getData(i);return new bt({attributes:{...n.data,data:y},deps:{merkle:this.merkle,deepHash:this.deepHash}})}return new bt({attributes:{...n.data,format:n.data.format||1},deps:{merkle:this.merkle,deepHash:this.deepHash}})}throw n.status===404?new Nt("TX_NOT_FOUND"):n.status===410?new Nt("TX_FAILED"):new Nt("TX_INVALID")}fromRaw(i){return new bt({attributes:i,deps:{merkle:this.merkle,deepHash:this.deepHash}})}getStatus(i){return this.api.get(`tx/${i}/status`).then(n=>n.status===200?{status:200,confirmed:n.data}:{status:n.status,confirmed:null})}async getData(i){let n;try{n=(await this.api.get(`/${i}`,{responseType:"arraybuffer"})).data}catch(a){console.error(`Error while trying to download contiguous data from gateway cache for ${i}`),console.error(a)}if(!n){console.warn(`Falling back to chunks for ${i}`);try{n=await this.chunks.downloadChunkedData(i)}catch(a){console.error(`Error while trying to download chunked data for ${i}`),console.error(a)}}if(!n)throw new Error(`${i} data was not found!`);return n}async getDataStream(i){let n;try{const a=(await this.api.get(`/${i}`,{responseType:"arraybuffer"})).data;n=async function*(){yield a}()}catch(a){console.error(`Error while trying to download contiguous data from gateway cache for ${i}`),console.error(a)}if(!n){console.warn(`Falling back to chunks for ${i}`);try{n=this.chunks.concurrentChunkDownloader(i)}catch(a){console.error(`Error while trying to download chunked data for ${i}`),console.error(a)}}if(!n)throw new Error(`${i} data was not found!`);return n}async sign(i,n,a){const s=typeof n=="object"&&(x=>{let S=!0;return["n","e","d","p","q","dp","dq","qi"].map(v=>!(v in x)&&(S=!1)),S})(n),_=typeof arweaveWallet=="object";if(!s&&!_)throw new Error("No valid JWK or external wallet found to sign transaction.");if(_){try{(await arweaveWallet.getPermissions()).includes("SIGN_TRANSACTION")||await arweaveWallet.connect(["SIGN_TRANSACTION"])}catch{}i.tags=i.tags.map(S=>new Fr(S.name,S.value));const x=await arweaveWallet.sign(i,a);i.setSignature({id:x.id,owner:x.owner,reward:x.reward,tags:x.tags,signature:x.signature})}else if(s){i.setOwner(n.n);const x=await i.getSignatureData(),S=await this.crypto.sign(n,x,a),v=await this.crypto.hash(S);i.setSignature({id:St(v),owner:n.n,signature:St(S)})}else throw new Error("An error occurred while signing. Check wallet is valid")}async verify(i){const n=await i.getSignatureData(),a=i.get("signature",{decode:!0,string:!1}),y=St(await this.crypto.hash(a));if(i.id!==y)throw new Error("Invalid transaction signature or ID! The transaction ID doesn't match the expected SHA-256 hash of the signature.");return this.crypto.verify(i.owner,n,a)}async post(i){if(typeof i=="string"?i=new bt({attributes:JSON.parse(i),deps:{merkle:this.merkle,deepHash:this.deepHash}}):typeof i.readInt32BE=="function"?i=new bt({attributes:JSON.parse(i.toString()),deps:{merkle:this.merkle,deepHash:this.deepHash}}):typeof i=="object"&&!(i instanceof bt)&&(i=new bt({attributes:i,deps:{merkle:this.merkle,deepHash:this.deepHash}})),!(i instanceof bt))throw new Error("Must be Transaction object");i.chunks||await i.prepareChunks(i.data);const n=await this.getUploader(i,i.data);try{for(;!n.isComplete;)await n.uploadChunk()}catch(a){if(n.lastResponseStatus>0)return{status:n.lastResponseStatus,statusText:n.lastResponseError,data:{error:n.lastResponseError}};throw a}return{status:200,statusText:"OK",data:{}}}async getUploader(i,n){let a;if(n instanceof ArrayBuffer&&(n=new Uint8Array(n)),i instanceof bt){if(n||(n=i.data),!(n instanceof Uint8Array))throw new Error("Data format is invalid");i.chunks||await i.prepareChunks(n),a=new Pt({transaction:i,deps:{api:this.api,crypto:this.crypto,merkle:this.merkle,deepHash:this.deepHash}}),(!a.data||a.data.length===0)&&(a.data=n)}else{if(typeof i=="string"&&(i=await Pt.fromTransactionId(this.api,i)),!n||!(n instanceof Uint8Array))throw new Error("Must provide data when resuming upload");a=await Pt.fromSerialized({deps:{api:this.api,merkle:this.merkle,crypto:this.crypto,deepHash:this.deepHash},serialized:i,data:n})}return a}async*upload(i,n){const a=await this.getUploader(i,n);for(;!a.isComplete;)await a.uploadChunk(),yield a;return a}}class Wr{constructor(i,n){A(this,"api");A(this,"crypto");this.api=i,this.crypto=n}getBalance(i){return this.api.get(`wallet/${i}/balance`,{transformResponse:[function(n){return n}]}).then(n=>n.data)}getLastTransactionID(i){return this.api.get(`wallet/${i}/last_tx`).then(n=>n.data)}generate(){return this.crypto.generateJWK()}async jwkToAddress(i){return!i||i==="use_wallet"?this.getAddress():this.getAddress(i)}async getAddress(i){if(!i||i==="use_wallet"){try{await arweaveWallet.connect(["ACCESS_ADDRESS"])}catch{}return arweaveWallet.getActiveAddress()}else return this.ownerToAddress(i.n)}async ownerToAddress(i){return St(await this.crypto.hash(kt(i)))}}var Et;let Se=(Et=class{constructor(i){A(this,"config");A(this,"api");A(this,"wallets");A(this,"transactions");A(this,"network");A(this,"blocks");A(this,"chunks");A(this,"crypto");A(this,"deepHash");A(this,"merkle");if(this.config=i,!i.crypto)throw new Error("config.crypto is required");this.crypto=$r(i.crypto,{deepHash:jr}),this.deepHash=this.crypto.deepHash;const n=i.gateways?Array.isArray(i.gateways)?i.gateways:[i.gateways]:void 0;this.api=new zr({gateways:n,miners:i.miners}),this.wallets=new Wr(this.api,this.crypto),this.chunks=new Lr(this.api),this.network=new Zr(this.api),this.blocks=new Or(this.api,this.network),this.merkle=new Hr({deps:{crypto:this.crypto}}),this.transactions=new Gr({deps:{api:this.api,crypto:i.crypto,chunks:this.chunks,merkle:this.merkle,deepHash:this.deepHash}})}get utils(){return Et.utils}getConfig(){return this.config}async createTransaction(i,n){const a={};if(Object.assign(a,i),!i.data&&!(i.target&&i.quantity))throw new Error("A new Arweave transaction must have a 'data' value, or 'target' and 'quantity' values.");if(i.owner==null&&n&&n!=="use_wallet"&&(a.owner=n.n),i.last_tx==null&&(a.last_tx=await this.transactions.getTransactionAnchor()),typeof i.data=="string"&&(i.data=_t(i.data)),i.data instanceof ArrayBuffer&&(i.data=new Uint8Array(i.data)),i.data&&!(i.data instanceof Uint8Array))throw new Error("Expected data to be a string, Uint8Array or ArrayBuffer");if(i.reward==null){const s=i.data?i.data.byteLength:0;a.reward=await this.transactions.getPrice(s,a.target)}a.data_root="",a.data_size=i.data?i.data.byteLength.toString():"0",a.data=i.data||new Uint8Array(0);const y=new bt({attributes:a,deps:{merkle:this.merkle,deepHash:this.deepHash}});return await y.getSignatureData(),y}},A(Et,"init"),A(Et,"utils",Ur),A(Et,"VERSION","0.0.1"),Et);class yr extends Se{constructor(i,n){super({crypto:(n==null?void 0:n.crypto)??new Nr,...n,gateways:i??"https://arweave.net"})}static init(i){return new yr(i)}}var le={},ce={},de={},Ye;function vr(){if(Ye)return de;Ye=1;const b=qt();function i(a){this._reporterState={obj:null,path:[],options:a||{},errors:[]}}de.Reporter=i,i.prototype.isError=function(y){return y instanceof n},i.prototype.save=function(){const y=this._reporterState;return{obj:y.obj,pathLen:y.path.length}},i.prototype.restore=function(y){const s=this._reporterState;s.obj=y.obj,s.path=s.path.slice(0,y.pathLen)},i.prototype.enterKey=function(y){return this._reporterState.path.push(y)},i.prototype.exitKey=function(y){const s=this._reporterState;s.path=s.path.slice(0,y-1)},i.prototype.leaveKey=function(y,s,_){const x=this._reporterState;this.exitKey(y),x.obj!==null&&(x.obj[s]=_)},i.prototype.path=function(){return this._reporterState.path.join("/")},i.prototype.enterObject=function(){const y=this._reporterState,s=y.obj;return y.obj={},s},i.prototype.leaveObject=function(y){const s=this._reporterState,_=s.obj;return s.obj=y,_},i.prototype.error=function(y){let s;const _=this._reporterState,x=y instanceof n;if(x?s=y:s=new n(_.path.map(function(S){return"["+JSON.stringify(S)+"]"}).join(""),y.message||y,y.stack),!_.options.partial)throw s;return x||_.errors.push(s),s},i.prototype.wrapResult=function(y){const s=this._reporterState;return s.options.partial?{result:this.isError(y)?null:y,errors:s.errors}:y};function n(a,y){this.path=a,this.rethrow(y)}return b(n,Error),n.prototype.rethrow=function(y){if(this.message=y+" at: "+(this.path||"(shallow)"),Error.captureStackTrace&&Error.captureStackTrace(this,n),!this.stack)try{throw new Error(this.message)}catch(s){this.stack=s.stack}return this},de}var $t={},Xe;function xe(){if(Xe)return $t;Xe=1;const b=qt(),i=vr().Reporter,n=be().Buffer;function a(s,_){if(i.call(this,_),!n.isBuffer(s)){this.error("Input not Buffer");return}this.base=s,this.offset=0,this.length=s.length}b(a,i),$t.DecoderBuffer=a,a.isDecoderBuffer=function(_){return _ instanceof a?!0:typeof _=="object"&&n.isBuffer(_.base)&&_.constructor.name==="DecoderBuffer"&&typeof _.offset=="number"&&typeof _.length=="number"&&typeof _.save=="function"&&typeof _.restore=="function"&&typeof _.isEmpty=="function"&&typeof _.readUInt8=="function"&&typeof _.skip=="function"&&typeof _.raw=="function"},a.prototype.save=function(){return{offset:this.offset,reporter:i.prototype.save.call(this)}},a.prototype.restore=function(_){const x=new a(this.base);return x.offset=_.offset,x.length=this.offset,this.offset=_.offset,i.prototype.restore.call(this,_.reporter),x},a.prototype.isEmpty=function(){return this.offset===this.length},a.prototype.readUInt8=function(_){return this.offset+1<=this.length?this.base.readUInt8(this.offset++,!0):this.error(_||"DecoderBuffer overrun")},a.prototype.skip=function(_,x){if(!(this.offset+_<=this.length))return this.error(x||"DecoderBuffer overrun");const S=new a(this.base);return S._reporterState=this._reporterState,S.offset=this.offset,S.length=this.offset+_,this.offset+=_,S},a.prototype.raw=function(_){return this.base.slice(_?_.offset:this.offset,this.length)};function y(s,_){if(Array.isArray(s))this.length=0,this.value=s.map(function(x){return y.isEncoderBuffer(x)||(x=new y(x,_)),this.length+=x.length,x},this);else if(typeof s=="number"){if(!(0<=s&&s<=255))return _.error("non-byte EncoderBuffer value");this.value=s,this.length=1}else if(typeof s=="string")this.value=s,this.length=n.byteLength(s);else if(n.isBuffer(s))this.value=s,this.length=s.length;else return _.error("Unsupported type: "+typeof s)}return $t.EncoderBuffer=y,y.isEncoderBuffer=function(_){return _ instanceof y?!0:typeof _=="object"&&_.constructor.name==="EncoderBuffer"&&typeof _.length=="number"&&typeof _.join=="function"},y.prototype.join=function(_,x){return _||(_=n.alloc(this.length)),x||(x=0),this.length===0||(Array.isArray(this.value)?this.value.forEach(function(S){S.join(_,x),x+=S.length}):(typeof this.value=="number"?_[x]=this.value:typeof this.value=="string"?_.write(this.value,x):n.isBuffer(this.value)&&this.value.copy(_,x),x+=this.length)),_},$t}var pe,Qe;function wr(){if(Qe)return pe;Qe=1;const b=vr().Reporter,i=xe().EncoderBuffer,n=xe().DecoderBuffer,a=Cr(),y=["seq","seqof","set","setof","objid","bool","gentime","utctime","null_","enum","int","objDesc","bitstr","bmpstr","charstr","genstr","graphstr","ia5str","iso646str","numstr","octstr","printstr","t61str","unistr","utf8str","videostr"],s=["key","obj","use","optional","explicit","implicit","def","choice","any","contains"].concat(y),_=["_peekTag","_decodeTag","_use","_decodeStr","_decodeObjid","_decodeTime","_decodeNull","_decodeInt","_decodeBool","_decodeList","_encodeComposite","_encodeStr","_encodeObjid","_encodeTime","_encodeNull","_encodeInt","_encodeBool"];function x(v,f,g){const d={};this._baseState=d,d.name=g,d.enc=v,d.parent=f||null,d.children=null,d.tag=null,d.args=null,d.reverseArgs=null,d.choice=null,d.optional=!1,d.any=!1,d.obj=!1,d.use=null,d.useDecoder=null,d.key=null,d.default=null,d.explicit=null,d.implicit=null,d.contains=null,d.parent||(d.children=[],this._wrap())}pe=x;const S=["enc","parent","children","tag","args","reverseArgs","choice","optional","any","obj","use","alteredUse","key","default","explicit","implicit","contains"];return x.prototype.clone=function(){const f=this._baseState,g={};S.forEach(function(M){g[M]=f[M]});const d=new this.constructor(g.parent);return d._baseState=g,d},x.prototype._wrap=function(){const f=this._baseState;s.forEach(function(g){this[g]=function(){const M=new this.constructor(this);return f.children.push(M),M[g].apply(M,arguments)}},this)},x.prototype._init=function(f){const g=this._baseState;a(g.parent===null),f.call(this),g.children=g.children.filter(function(d){return d._baseState.parent===this},this),a.equal(g.children.length,1,"Root node can have only one child")},x.prototype._useArgs=function(f){const g=this._baseState,d=f.filter(function(M){return M instanceof this.constructor},this);f=f.filter(function(M){return!(M instanceof this.constructor)},this),d.length!==0&&(a(g.children===null),g.children=d,d.forEach(function(M){M._baseState.parent=this},this)),f.length!==0&&(a(g.args===null),g.args=f,g.reverseArgs=f.map(function(M){if(typeof M!="object"||M.constructor!==Object)return M;const k={};return Object.keys(M).forEach(function(E){E==(E|0)&&(E|=0);const C=M[E];k[C]=E}),k}))},_.forEach(function(v){x.prototype[v]=function(){const g=this._baseState;throw new Error(v+" not implemented for encoding: "+g.enc)}}),y.forEach(function(v){x.prototype[v]=function(){const g=this._baseState,d=Array.prototype.slice.call(arguments);return a(g.tag===null),g.tag=v,this._useArgs(d),this}}),x.prototype.use=function(f){a(f);const g=this._baseState;return a(g.use===null),g.use=f,this},x.prototype.optional=function(){const f=this._baseState;return f.optional=!0,this},x.prototype.def=function(f){const g=this._baseState;return a(g.default===null),g.default=f,g.optional=!0,this},x.prototype.explicit=function(f){const g=this._baseState;return a(g.explicit===null&&g.implicit===null),g.explicit=f,this},x.prototype.implicit=function(f){const g=this._baseState;return a(g.explicit===null&&g.implicit===null),g.implicit=f,this},x.prototype.obj=function(){const f=this._baseState,g=Array.prototype.slice.call(arguments);return f.obj=!0,g.length!==0&&this._useArgs(g),this},x.prototype.key=function(f){const g=this._baseState;return a(g.key===null),g.key=f,this},x.prototype.any=function(){const f=this._baseState;return f.any=!0,this},x.prototype.choice=function(f){const g=this._baseState;return a(g.choice===null),g.choice=f,this._useArgs(Object.keys(f).map(function(d){return f[d]})),this},x.prototype.contains=function(f){const g=this._baseState;return a(g.use===null),g.contains=f,this},x.prototype._decode=function(f,g){const d=this._baseState;if(d.parent===null)return f.wrapResult(d.children[0]._decode(f,g));let M=d.default,k=!0,E=null;if(d.key!==null&&(E=f.enterKey(d.key)),d.optional){let I=null;if(d.explicit!==null?I=d.explicit:d.implicit!==null?I=d.implicit:d.tag!==null&&(I=d.tag),I===null&&!d.any){const D=f.save();try{d.choice===null?this._decodeGeneric(d.tag,f,g):this._decodeChoice(f,g),k=!0}catch{k=!1}f.restore(D)}else if(k=this._peekTag(f,I,d.any),f.isError(k))return k}let C;if(d.obj&&k&&(C=f.enterObject()),k){if(d.explicit!==null){const D=this._decodeTag(f,d.explicit);if(f.isError(D))return D;f=D}const I=f.offset;if(d.use===null&&d.choice===null){let D;d.any&&(D=f.save());const Mt=this._decodeTag(f,d.implicit!==null?d.implicit:d.tag,d.any);if(f.isError(Mt))return Mt;d.any?M=f.raw(D):f=Mt}if(g&&g.track&&d.tag!==null&&g.track(f.path(),I,f.length,"tagged"),g&&g.track&&d.tag!==null&&g.track(f.path(),f.offset,f.length,"content"),d.any||(d.choice===null?M=this._decodeGeneric(d.tag,f,g):M=this._decodeChoice(f,g)),f.isError(M))return M;if(!d.any&&d.choice===null&&d.children!==null&&d.children.forEach(function(Mt){Mt._decode(f,g)}),d.contains&&(d.tag==="octstr"||d.tag==="bitstr")){const D=new n(M);M=this._getUse(d.contains,f._reporterState.obj)._decode(D,g)}}return d.obj&&k&&(M=f.leaveObject(C)),d.key!==null&&(M!==null||k===!0)?f.leaveKey(E,d.key,M):E!==null&&f.exitKey(E),M},x.prototype._decodeGeneric=function(f,g,d){const M=this._baseState;return f==="seq"||f==="set"?null:f==="seqof"||f==="setof"?this._decodeList(g,f,M.args[0],d):/str$/.test(f)?this._decodeStr(g,f,d):f==="objid"&&M.args?this._decodeObjid(g,M.args[0],M.args[1],d):f==="objid"?this._decodeObjid(g,null,null,d):f==="gentime"||f==="utctime"?this._decodeTime(g,f,d):f==="null_"?this._decodeNull(g,d):f==="bool"?this._decodeBool(g,d):f==="objDesc"?this._decodeStr(g,f,d):f==="int"||f==="enum"?this._decodeInt(g,M.args&&M.args[0],d):M.use!==null?this._getUse(M.use,g._reporterState.obj)._decode(g,d):g.error("unknown tag: "+f)},x.prototype._getUse=function(f,g){const d=this._baseState;return d.useDecoder=this._use(f,g),a(d.useDecoder._baseState.parent===null),d.useDecoder=d.useDecoder._baseState.children[0],d.implicit!==d.useDecoder._baseState.implicit&&(d.useDecoder=d.useDecoder.clone(),d.useDecoder._baseState.implicit=d.implicit),d.useDecoder},x.prototype._decodeChoice=function(f,g){const d=this._baseState;let M=null,k=!1;return Object.keys(d.choice).some(function(E){const C=f.save(),I=d.choice[E];try{const D=I._decode(f,g);if(f.isError(D))return!1;M={type:E,value:D},k=!0}catch{return f.restore(C),!1}return!0},this),k?M:f.error("Choice not matched")},x.prototype._createEncoderBuffer=function(f){return new i(f,this.reporter)},x.prototype._encode=function(f,g,d){const M=this._baseState;if(M.default!==null&&M.default===f)return;const k=this._encodeValue(f,g,d);if(k!==void 0&&!this._skipDefault(k,g,d))return k},x.prototype._encodeValue=function(f,g,d){const M=this._baseState;if(M.parent===null)return M.children[0]._encode(f,g||new b);let k=null;if(this.reporter=g,M.optional&&f===void 0)if(M.default!==null)f=M.default;else return;let E=null,C=!1;if(M.any)k=this._createEncoderBuffer(f);else if(M.choice)k=this._encodeChoice(f,g);else if(M.contains)E=this._getUse(M.contains,d)._encode(f,g),C=!0;else if(M.children)E=M.children.map(function(I){if(I._baseState.tag==="null_")return I._encode(null,g,f);if(I._baseState.key===null)return g.error("Child should have a key");const D=g.enterKey(I._baseState.key);if(typeof f!="object")return g.error("Child expected, but input is not object");const Mt=I._encode(f[I._baseState.key],g,f);return g.leaveKey(D),Mt},this).filter(function(I){return I}),E=this._createEncoderBuffer(E);else if(M.tag==="seqof"||M.tag==="setof"){if(!(M.args&&M.args.length===1))return g.error("Too many args for : "+M.tag);if(!Array.isArray(f))return g.error("seqof/setof, but data is not Array");const I=this.clone();I._baseState.implicit=null,E=this._createEncoderBuffer(f.map(function(D){const Mt=this._baseState;return this._getUse(Mt.args[0],f)._encode(D,g)},I))}else M.use!==null?k=this._getUse(M.use,d)._encode(f,g):(E=this._encodePrimitive(M.tag,f),C=!0);if(!M.any&&M.choice===null){const I=M.implicit!==null?M.implicit:M.tag,D=M.implicit===null?"universal":"context";I===null?M.use===null&&g.error("Tag could be omitted only for .use()"):M.use===null&&(k=this._encodeComposite(I,C,D,E))}return M.explicit!==null&&(k=this._encodeComposite(M.explicit,!1,"context",k)),k},x.prototype._encodeChoice=function(f,g){const d=this._baseState,M=d.choice[f.type];return M||a(!1,f.type+" not found in "+JSON.stringify(Object.keys(d.choice))),M._encode(f.value,g)},x.prototype._encodePrimitive=function(f,g){const d=this._baseState;if(/str$/.test(f))return this._encodeStr(g,f);if(f==="objid"&&d.args)return this._encodeObjid(g,d.reverseArgs[0],d.args[1]);if(f==="objid")return this._encodeObjid(g,null,null);if(f==="gentime"||f==="utctime")return this._encodeTime(g,f);if(f==="null_")return this._encodeNull();if(f==="int"||f==="enum")return this._encodeInt(g,d.args&&d.reverseArgs[0]);if(f==="bool")return this._encodeBool(g);if(f==="objDesc")return this._encodeStr(g,f);throw new Error("Unsupported tag: "+f)},x.prototype._isNumstr=function(f){return/^[0-9 ]*$/.test(f)},x.prototype._isPrintstr=function(f){return/^[A-Za-z0-9 '()+,-./:=?]*$/.test(f)},pe}var ge={},tr;function Mr(){return tr||(tr=1,function(b){function i(n){const a={};return Object.keys(n).forEach(function(y){(y|0)==y&&(y=y|0);const s=n[y];a[s]=y}),a}b.tagClass={0:"universal",1:"application",2:"context",3:"private"},b.tagClassByName=i(b.tagClass),b.tag={0:"end",1:"bool",2:"int",3:"bitstr",4:"octstr",5:"null_",6:"objid",7:"objDesc",8:"external",9:"real",10:"enum",11:"embed",12:"utf8str",13:"relativeOid",16:"seq",17:"set",18:"numstr",19:"printstr",20:"t61str",21:"videostr",22:"ia5str",23:"utctime",24:"gentime",25:"graphstr",26:"iso646str",27:"genstr",28:"unistr",29:"charstr",30:"bmpstr"},b.tagByName=i(b.tag)}(ge)),ge}var me,er;function _r(){if(er)return me;er=1;const b=qt(),i=be().Buffer,n=wr(),a=Mr();function y(S){this.enc="der",this.name=S.name,this.entity=S,this.tree=new s,this.tree._init(S.body)}me=y,y.prototype.encode=function(v,f){return this.tree._encode(v,f).join()};function s(S){n.call(this,"der",S)}b(s,n),s.prototype._encodeComposite=function(v,f,g,d){const M=x(v,f,g,this.reporter);if(d.length<128){const C=i.alloc(2);return C[0]=M,C[1]=d.length,this._createEncoderBuffer([C,d])}let k=1;for(let C=d.length;C>=256;C>>=8)k++;const E=i.alloc(2+k);E[0]=M,E[1]=128|k;for(let C=1+k,I=d.length;I>0;C--,I>>=8)E[C]=I&255;return this._createEncoderBuffer([E,d])},s.prototype._encodeStr=function(v,f){if(f==="bitstr")return this._createEncoderBuffer([v.unused|0,v.data]);if(f==="bmpstr"){const g=i.alloc(v.length*2);for(let d=0;d<v.length;d++)g.writeUInt16BE(v.charCodeAt(d),d*2);return this._createEncoderBuffer(g)}else return f==="numstr"?this._isNumstr(v)?this._createEncoderBuffer(v):this.reporter.error("Encoding of string type: numstr supports only digits and space"):f==="printstr"?this._isPrintstr(v)?this._createEncoderBuffer(v):this.reporter.error("Encoding of string type: printstr supports only latin upper and lower case letters, digits, space, apostrophe, left and rigth parenthesis, plus sign, comma, hyphen, dot, slash, colon, equal sign, question mark"):/str$/.test(f)?this._createEncoderBuffer(v):f==="objDesc"?this._createEncoderBuffer(v):this.reporter.error("Encoding of string type: "+f+" unsupported")},s.prototype._encodeObjid=function(v,f,g){if(typeof v=="string"){if(!f)return this.reporter.error("string objid given, but no values map found");if(!f.hasOwnProperty(v))return this.reporter.error("objid not found in values map");v=f[v].split(/[\s.]+/g);for(let E=0;E<v.length;E++)v[E]|=0}else if(Array.isArray(v)){v=v.slice();for(let E=0;E<v.length;E++)v[E]|=0}if(!Array.isArray(v))return this.reporter.error("objid() should be either array or string, got: "+JSON.stringify(v));if(!g){if(v[1]>=40)return this.reporter.error("Second objid identifier OOB");v.splice(0,2,v[0]*40+v[1])}let d=0;for(let E=0;E<v.length;E++){let C=v[E];for(d++;C>=128;C>>=7)d++}const M=i.alloc(d);let k=M.length-1;for(let E=v.length-1;E>=0;E--){let C=v[E];for(M[k--]=C&127;(C>>=7)>0;)M[k--]=128|C&127}return this._createEncoderBuffer(M)};function _(S){return S<10?"0"+S:S}s.prototype._encodeTime=function(v,f){let g;const d=new Date(v);return f==="gentime"?g=[_(d.getUTCFullYear()),_(d.getUTCMonth()+1),_(d.getUTCDate()),_(d.getUTCHours()),_(d.getUTCMinutes()),_(d.getUTCSeconds()),"Z"].join(""):f==="utctime"?g=[_(d.getUTCFullYear()%100),_(d.getUTCMonth()+1),_(d.getUTCDate()),_(d.getUTCHours()),_(d.getUTCMinutes()),_(d.getUTCSeconds()),"Z"].join(""):this.reporter.error("Encoding "+f+" time is not supported yet"),this._encodeStr(g,"octstr")},s.prototype._encodeNull=function(){return this._createEncoderBuffer("")},s.prototype._encodeInt=function(v,f){if(typeof v=="string"){if(!f)return this.reporter.error("String int or enum given, but no values map");if(!f.hasOwnProperty(v))return this.reporter.error("Values map doesn't contain: "+JSON.stringify(v));v=f[v]}if(typeof v!="number"&&!i.isBuffer(v)){const M=v.toArray();!v.sign&&M[0]&128&&M.unshift(0),v=i.from(M)}if(i.isBuffer(v)){let M=v.length;v.length===0&&M++;const k=i.alloc(M);return v.copy(k),v.length===0&&(k[0]=0),this._createEncoderBuffer(k)}if(v<128)return this._createEncoderBuffer(v);if(v<256)return this._createEncoderBuffer([0,v]);let g=1;for(let M=v;M>=256;M>>=8)g++;const d=new Array(g);for(let M=d.length-1;M>=0;M--)d[M]=v&255,v>>=8;return d[0]&128&&d.unshift(0),this._createEncoderBuffer(i.from(d))},s.prototype._encodeBool=function(v){return this._createEncoderBuffer(v?255:0)},s.prototype._use=function(v,f){return typeof v=="function"&&(v=v(f)),v._getEncoder("der").tree},s.prototype._skipDefault=function(v,f,g){const d=this._baseState;let M;if(d.default===null)return!1;const k=v.join();if(d.defaultBuffer===void 0&&(d.defaultBuffer=this._encodeValue(d.default,f,g).join()),k.length!==d.defaultBuffer.length)return!1;for(M=0;M<k.length;M++)if(k[M]!==d.defaultBuffer[M])return!1;return!0};function x(S,v,f,g){let d;if(S==="seqof"?S="seq":S==="setof"&&(S="set"),a.tagByName.hasOwnProperty(S))d=a.tagByName[S];else if(typeof S=="number"&&(S|0)===S)d=S;else return g.error("Unknown tag: "+S);return d>=31?g.error("Multi-octet tag encoding unsupported"):(v||(d|=32),d|=a.tagClassByName[f||"universal"]<<6,d)}return me}var ye,rr;function Vr(){if(rr)return ye;rr=1;const b=qt(),i=_r();function n(a){i.call(this,a),this.enc="pem"}return b(n,i),ye=n,n.prototype.encode=function(y,s){const x=i.prototype.encode.call(this,y).toString("base64"),S=["-----BEGIN "+s.label+"-----"];for(let v=0;v<x.length;v+=64)S.push(x.slice(v,v+64));return S.push("-----END "+s.label+"-----"),S.join(`
`)},ye}var ir;function Yr(){return ir||(ir=1,function(b){const i=b;i.der=_r(),i.pem=Vr()}(ce)),ce}var ve={},jt={exports:{}},Xr=jt.exports,nr;function xr(){return nr||(nr=1,function(b){(function(i,n){function a(p,t){if(!p)throw new Error(t||"Assertion failed")}function y(p,t){p.super_=t;var r=function(){};r.prototype=t.prototype,p.prototype=new r,p.prototype.constructor=p}function s(p,t,r){if(s.isBN(p))return p;this.negative=0,this.words=null,this.length=0,this.red=null,p!==null&&((t==="le"||t==="be")&&(r=t,t=10),this._init(p||0,t||10,r||"be"))}typeof i=="object"?i.exports=s:n.BN=s,s.BN=s,s.wordSize=26;var _;try{typeof window<"u"&&typeof window.Buffer<"u"?_=window.Buffer:_=qr.Buffer}catch{}s.isBN=function(t){return t instanceof s?!0:t!==null&&typeof t=="object"&&t.constructor.wordSize===s.wordSize&&Array.isArray(t.words)},s.max=function(t,r){return t.cmp(r)>0?t:r},s.min=function(t,r){return t.cmp(r)<0?t:r},s.prototype._init=function(t,r,o){if(typeof t=="number")return this._initNumber(t,r,o);if(typeof t=="object")return this._initArray(t,r,o);r==="hex"&&(r=16),a(r===(r|0)&&r>=2&&r<=36),t=t.toString().replace(/\s+/g,"");var h=0;t[0]==="-"&&(h++,this.negative=1),h<t.length&&(r===16?this._parseHex(t,h,o):(this._parseBase(t,r,h),o==="le"&&this._initArray(this.toArray(),r,o)))},s.prototype._initNumber=function(t,r,o){t<0&&(this.negative=1,t=-t),t<67108864?(this.words=[t&67108863],this.length=1):t<4503599627370496?(this.words=[t&67108863,t/67108864&67108863],this.length=2):(a(t<9007199254740992),this.words=[t&67108863,t/67108864&67108863,1],this.length=3),o==="le"&&this._initArray(this.toArray(),r,o)},s.prototype._initArray=function(t,r,o){if(a(typeof t.length=="number"),t.length<=0)return this.words=[0],this.length=1,this;this.length=Math.ceil(t.length/3),this.words=new Array(this.length);for(var h=0;h<this.length;h++)this.words[h]=0;var c,m,w=0;if(o==="be")for(h=t.length-1,c=0;h>=0;h-=3)m=t[h]|t[h-1]<<8|t[h-2]<<16,this.words[c]|=m<<w&67108863,this.words[c+1]=m>>>26-w&67108863,w+=24,w>=26&&(w-=26,c++);else if(o==="le")for(h=0,c=0;h<t.length;h+=3)m=t[h]|t[h+1]<<8|t[h+2]<<16,this.words[c]|=m<<w&67108863,this.words[c+1]=m>>>26-w&67108863,w+=24,w>=26&&(w-=26,c++);return this.strip()};function x(p,t){var r=p.charCodeAt(t);return r>=65&&r<=70?r-55:r>=97&&r<=102?r-87:r-48&15}function S(p,t,r){var o=x(p,r);return r-1>=t&&(o|=x(p,r-1)<<4),o}s.prototype._parseHex=function(t,r,o){this.length=Math.ceil((t.length-r)/6),this.words=new Array(this.length);for(var h=0;h<this.length;h++)this.words[h]=0;var c=0,m=0,w;if(o==="be")for(h=t.length-1;h>=r;h-=2)w=S(t,r,h)<<c,this.words[m]|=w&67108863,c>=18?(c-=18,m+=1,this.words[m]|=w>>>26):c+=8;else{var u=t.length-r;for(h=u%2===0?r+1:r;h<t.length;h+=2)w=S(t,r,h)<<c,this.words[m]|=w&67108863,c>=18?(c-=18,m+=1,this.words[m]|=w>>>26):c+=8}this.strip()};function v(p,t,r,o){for(var h=0,c=Math.min(p.length,r),m=t;m<c;m++){var w=p.charCodeAt(m)-48;h*=o,w>=49?h+=w-49+10:w>=17?h+=w-17+10:h+=w}return h}s.prototype._parseBase=function(t,r,o){this.words=[0],this.length=1;for(var h=0,c=1;c<=67108863;c*=r)h++;h--,c=c/r|0;for(var m=t.length-o,w=m%h,u=Math.min(m,m-w)+o,e=0,l=o;l<u;l+=h)e=v(t,l,l+h,r),this.imuln(c),this.words[0]+e<67108864?this.words[0]+=e:this._iaddn(e);if(w!==0){var B=1;for(e=v(t,l,t.length,r),l=0;l<w;l++)B*=r;this.imuln(B),this.words[0]+e<67108864?this.words[0]+=e:this._iaddn(e)}this.strip()},s.prototype.copy=function(t){t.words=new Array(this.length);for(var r=0;r<this.length;r++)t.words[r]=this.words[r];t.length=this.length,t.negative=this.negative,t.red=this.red},s.prototype.clone=function(){var t=new s(null);return this.copy(t),t},s.prototype._expand=function(t){for(;this.length<t;)this.words[this.length++]=0;return this},s.prototype.strip=function(){for(;this.length>1&&this.words[this.length-1]===0;)this.length--;return this._normSign()},s.prototype._normSign=function(){return this.length===1&&this.words[0]===0&&(this.negative=0),this},s.prototype.inspect=function(){return(this.red?"<BN-R: ":"<BN: ")+this.toString(16)+">"};var f=["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000","000000000000000","0000000000000000","00000000000000000","000000000000000000","0000000000000000000","00000000000000000000","000000000000000000000","0000000000000000000000","00000000000000000000000","000000000000000000000000","0000000000000000000000000"],g=[0,0,25,16,12,11,10,9,8,8,7,7,7,7,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],d=[0,0,33554432,43046721,16777216,48828125,60466176,40353607,16777216,43046721,1e7,19487171,35831808,62748517,7529536,11390625,16777216,24137569,34012224,47045881,64e6,4084101,5153632,6436343,7962624,9765625,11881376,14348907,17210368,20511149,243e5,28629151,33554432,39135393,45435424,52521875,60466176];s.prototype.toString=function(t,r){t=t||10,r=r|0||1;var o;if(t===16||t==="hex"){o="";for(var h=0,c=0,m=0;m<this.length;m++){var w=this.words[m],u=((w<<h|c)&16777215).toString(16);c=w>>>24-h&16777215,h+=2,h>=26&&(h-=26,m--),c!==0||m!==this.length-1?o=f[6-u.length]+u+o:o=u+o}for(c!==0&&(o=c.toString(16)+o);o.length%r!==0;)o="0"+o;return this.negative!==0&&(o="-"+o),o}if(t===(t|0)&&t>=2&&t<=36){var e=g[t],l=d[t];o="";var B=this.clone();for(B.negative=0;!B.isZero();){var R=B.modn(l).toString(t);B=B.idivn(l),B.isZero()?o=R+o:o=f[e-R.length]+R+o}for(this.isZero()&&(o="0"+o);o.length%r!==0;)o="0"+o;return this.negative!==0&&(o="-"+o),o}a(!1,"Base should be between 2 and 36")},s.prototype.toNumber=function(){var t=this.words[0];return this.length===2?t+=this.words[1]*67108864:this.length===3&&this.words[2]===1?t+=4503599627370496+this.words[1]*67108864:this.length>2&&a(!1,"Number can only safely store up to 53 bits"),this.negative!==0?-t:t},s.prototype.toJSON=function(){return this.toString(16)},s.prototype.toBuffer=function(t,r){return a(typeof _<"u"),this.toArrayLike(_,t,r)},s.prototype.toArray=function(t,r){return this.toArrayLike(Array,t,r)},s.prototype.toArrayLike=function(t,r,o){var h=this.byteLength(),c=o||Math.max(1,h);a(h<=c,"byte array longer than desired length"),a(c>0,"Requested array length <= 0"),this.strip();var m=r==="le",w=new t(c),u,e,l=this.clone();if(m){for(e=0;!l.isZero();e++)u=l.andln(255),l.iushrn(8),w[e]=u;for(;e<c;e++)w[e]=0}else{for(e=0;e<c-h;e++)w[e]=0;for(e=0;!l.isZero();e++)u=l.andln(255),l.iushrn(8),w[c-e-1]=u}return w},Math.clz32?s.prototype._countBits=function(t){return 32-Math.clz32(t)}:s.prototype._countBits=function(t){var r=t,o=0;return r>=4096&&(o+=13,r>>>=13),r>=64&&(o+=7,r>>>=7),r>=8&&(o+=4,r>>>=4),r>=2&&(o+=2,r>>>=2),o+r},s.prototype._zeroBits=function(t){if(t===0)return 26;var r=t,o=0;return(r&8191)===0&&(o+=13,r>>>=13),(r&127)===0&&(o+=7,r>>>=7),(r&15)===0&&(o+=4,r>>>=4),(r&3)===0&&(o+=2,r>>>=2),(r&1)===0&&o++,o},s.prototype.bitLength=function(){var t=this.words[this.length-1],r=this._countBits(t);return(this.length-1)*26+r};function M(p){for(var t=new Array(p.bitLength()),r=0;r<t.length;r++){var o=r/26|0,h=r%26;t[r]=(p.words[o]&1<<h)>>>h}return t}s.prototype.zeroBits=function(){if(this.isZero())return 0;for(var t=0,r=0;r<this.length;r++){var o=this._zeroBits(this.words[r]);if(t+=o,o!==26)break}return t},s.prototype.byteLength=function(){return Math.ceil(this.bitLength()/8)},s.prototype.toTwos=function(t){return this.negative!==0?this.abs().inotn(t).iaddn(1):this.clone()},s.prototype.fromTwos=function(t){return this.testn(t-1)?this.notn(t).iaddn(1).ineg():this.clone()},s.prototype.isNeg=function(){return this.negative!==0},s.prototype.neg=function(){return this.clone().ineg()},s.prototype.ineg=function(){return this.isZero()||(this.negative^=1),this},s.prototype.iuor=function(t){for(;this.length<t.length;)this.words[this.length++]=0;for(var r=0;r<t.length;r++)this.words[r]=this.words[r]|t.words[r];return this.strip()},s.prototype.ior=function(t){return a((this.negative|t.negative)===0),this.iuor(t)},s.prototype.or=function(t){return this.length>t.length?this.clone().ior(t):t.clone().ior(this)},s.prototype.uor=function(t){return this.length>t.length?this.clone().iuor(t):t.clone().iuor(this)},s.prototype.iuand=function(t){var r;this.length>t.length?r=t:r=this;for(var o=0;o<r.length;o++)this.words[o]=this.words[o]&t.words[o];return this.length=r.length,this.strip()},s.prototype.iand=function(t){return a((this.negative|t.negative)===0),this.iuand(t)},s.prototype.and=function(t){return this.length>t.length?this.clone().iand(t):t.clone().iand(this)},s.prototype.uand=function(t){return this.length>t.length?this.clone().iuand(t):t.clone().iuand(this)},s.prototype.iuxor=function(t){var r,o;this.length>t.length?(r=this,o=t):(r=t,o=this);for(var h=0;h<o.length;h++)this.words[h]=r.words[h]^o.words[h];if(this!==r)for(;h<r.length;h++)this.words[h]=r.words[h];return this.length=r.length,this.strip()},s.prototype.ixor=function(t){return a((this.negative|t.negative)===0),this.iuxor(t)},s.prototype.xor=function(t){return this.length>t.length?this.clone().ixor(t):t.clone().ixor(this)},s.prototype.uxor=function(t){return this.length>t.length?this.clone().iuxor(t):t.clone().iuxor(this)},s.prototype.inotn=function(t){a(typeof t=="number"&&t>=0);var r=Math.ceil(t/26)|0,o=t%26;this._expand(r),o>0&&r--;for(var h=0;h<r;h++)this.words[h]=~this.words[h]&67108863;return o>0&&(this.words[h]=~this.words[h]&67108863>>26-o),this.strip()},s.prototype.notn=function(t){return this.clone().inotn(t)},s.prototype.setn=function(t,r){a(typeof t=="number"&&t>=0);var o=t/26|0,h=t%26;return this._expand(o+1),r?this.words[o]=this.words[o]|1<<h:this.words[o]=this.words[o]&~(1<<h),this.strip()},s.prototype.iadd=function(t){var r;if(this.negative!==0&&t.negative===0)return this.negative=0,r=this.isub(t),this.negative^=1,this._normSign();if(this.negative===0&&t.negative!==0)return t.negative=0,r=this.isub(t),t.negative=1,r._normSign();var o,h;this.length>t.length?(o=this,h=t):(o=t,h=this);for(var c=0,m=0;m<h.length;m++)r=(o.words[m]|0)+(h.words[m]|0)+c,this.words[m]=r&67108863,c=r>>>26;for(;c!==0&&m<o.length;m++)r=(o.words[m]|0)+c,this.words[m]=r&67108863,c=r>>>26;if(this.length=o.length,c!==0)this.words[this.length]=c,this.length++;else if(o!==this)for(;m<o.length;m++)this.words[m]=o.words[m];return this},s.prototype.add=function(t){var r;return t.negative!==0&&this.negative===0?(t.negative=0,r=this.sub(t),t.negative^=1,r):t.negative===0&&this.negative!==0?(this.negative=0,r=t.sub(this),this.negative=1,r):this.length>t.length?this.clone().iadd(t):t.clone().iadd(this)},s.prototype.isub=function(t){if(t.negative!==0){t.negative=0;var r=this.iadd(t);return t.negative=1,r._normSign()}else if(this.negative!==0)return this.negative=0,this.iadd(t),this.negative=1,this._normSign();var o=this.cmp(t);if(o===0)return this.negative=0,this.length=1,this.words[0]=0,this;var h,c;o>0?(h=this,c=t):(h=t,c=this);for(var m=0,w=0;w<c.length;w++)r=(h.words[w]|0)-(c.words[w]|0)+m,m=r>>26,this.words[w]=r&67108863;for(;m!==0&&w<h.length;w++)r=(h.words[w]|0)+m,m=r>>26,this.words[w]=r&67108863;if(m===0&&w<h.length&&h!==this)for(;w<h.length;w++)this.words[w]=h.words[w];return this.length=Math.max(this.length,w),h!==this&&(this.negative=1),this.strip()},s.prototype.sub=function(t){return this.clone().isub(t)};function k(p,t,r){r.negative=t.negative^p.negative;var o=p.length+t.length|0;r.length=o,o=o-1|0;var h=p.words[0]|0,c=t.words[0]|0,m=h*c,w=m&67108863,u=m/67108864|0;r.words[0]=w;for(var e=1;e<o;e++){for(var l=u>>>26,B=u&67108863,R=Math.min(e,t.length-1),T=Math.max(0,e-p.length+1);T<=R;T++){var q=e-T|0;h=p.words[q]|0,c=t.words[T]|0,m=h*c+B,l+=m/67108864|0,B=m&67108863}r.words[e]=B|0,u=l|0}return u!==0?r.words[e]=u|0:r.length--,r.strip()}var E=function(t,r,o){var h=t.words,c=r.words,m=o.words,w=0,u,e,l,B=h[0]|0,R=B&8191,T=B>>>13,q=h[1]|0,U=q&8191,N=q>>>13,At=h[2]|0,O=At&8191,P=At>>>13,Be=h[3]|0,L=Be&8191,$=Be>>>13,Re=h[4]|0,j=Re&8191,K=Re>>>13,Te=h[5]|0,z=Te&8191,F=Te>>>13,Ce=h[6]|0,Z=Ce&8191,J=Ce>>>13,qe=h[7]|0,G=qe&8191,W=qe>>>13,De=h[8]|0,V=De&8191,Y=De>>>13,Ie=h[9]|0,X=Ie&8191,Q=Ie>>>13,Ue=c[0]|0,tt=Ue&8191,et=Ue>>>13,Ne=c[1]|0,rt=Ne&8191,it=Ne>>>13,Oe=c[2]|0,nt=Oe&8191,st=Oe>>>13,Pe=c[3]|0,ot=Pe&8191,at=Pe>>>13,He=c[4]|0,ht=He&8191,ft=He>>>13,Le=c[5]|0,ut=Le&8191,lt=Le>>>13,$e=c[6]|0,ct=$e&8191,dt=$e>>>13,je=c[7]|0,pt=je&8191,gt=je>>>13,Ke=c[8]|0,mt=Ke&8191,yt=Ke>>>13,ze=c[9]|0,vt=ze&8191,wt=ze>>>13;o.negative=t.negative^r.negative,o.length=19,u=Math.imul(R,tt),e=Math.imul(R,et),e=e+Math.imul(T,tt)|0,l=Math.imul(T,et);var Zt=(w+u|0)+((e&8191)<<13)|0;w=(l+(e>>>13)|0)+(Zt>>>26)|0,Zt&=67108863,u=Math.imul(U,tt),e=Math.imul(U,et),e=e+Math.imul(N,tt)|0,l=Math.imul(N,et),u=u+Math.imul(R,rt)|0,e=e+Math.imul(R,it)|0,e=e+Math.imul(T,rt)|0,l=l+Math.imul(T,it)|0;var Jt=(w+u|0)+((e&8191)<<13)|0;w=(l+(e>>>13)|0)+(Jt>>>26)|0,Jt&=67108863,u=Math.imul(O,tt),e=Math.imul(O,et),e=e+Math.imul(P,tt)|0,l=Math.imul(P,et),u=u+Math.imul(U,rt)|0,e=e+Math.imul(U,it)|0,e=e+Math.imul(N,rt)|0,l=l+Math.imul(N,it)|0,u=u+Math.imul(R,nt)|0,e=e+Math.imul(R,st)|0,e=e+Math.imul(T,nt)|0,l=l+Math.imul(T,st)|0;var Gt=(w+u|0)+((e&8191)<<13)|0;w=(l+(e>>>13)|0)+(Gt>>>26)|0,Gt&=67108863,u=Math.imul(L,tt),e=Math.imul(L,et),e=e+Math.imul($,tt)|0,l=Math.imul($,et),u=u+Math.imul(O,rt)|0,e=e+Math.imul(O,it)|0,e=e+Math.imul(P,rt)|0,l=l+Math.imul(P,it)|0,u=u+Math.imul(U,nt)|0,e=e+Math.imul(U,st)|0,e=e+Math.imul(N,nt)|0,l=l+Math.imul(N,st)|0,u=u+Math.imul(R,ot)|0,e=e+Math.imul(R,at)|0,e=e+Math.imul(T,ot)|0,l=l+Math.imul(T,at)|0;var Wt=(w+u|0)+((e&8191)<<13)|0;w=(l+(e>>>13)|0)+(Wt>>>26)|0,Wt&=67108863,u=Math.imul(j,tt),e=Math.imul(j,et),e=e+Math.imul(K,tt)|0,l=Math.imul(K,et),u=u+Math.imul(L,rt)|0,e=e+Math.imul(L,it)|0,e=e+Math.imul($,rt)|0,l=l+Math.imul($,it)|0,u=u+Math.imul(O,nt)|0,e=e+Math.imul(O,st)|0,e=e+Math.imul(P,nt)|0,l=l+Math.imul(P,st)|0,u=u+Math.imul(U,ot)|0,e=e+Math.imul(U,at)|0,e=e+Math.imul(N,ot)|0,l=l+Math.imul(N,at)|0,u=u+Math.imul(R,ht)|0,e=e+Math.imul(R,ft)|0,e=e+Math.imul(T,ht)|0,l=l+Math.imul(T,ft)|0;var Vt=(w+u|0)+((e&8191)<<13)|0;w=(l+(e>>>13)|0)+(Vt>>>26)|0,Vt&=67108863,u=Math.imul(z,tt),e=Math.imul(z,et),e=e+Math.imul(F,tt)|0,l=Math.imul(F,et),u=u+Math.imul(j,rt)|0,e=e+Math.imul(j,it)|0,e=e+Math.imul(K,rt)|0,l=l+Math.imul(K,it)|0,u=u+Math.imul(L,nt)|0,e=e+Math.imul(L,st)|0,e=e+Math.imul($,nt)|0,l=l+Math.imul($,st)|0,u=u+Math.imul(O,ot)|0,e=e+Math.imul(O,at)|0,e=e+Math.imul(P,ot)|0,l=l+Math.imul(P,at)|0,u=u+Math.imul(U,ht)|0,e=e+Math.imul(U,ft)|0,e=e+Math.imul(N,ht)|0,l=l+Math.imul(N,ft)|0,u=u+Math.imul(R,ut)|0,e=e+Math.imul(R,lt)|0,e=e+Math.imul(T,ut)|0,l=l+Math.imul(T,lt)|0;var Yt=(w+u|0)+((e&8191)<<13)|0;w=(l+(e>>>13)|0)+(Yt>>>26)|0,Yt&=67108863,u=Math.imul(Z,tt),e=Math.imul(Z,et),e=e+Math.imul(J,tt)|0,l=Math.imul(J,et),u=u+Math.imul(z,rt)|0,e=e+Math.imul(z,it)|0,e=e+Math.imul(F,rt)|0,l=l+Math.imul(F,it)|0,u=u+Math.imul(j,nt)|0,e=e+Math.imul(j,st)|0,e=e+Math.imul(K,nt)|0,l=l+Math.imul(K,st)|0,u=u+Math.imul(L,ot)|0,e=e+Math.imul(L,at)|0,e=e+Math.imul($,ot)|0,l=l+Math.imul($,at)|0,u=u+Math.imul(O,ht)|0,e=e+Math.imul(O,ft)|0,e=e+Math.imul(P,ht)|0,l=l+Math.imul(P,ft)|0,u=u+Math.imul(U,ut)|0,e=e+Math.imul(U,lt)|0,e=e+Math.imul(N,ut)|0,l=l+Math.imul(N,lt)|0,u=u+Math.imul(R,ct)|0,e=e+Math.imul(R,dt)|0,e=e+Math.imul(T,ct)|0,l=l+Math.imul(T,dt)|0;var Xt=(w+u|0)+((e&8191)<<13)|0;w=(l+(e>>>13)|0)+(Xt>>>26)|0,Xt&=67108863,u=Math.imul(G,tt),e=Math.imul(G,et),e=e+Math.imul(W,tt)|0,l=Math.imul(W,et),u=u+Math.imul(Z,rt)|0,e=e+Math.imul(Z,it)|0,e=e+Math.imul(J,rt)|0,l=l+Math.imul(J,it)|0,u=u+Math.imul(z,nt)|0,e=e+Math.imul(z,st)|0,e=e+Math.imul(F,nt)|0,l=l+Math.imul(F,st)|0,u=u+Math.imul(j,ot)|0,e=e+Math.imul(j,at)|0,e=e+Math.imul(K,ot)|0,l=l+Math.imul(K,at)|0,u=u+Math.imul(L,ht)|0,e=e+Math.imul(L,ft)|0,e=e+Math.imul($,ht)|0,l=l+Math.imul($,ft)|0,u=u+Math.imul(O,ut)|0,e=e+Math.imul(O,lt)|0,e=e+Math.imul(P,ut)|0,l=l+Math.imul(P,lt)|0,u=u+Math.imul(U,ct)|0,e=e+Math.imul(U,dt)|0,e=e+Math.imul(N,ct)|0,l=l+Math.imul(N,dt)|0,u=u+Math.imul(R,pt)|0,e=e+Math.imul(R,gt)|0,e=e+Math.imul(T,pt)|0,l=l+Math.imul(T,gt)|0;var Qt=(w+u|0)+((e&8191)<<13)|0;w=(l+(e>>>13)|0)+(Qt>>>26)|0,Qt&=67108863,u=Math.imul(V,tt),e=Math.imul(V,et),e=e+Math.imul(Y,tt)|0,l=Math.imul(Y,et),u=u+Math.imul(G,rt)|0,e=e+Math.imul(G,it)|0,e=e+Math.imul(W,rt)|0,l=l+Math.imul(W,it)|0,u=u+Math.imul(Z,nt)|0,e=e+Math.imul(Z,st)|0,e=e+Math.imul(J,nt)|0,l=l+Math.imul(J,st)|0,u=u+Math.imul(z,ot)|0,e=e+Math.imul(z,at)|0,e=e+Math.imul(F,ot)|0,l=l+Math.imul(F,at)|0,u=u+Math.imul(j,ht)|0,e=e+Math.imul(j,ft)|0,e=e+Math.imul(K,ht)|0,l=l+Math.imul(K,ft)|0,u=u+Math.imul(L,ut)|0,e=e+Math.imul(L,lt)|0,e=e+Math.imul($,ut)|0,l=l+Math.imul($,lt)|0,u=u+Math.imul(O,ct)|0,e=e+Math.imul(O,dt)|0,e=e+Math.imul(P,ct)|0,l=l+Math.imul(P,dt)|0,u=u+Math.imul(U,pt)|0,e=e+Math.imul(U,gt)|0,e=e+Math.imul(N,pt)|0,l=l+Math.imul(N,gt)|0,u=u+Math.imul(R,mt)|0,e=e+Math.imul(R,yt)|0,e=e+Math.imul(T,mt)|0,l=l+Math.imul(T,yt)|0;var te=(w+u|0)+((e&8191)<<13)|0;w=(l+(e>>>13)|0)+(te>>>26)|0,te&=67108863,u=Math.imul(X,tt),e=Math.imul(X,et),e=e+Math.imul(Q,tt)|0,l=Math.imul(Q,et),u=u+Math.imul(V,rt)|0,e=e+Math.imul(V,it)|0,e=e+Math.imul(Y,rt)|0,l=l+Math.imul(Y,it)|0,u=u+Math.imul(G,nt)|0,e=e+Math.imul(G,st)|0,e=e+Math.imul(W,nt)|0,l=l+Math.imul(W,st)|0,u=u+Math.imul(Z,ot)|0,e=e+Math.imul(Z,at)|0,e=e+Math.imul(J,ot)|0,l=l+Math.imul(J,at)|0,u=u+Math.imul(z,ht)|0,e=e+Math.imul(z,ft)|0,e=e+Math.imul(F,ht)|0,l=l+Math.imul(F,ft)|0,u=u+Math.imul(j,ut)|0,e=e+Math.imul(j,lt)|0,e=e+Math.imul(K,ut)|0,l=l+Math.imul(K,lt)|0,u=u+Math.imul(L,ct)|0,e=e+Math.imul(L,dt)|0,e=e+Math.imul($,ct)|0,l=l+Math.imul($,dt)|0,u=u+Math.imul(O,pt)|0,e=e+Math.imul(O,gt)|0,e=e+Math.imul(P,pt)|0,l=l+Math.imul(P,gt)|0,u=u+Math.imul(U,mt)|0,e=e+Math.imul(U,yt)|0,e=e+Math.imul(N,mt)|0,l=l+Math.imul(N,yt)|0,u=u+Math.imul(R,vt)|0,e=e+Math.imul(R,wt)|0,e=e+Math.imul(T,vt)|0,l=l+Math.imul(T,wt)|0;var ee=(w+u|0)+((e&8191)<<13)|0;w=(l+(e>>>13)|0)+(ee>>>26)|0,ee&=67108863,u=Math.imul(X,rt),e=Math.imul(X,it),e=e+Math.imul(Q,rt)|0,l=Math.imul(Q,it),u=u+Math.imul(V,nt)|0,e=e+Math.imul(V,st)|0,e=e+Math.imul(Y,nt)|0,l=l+Math.imul(Y,st)|0,u=u+Math.imul(G,ot)|0,e=e+Math.imul(G,at)|0,e=e+Math.imul(W,ot)|0,l=l+Math.imul(W,at)|0,u=u+Math.imul(Z,ht)|0,e=e+Math.imul(Z,ft)|0,e=e+Math.imul(J,ht)|0,l=l+Math.imul(J,ft)|0,u=u+Math.imul(z,ut)|0,e=e+Math.imul(z,lt)|0,e=e+Math.imul(F,ut)|0,l=l+Math.imul(F,lt)|0,u=u+Math.imul(j,ct)|0,e=e+Math.imul(j,dt)|0,e=e+Math.imul(K,ct)|0,l=l+Math.imul(K,dt)|0,u=u+Math.imul(L,pt)|0,e=e+Math.imul(L,gt)|0,e=e+Math.imul($,pt)|0,l=l+Math.imul($,gt)|0,u=u+Math.imul(O,mt)|0,e=e+Math.imul(O,yt)|0,e=e+Math.imul(P,mt)|0,l=l+Math.imul(P,yt)|0,u=u+Math.imul(U,vt)|0,e=e+Math.imul(U,wt)|0,e=e+Math.imul(N,vt)|0,l=l+Math.imul(N,wt)|0;var re=(w+u|0)+((e&8191)<<13)|0;w=(l+(e>>>13)|0)+(re>>>26)|0,re&=67108863,u=Math.imul(X,nt),e=Math.imul(X,st),e=e+Math.imul(Q,nt)|0,l=Math.imul(Q,st),u=u+Math.imul(V,ot)|0,e=e+Math.imul(V,at)|0,e=e+Math.imul(Y,ot)|0,l=l+Math.imul(Y,at)|0,u=u+Math.imul(G,ht)|0,e=e+Math.imul(G,ft)|0,e=e+Math.imul(W,ht)|0,l=l+Math.imul(W,ft)|0,u=u+Math.imul(Z,ut)|0,e=e+Math.imul(Z,lt)|0,e=e+Math.imul(J,ut)|0,l=l+Math.imul(J,lt)|0,u=u+Math.imul(z,ct)|0,e=e+Math.imul(z,dt)|0,e=e+Math.imul(F,ct)|0,l=l+Math.imul(F,dt)|0,u=u+Math.imul(j,pt)|0,e=e+Math.imul(j,gt)|0,e=e+Math.imul(K,pt)|0,l=l+Math.imul(K,gt)|0,u=u+Math.imul(L,mt)|0,e=e+Math.imul(L,yt)|0,e=e+Math.imul($,mt)|0,l=l+Math.imul($,yt)|0,u=u+Math.imul(O,vt)|0,e=e+Math.imul(O,wt)|0,e=e+Math.imul(P,vt)|0,l=l+Math.imul(P,wt)|0;var ie=(w+u|0)+((e&8191)<<13)|0;w=(l+(e>>>13)|0)+(ie>>>26)|0,ie&=67108863,u=Math.imul(X,ot),e=Math.imul(X,at),e=e+Math.imul(Q,ot)|0,l=Math.imul(Q,at),u=u+Math.imul(V,ht)|0,e=e+Math.imul(V,ft)|0,e=e+Math.imul(Y,ht)|0,l=l+Math.imul(Y,ft)|0,u=u+Math.imul(G,ut)|0,e=e+Math.imul(G,lt)|0,e=e+Math.imul(W,ut)|0,l=l+Math.imul(W,lt)|0,u=u+Math.imul(Z,ct)|0,e=e+Math.imul(Z,dt)|0,e=e+Math.imul(J,ct)|0,l=l+Math.imul(J,dt)|0,u=u+Math.imul(z,pt)|0,e=e+Math.imul(z,gt)|0,e=e+Math.imul(F,pt)|0,l=l+Math.imul(F,gt)|0,u=u+Math.imul(j,mt)|0,e=e+Math.imul(j,yt)|0,e=e+Math.imul(K,mt)|0,l=l+Math.imul(K,yt)|0,u=u+Math.imul(L,vt)|0,e=e+Math.imul(L,wt)|0,e=e+Math.imul($,vt)|0,l=l+Math.imul($,wt)|0;var ne=(w+u|0)+((e&8191)<<13)|0;w=(l+(e>>>13)|0)+(ne>>>26)|0,ne&=67108863,u=Math.imul(X,ht),e=Math.imul(X,ft),e=e+Math.imul(Q,ht)|0,l=Math.imul(Q,ft),u=u+Math.imul(V,ut)|0,e=e+Math.imul(V,lt)|0,e=e+Math.imul(Y,ut)|0,l=l+Math.imul(Y,lt)|0,u=u+Math.imul(G,ct)|0,e=e+Math.imul(G,dt)|0,e=e+Math.imul(W,ct)|0,l=l+Math.imul(W,dt)|0,u=u+Math.imul(Z,pt)|0,e=e+Math.imul(Z,gt)|0,e=e+Math.imul(J,pt)|0,l=l+Math.imul(J,gt)|0,u=u+Math.imul(z,mt)|0,e=e+Math.imul(z,yt)|0,e=e+Math.imul(F,mt)|0,l=l+Math.imul(F,yt)|0,u=u+Math.imul(j,vt)|0,e=e+Math.imul(j,wt)|0,e=e+Math.imul(K,vt)|0,l=l+Math.imul(K,wt)|0;var se=(w+u|0)+((e&8191)<<13)|0;w=(l+(e>>>13)|0)+(se>>>26)|0,se&=67108863,u=Math.imul(X,ut),e=Math.imul(X,lt),e=e+Math.imul(Q,ut)|0,l=Math.imul(Q,lt),u=u+Math.imul(V,ct)|0,e=e+Math.imul(V,dt)|0,e=e+Math.imul(Y,ct)|0,l=l+Math.imul(Y,dt)|0,u=u+Math.imul(G,pt)|0,e=e+Math.imul(G,gt)|0,e=e+Math.imul(W,pt)|0,l=l+Math.imul(W,gt)|0,u=u+Math.imul(Z,mt)|0,e=e+Math.imul(Z,yt)|0,e=e+Math.imul(J,mt)|0,l=l+Math.imul(J,yt)|0,u=u+Math.imul(z,vt)|0,e=e+Math.imul(z,wt)|0,e=e+Math.imul(F,vt)|0,l=l+Math.imul(F,wt)|0;var oe=(w+u|0)+((e&8191)<<13)|0;w=(l+(e>>>13)|0)+(oe>>>26)|0,oe&=67108863,u=Math.imul(X,ct),e=Math.imul(X,dt),e=e+Math.imul(Q,ct)|0,l=Math.imul(Q,dt),u=u+Math.imul(V,pt)|0,e=e+Math.imul(V,gt)|0,e=e+Math.imul(Y,pt)|0,l=l+Math.imul(Y,gt)|0,u=u+Math.imul(G,mt)|0,e=e+Math.imul(G,yt)|0,e=e+Math.imul(W,mt)|0,l=l+Math.imul(W,yt)|0,u=u+Math.imul(Z,vt)|0,e=e+Math.imul(Z,wt)|0,e=e+Math.imul(J,vt)|0,l=l+Math.imul(J,wt)|0;var ae=(w+u|0)+((e&8191)<<13)|0;w=(l+(e>>>13)|0)+(ae>>>26)|0,ae&=67108863,u=Math.imul(X,pt),e=Math.imul(X,gt),e=e+Math.imul(Q,pt)|0,l=Math.imul(Q,gt),u=u+Math.imul(V,mt)|0,e=e+Math.imul(V,yt)|0,e=e+Math.imul(Y,mt)|0,l=l+Math.imul(Y,yt)|0,u=u+Math.imul(G,vt)|0,e=e+Math.imul(G,wt)|0,e=e+Math.imul(W,vt)|0,l=l+Math.imul(W,wt)|0;var he=(w+u|0)+((e&8191)<<13)|0;w=(l+(e>>>13)|0)+(he>>>26)|0,he&=67108863,u=Math.imul(X,mt),e=Math.imul(X,yt),e=e+Math.imul(Q,mt)|0,l=Math.imul(Q,yt),u=u+Math.imul(V,vt)|0,e=e+Math.imul(V,wt)|0,e=e+Math.imul(Y,vt)|0,l=l+Math.imul(Y,wt)|0;var fe=(w+u|0)+((e&8191)<<13)|0;w=(l+(e>>>13)|0)+(fe>>>26)|0,fe&=67108863,u=Math.imul(X,vt),e=Math.imul(X,wt),e=e+Math.imul(Q,vt)|0,l=Math.imul(Q,wt);var ue=(w+u|0)+((e&8191)<<13)|0;return w=(l+(e>>>13)|0)+(ue>>>26)|0,ue&=67108863,m[0]=Zt,m[1]=Jt,m[2]=Gt,m[3]=Wt,m[4]=Vt,m[5]=Yt,m[6]=Xt,m[7]=Qt,m[8]=te,m[9]=ee,m[10]=re,m[11]=ie,m[12]=ne,m[13]=se,m[14]=oe,m[15]=ae,m[16]=he,m[17]=fe,m[18]=ue,w!==0&&(m[19]=w,o.length++),o};Math.imul||(E=k);function C(p,t,r){r.negative=t.negative^p.negative,r.length=p.length+t.length;for(var o=0,h=0,c=0;c<r.length-1;c++){var m=h;h=0;for(var w=o&67108863,u=Math.min(c,t.length-1),e=Math.max(0,c-p.length+1);e<=u;e++){var l=c-e,B=p.words[l]|0,R=t.words[e]|0,T=B*R,q=T&67108863;m=m+(T/67108864|0)|0,q=q+w|0,w=q&67108863,m=m+(q>>>26)|0,h+=m>>>26,m&=67108863}r.words[c]=w,o=m,m=h}return o!==0?r.words[c]=o:r.length--,r.strip()}function I(p,t,r){var o=new D;return o.mulp(p,t,r)}s.prototype.mulTo=function(t,r){var o,h=this.length+t.length;return this.length===10&&t.length===10?o=E(this,t,r):h<63?o=k(this,t,r):h<1024?o=C(this,t,r):o=I(this,t,r),o};function D(p,t){this.x=p,this.y=t}D.prototype.makeRBT=function(t){for(var r=new Array(t),o=s.prototype._countBits(t)-1,h=0;h<t;h++)r[h]=this.revBin(h,o,t);return r},D.prototype.revBin=function(t,r,o){if(t===0||t===o-1)return t;for(var h=0,c=0;c<r;c++)h|=(t&1)<<r-c-1,t>>=1;return h},D.prototype.permute=function(t,r,o,h,c,m){for(var w=0;w<m;w++)h[w]=r[t[w]],c[w]=o[t[w]]},D.prototype.transform=function(t,r,o,h,c,m){this.permute(m,t,r,o,h,c);for(var w=1;w<c;w<<=1)for(var u=w<<1,e=Math.cos(2*Math.PI/u),l=Math.sin(2*Math.PI/u),B=0;B<c;B+=u)for(var R=e,T=l,q=0;q<w;q++){var U=o[B+q],N=h[B+q],At=o[B+q+w],O=h[B+q+w],P=R*At-T*O;O=R*O+T*At,At=P,o[B+q]=U+At,h[B+q]=N+O,o[B+q+w]=U-At,h[B+q+w]=N-O,q!==u&&(P=e*R-l*T,T=e*T+l*R,R=P)}},D.prototype.guessLen13b=function(t,r){var o=Math.max(r,t)|1,h=o&1,c=0;for(o=o/2|0;o;o=o>>>1)c++;return 1<<c+1+h},D.prototype.conjugate=function(t,r,o){if(!(o<=1))for(var h=0;h<o/2;h++){var c=t[h];t[h]=t[o-h-1],t[o-h-1]=c,c=r[h],r[h]=-r[o-h-1],r[o-h-1]=-c}},D.prototype.normalize13b=function(t,r){for(var o=0,h=0;h<r/2;h++){var c=Math.round(t[2*h+1]/r)*8192+Math.round(t[2*h]/r)+o;t[h]=c&67108863,c<67108864?o=0:o=c/67108864|0}return t},D.prototype.convert13b=function(t,r,o,h){for(var c=0,m=0;m<r;m++)c=c+(t[m]|0),o[2*m]=c&8191,c=c>>>13,o[2*m+1]=c&8191,c=c>>>13;for(m=2*r;m<h;++m)o[m]=0;a(c===0),a((c&-8192)===0)},D.prototype.stub=function(t){for(var r=new Array(t),o=0;o<t;o++)r[o]=0;return r},D.prototype.mulp=function(t,r,o){var h=2*this.guessLen13b(t.length,r.length),c=this.makeRBT(h),m=this.stub(h),w=new Array(h),u=new Array(h),e=new Array(h),l=new Array(h),B=new Array(h),R=new Array(h),T=o.words;T.length=h,this.convert13b(t.words,t.length,w,h),this.convert13b(r.words,r.length,l,h),this.transform(w,m,u,e,h,c),this.transform(l,m,B,R,h,c);for(var q=0;q<h;q++){var U=u[q]*B[q]-e[q]*R[q];e[q]=u[q]*R[q]+e[q]*B[q],u[q]=U}return this.conjugate(u,e,h),this.transform(u,e,T,m,h,c),this.conjugate(T,m,h),this.normalize13b(T,h),o.negative=t.negative^r.negative,o.length=t.length+r.length,o.strip()},s.prototype.mul=function(t){var r=new s(null);return r.words=new Array(this.length+t.length),this.mulTo(t,r)},s.prototype.mulf=function(t){var r=new s(null);return r.words=new Array(this.length+t.length),I(this,t,r)},s.prototype.imul=function(t){return this.clone().mulTo(t,this)},s.prototype.imuln=function(t){a(typeof t=="number"),a(t<67108864);for(var r=0,o=0;o<this.length;o++){var h=(this.words[o]|0)*t,c=(h&67108863)+(r&67108863);r>>=26,r+=h/67108864|0,r+=c>>>26,this.words[o]=c&67108863}return r!==0&&(this.words[o]=r,this.length++),this},s.prototype.muln=function(t){return this.clone().imuln(t)},s.prototype.sqr=function(){return this.mul(this)},s.prototype.isqr=function(){return this.imul(this.clone())},s.prototype.pow=function(t){var r=M(t);if(r.length===0)return new s(1);for(var o=this,h=0;h<r.length&&r[h]===0;h++,o=o.sqr());if(++h<r.length)for(var c=o.sqr();h<r.length;h++,c=c.sqr())r[h]!==0&&(o=o.mul(c));return o},s.prototype.iushln=function(t){a(typeof t=="number"&&t>=0);var r=t%26,o=(t-r)/26,h=67108863>>>26-r<<26-r,c;if(r!==0){var m=0;for(c=0;c<this.length;c++){var w=this.words[c]&h,u=(this.words[c]|0)-w<<r;this.words[c]=u|m,m=w>>>26-r}m&&(this.words[c]=m,this.length++)}if(o!==0){for(c=this.length-1;c>=0;c--)this.words[c+o]=this.words[c];for(c=0;c<o;c++)this.words[c]=0;this.length+=o}return this.strip()},s.prototype.ishln=function(t){return a(this.negative===0),this.iushln(t)},s.prototype.iushrn=function(t,r,o){a(typeof t=="number"&&t>=0);var h;r?h=(r-r%26)/26:h=0;var c=t%26,m=Math.min((t-c)/26,this.length),w=67108863^67108863>>>c<<c,u=o;if(h-=m,h=Math.max(0,h),u){for(var e=0;e<m;e++)u.words[e]=this.words[e];u.length=m}if(m!==0)if(this.length>m)for(this.length-=m,e=0;e<this.length;e++)this.words[e]=this.words[e+m];else this.words[0]=0,this.length=1;var l=0;for(e=this.length-1;e>=0&&(l!==0||e>=h);e--){var B=this.words[e]|0;this.words[e]=l<<26-c|B>>>c,l=B&w}return u&&l!==0&&(u.words[u.length++]=l),this.length===0&&(this.words[0]=0,this.length=1),this.strip()},s.prototype.ishrn=function(t,r,o){return a(this.negative===0),this.iushrn(t,r,o)},s.prototype.shln=function(t){return this.clone().ishln(t)},s.prototype.ushln=function(t){return this.clone().iushln(t)},s.prototype.shrn=function(t){return this.clone().ishrn(t)},s.prototype.ushrn=function(t){return this.clone().iushrn(t)},s.prototype.testn=function(t){a(typeof t=="number"&&t>=0);var r=t%26,o=(t-r)/26,h=1<<r;if(this.length<=o)return!1;var c=this.words[o];return!!(c&h)},s.prototype.imaskn=function(t){a(typeof t=="number"&&t>=0);var r=t%26,o=(t-r)/26;if(a(this.negative===0,"imaskn works only with positive numbers"),this.length<=o)return this;if(r!==0&&o++,this.length=Math.min(o,this.length),r!==0){var h=67108863^67108863>>>r<<r;this.words[this.length-1]&=h}return this.strip()},s.prototype.maskn=function(t){return this.clone().imaskn(t)},s.prototype.iaddn=function(t){return a(typeof t=="number"),a(t<67108864),t<0?this.isubn(-t):this.negative!==0?this.length===1&&(this.words[0]|0)<t?(this.words[0]=t-(this.words[0]|0),this.negative=0,this):(this.negative=0,this.isubn(t),this.negative=1,this):this._iaddn(t)},s.prototype._iaddn=function(t){this.words[0]+=t;for(var r=0;r<this.length&&this.words[r]>=67108864;r++)this.words[r]-=67108864,r===this.length-1?this.words[r+1]=1:this.words[r+1]++;return this.length=Math.max(this.length,r+1),this},s.prototype.isubn=function(t){if(a(typeof t=="number"),a(t<67108864),t<0)return this.iaddn(-t);if(this.negative!==0)return this.negative=0,this.iaddn(t),this.negative=1,this;if(this.words[0]-=t,this.length===1&&this.words[0]<0)this.words[0]=-this.words[0],this.negative=1;else for(var r=0;r<this.length&&this.words[r]<0;r++)this.words[r]+=67108864,this.words[r+1]-=1;return this.strip()},s.prototype.addn=function(t){return this.clone().iaddn(t)},s.prototype.subn=function(t){return this.clone().isubn(t)},s.prototype.iabs=function(){return this.negative=0,this},s.prototype.abs=function(){return this.clone().iabs()},s.prototype._ishlnsubmul=function(t,r,o){var h=t.length+o,c;this._expand(h);var m,w=0;for(c=0;c<t.length;c++){m=(this.words[c+o]|0)+w;var u=(t.words[c]|0)*r;m-=u&67108863,w=(m>>26)-(u/67108864|0),this.words[c+o]=m&67108863}for(;c<this.length-o;c++)m=(this.words[c+o]|0)+w,w=m>>26,this.words[c+o]=m&67108863;if(w===0)return this.strip();for(a(w===-1),w=0,c=0;c<this.length;c++)m=-(this.words[c]|0)+w,w=m>>26,this.words[c]=m&67108863;return this.negative=1,this.strip()},s.prototype._wordDiv=function(t,r){var o=this.length-t.length,h=this.clone(),c=t,m=c.words[c.length-1]|0,w=this._countBits(m);o=26-w,o!==0&&(c=c.ushln(o),h.iushln(o),m=c.words[c.length-1]|0);var u=h.length-c.length,e;if(r!=="mod"){e=new s(null),e.length=u+1,e.words=new Array(e.length);for(var l=0;l<e.length;l++)e.words[l]=0}var B=h.clone()._ishlnsubmul(c,1,u);B.negative===0&&(h=B,e&&(e.words[u]=1));for(var R=u-1;R>=0;R--){var T=(h.words[c.length+R]|0)*67108864+(h.words[c.length+R-1]|0);for(T=Math.min(T/m|0,67108863),h._ishlnsubmul(c,T,R);h.negative!==0;)T--,h.negative=0,h._ishlnsubmul(c,1,R),h.isZero()||(h.negative^=1);e&&(e.words[R]=T)}return e&&e.strip(),h.strip(),r!=="div"&&o!==0&&h.iushrn(o),{div:e||null,mod:h}},s.prototype.divmod=function(t,r,o){if(a(!t.isZero()),this.isZero())return{div:new s(0),mod:new s(0)};var h,c,m;return this.negative!==0&&t.negative===0?(m=this.neg().divmod(t,r),r!=="mod"&&(h=m.div.neg()),r!=="div"&&(c=m.mod.neg(),o&&c.negative!==0&&c.iadd(t)),{div:h,mod:c}):this.negative===0&&t.negative!==0?(m=this.divmod(t.neg(),r),r!=="mod"&&(h=m.div.neg()),{div:h,mod:m.mod}):(this.negative&t.negative)!==0?(m=this.neg().divmod(t.neg(),r),r!=="div"&&(c=m.mod.neg(),o&&c.negative!==0&&c.isub(t)),{div:m.div,mod:c}):t.length>this.length||this.cmp(t)<0?{div:new s(0),mod:this}:t.length===1?r==="div"?{div:this.divn(t.words[0]),mod:null}:r==="mod"?{div:null,mod:new s(this.modn(t.words[0]))}:{div:this.divn(t.words[0]),mod:new s(this.modn(t.words[0]))}:this._wordDiv(t,r)},s.prototype.div=function(t){return this.divmod(t,"div",!1).div},s.prototype.mod=function(t){return this.divmod(t,"mod",!1).mod},s.prototype.umod=function(t){return this.divmod(t,"mod",!0).mod},s.prototype.divRound=function(t){var r=this.divmod(t);if(r.mod.isZero())return r.div;var o=r.div.negative!==0?r.mod.isub(t):r.mod,h=t.ushrn(1),c=t.andln(1),m=o.cmp(h);return m<0||c===1&&m===0?r.div:r.div.negative!==0?r.div.isubn(1):r.div.iaddn(1)},s.prototype.modn=function(t){a(t<=67108863);for(var r=(1<<26)%t,o=0,h=this.length-1;h>=0;h--)o=(r*o+(this.words[h]|0))%t;return o},s.prototype.idivn=function(t){a(t<=67108863);for(var r=0,o=this.length-1;o>=0;o--){var h=(this.words[o]|0)+r*67108864;this.words[o]=h/t|0,r=h%t}return this.strip()},s.prototype.divn=function(t){return this.clone().idivn(t)},s.prototype.egcd=function(t){a(t.negative===0),a(!t.isZero());var r=this,o=t.clone();r.negative!==0?r=r.umod(t):r=r.clone();for(var h=new s(1),c=new s(0),m=new s(0),w=new s(1),u=0;r.isEven()&&o.isEven();)r.iushrn(1),o.iushrn(1),++u;for(var e=o.clone(),l=r.clone();!r.isZero();){for(var B=0,R=1;(r.words[0]&R)===0&&B<26;++B,R<<=1);if(B>0)for(r.iushrn(B);B-- >0;)(h.isOdd()||c.isOdd())&&(h.iadd(e),c.isub(l)),h.iushrn(1),c.iushrn(1);for(var T=0,q=1;(o.words[0]&q)===0&&T<26;++T,q<<=1);if(T>0)for(o.iushrn(T);T-- >0;)(m.isOdd()||w.isOdd())&&(m.iadd(e),w.isub(l)),m.iushrn(1),w.iushrn(1);r.cmp(o)>=0?(r.isub(o),h.isub(m),c.isub(w)):(o.isub(r),m.isub(h),w.isub(c))}return{a:m,b:w,gcd:o.iushln(u)}},s.prototype._invmp=function(t){a(t.negative===0),a(!t.isZero());var r=this,o=t.clone();r.negative!==0?r=r.umod(t):r=r.clone();for(var h=new s(1),c=new s(0),m=o.clone();r.cmpn(1)>0&&o.cmpn(1)>0;){for(var w=0,u=1;(r.words[0]&u)===0&&w<26;++w,u<<=1);if(w>0)for(r.iushrn(w);w-- >0;)h.isOdd()&&h.iadd(m),h.iushrn(1);for(var e=0,l=1;(o.words[0]&l)===0&&e<26;++e,l<<=1);if(e>0)for(o.iushrn(e);e-- >0;)c.isOdd()&&c.iadd(m),c.iushrn(1);r.cmp(o)>=0?(r.isub(o),h.isub(c)):(o.isub(r),c.isub(h))}var B;return r.cmpn(1)===0?B=h:B=c,B.cmpn(0)<0&&B.iadd(t),B},s.prototype.gcd=function(t){if(this.isZero())return t.abs();if(t.isZero())return this.abs();var r=this.clone(),o=t.clone();r.negative=0,o.negative=0;for(var h=0;r.isEven()&&o.isEven();h++)r.iushrn(1),o.iushrn(1);do{for(;r.isEven();)r.iushrn(1);for(;o.isEven();)o.iushrn(1);var c=r.cmp(o);if(c<0){var m=r;r=o,o=m}else if(c===0||o.cmpn(1)===0)break;r.isub(o)}while(!0);return o.iushln(h)},s.prototype.invm=function(t){return this.egcd(t).a.umod(t)},s.prototype.isEven=function(){return(this.words[0]&1)===0},s.prototype.isOdd=function(){return(this.words[0]&1)===1},s.prototype.andln=function(t){return this.words[0]&t},s.prototype.bincn=function(t){a(typeof t=="number");var r=t%26,o=(t-r)/26,h=1<<r;if(this.length<=o)return this._expand(o+1),this.words[o]|=h,this;for(var c=h,m=o;c!==0&&m<this.length;m++){var w=this.words[m]|0;w+=c,c=w>>>26,w&=67108863,this.words[m]=w}return c!==0&&(this.words[m]=c,this.length++),this},s.prototype.isZero=function(){return this.length===1&&this.words[0]===0},s.prototype.cmpn=function(t){var r=t<0;if(this.negative!==0&&!r)return-1;if(this.negative===0&&r)return 1;this.strip();var o;if(this.length>1)o=1;else{r&&(t=-t),a(t<=67108863,"Number is too big");var h=this.words[0]|0;o=h===t?0:h<t?-1:1}return this.negative!==0?-o|0:o},s.prototype.cmp=function(t){if(this.negative!==0&&t.negative===0)return-1;if(this.negative===0&&t.negative!==0)return 1;var r=this.ucmp(t);return this.negative!==0?-r|0:r},s.prototype.ucmp=function(t){if(this.length>t.length)return 1;if(this.length<t.length)return-1;for(var r=0,o=this.length-1;o>=0;o--){var h=this.words[o]|0,c=t.words[o]|0;if(h!==c){h<c?r=-1:h>c&&(r=1);break}}return r},s.prototype.gtn=function(t){return this.cmpn(t)===1},s.prototype.gt=function(t){return this.cmp(t)===1},s.prototype.gten=function(t){return this.cmpn(t)>=0},s.prototype.gte=function(t){return this.cmp(t)>=0},s.prototype.ltn=function(t){return this.cmpn(t)===-1},s.prototype.lt=function(t){return this.cmp(t)===-1},s.prototype.lten=function(t){return this.cmpn(t)<=0},s.prototype.lte=function(t){return this.cmp(t)<=0},s.prototype.eqn=function(t){return this.cmpn(t)===0},s.prototype.eq=function(t){return this.cmp(t)===0},s.red=function(t){return new H(t)},s.prototype.toRed=function(t){return a(!this.red,"Already a number in reduction context"),a(this.negative===0,"red works only with positives"),t.convertTo(this)._forceRed(t)},s.prototype.fromRed=function(){return a(this.red,"fromRed works only with numbers in reduction context"),this.red.convertFrom(this)},s.prototype._forceRed=function(t){return this.red=t,this},s.prototype.forceRed=function(t){return a(!this.red,"Already a number in reduction context"),this._forceRed(t)},s.prototype.redAdd=function(t){return a(this.red,"redAdd works only with red numbers"),this.red.add(this,t)},s.prototype.redIAdd=function(t){return a(this.red,"redIAdd works only with red numbers"),this.red.iadd(this,t)},s.prototype.redSub=function(t){return a(this.red,"redSub works only with red numbers"),this.red.sub(this,t)},s.prototype.redISub=function(t){return a(this.red,"redISub works only with red numbers"),this.red.isub(this,t)},s.prototype.redShl=function(t){return a(this.red,"redShl works only with red numbers"),this.red.shl(this,t)},s.prototype.redMul=function(t){return a(this.red,"redMul works only with red numbers"),this.red._verify2(this,t),this.red.mul(this,t)},s.prototype.redIMul=function(t){return a(this.red,"redMul works only with red numbers"),this.red._verify2(this,t),this.red.imul(this,t)},s.prototype.redSqr=function(){return a(this.red,"redSqr works only with red numbers"),this.red._verify1(this),this.red.sqr(this)},s.prototype.redISqr=function(){return a(this.red,"redISqr works only with red numbers"),this.red._verify1(this),this.red.isqr(this)},s.prototype.redSqrt=function(){return a(this.red,"redSqrt works only with red numbers"),this.red._verify1(this),this.red.sqrt(this)},s.prototype.redInvm=function(){return a(this.red,"redInvm works only with red numbers"),this.red._verify1(this),this.red.invm(this)},s.prototype.redNeg=function(){return a(this.red,"redNeg works only with red numbers"),this.red._verify1(this),this.red.neg(this)},s.prototype.redPow=function(t){return a(this.red&&!t.red,"redPow(normalNum)"),this.red._verify1(this),this.red.pow(this,t)};var Mt={k256:null,p224:null,p192:null,p25519:null};function xt(p,t){this.name=p,this.p=new s(t,16),this.n=this.p.bitLength(),this.k=new s(1).iushln(this.n).isub(this.p),this.tmp=this._tmp()}xt.prototype._tmp=function(){var t=new s(null);return t.words=new Array(Math.ceil(this.n/13)),t},xt.prototype.ireduce=function(t){var r=t,o;do this.split(r,this.tmp),r=this.imulK(r),r=r.iadd(this.tmp),o=r.bitLength();while(o>this.n);var h=o<this.n?-1:r.ucmp(this.p);return h===0?(r.words[0]=0,r.length=1):h>0?r.isub(this.p):r.strip!==void 0?r.strip():r._strip(),r},xt.prototype.split=function(t,r){t.iushrn(this.n,0,r)},xt.prototype.imulK=function(t){return t.imul(this.k)};function Ht(){xt.call(this,"k256","ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f")}y(Ht,xt),Ht.prototype.split=function(t,r){for(var o=4194303,h=Math.min(t.length,9),c=0;c<h;c++)r.words[c]=t.words[c];if(r.length=h,t.length<=9){t.words[0]=0,t.length=1;return}var m=t.words[9];for(r.words[r.length++]=m&o,c=10;c<t.length;c++){var w=t.words[c]|0;t.words[c-10]=(w&o)<<4|m>>>22,m=w}m>>>=22,t.words[c-10]=m,m===0&&t.length>10?t.length-=10:t.length-=9},Ht.prototype.imulK=function(t){t.words[t.length]=0,t.words[t.length+1]=0,t.length+=2;for(var r=0,o=0;o<t.length;o++){var h=t.words[o]|0;r+=h*977,t.words[o]=r&67108863,r=h*64+(r/67108864|0)}return t.words[t.length-1]===0&&(t.length--,t.words[t.length-1]===0&&t.length--),t};function Ee(){xt.call(this,"p224","ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001")}y(Ee,xt);function Ae(){xt.call(this,"p192","ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff")}y(Ae,xt);function Ft(){xt.call(this,"25519","7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed")}y(Ft,xt),Ft.prototype.imulK=function(t){for(var r=0,o=0;o<t.length;o++){var h=(t.words[o]|0)*19+r,c=h&67108863;h>>>=26,t.words[o]=c,r=h}return r!==0&&(t.words[t.length++]=r),t},s._prime=function(t){if(Mt[t])return Mt[t];var r;if(t==="k256")r=new Ht;else if(t==="p224")r=new Ee;else if(t==="p192")r=new Ae;else if(t==="p25519")r=new Ft;else throw new Error("Unknown prime "+t);return Mt[t]=r,r};function H(p){if(typeof p=="string"){var t=s._prime(p);this.m=t.p,this.prime=t}else a(p.gtn(1),"modulus must be greater than 1"),this.m=p,this.prime=null}H.prototype._verify1=function(t){a(t.negative===0,"red works only with positives"),a(t.red,"red works only with red numbers")},H.prototype._verify2=function(t,r){a((t.negative|r.negative)===0,"red works only with positives"),a(t.red&&t.red===r.red,"red works only with red numbers")},H.prototype.imod=function(t){return this.prime?this.prime.ireduce(t)._forceRed(this):t.umod(this.m)._forceRed(this)},H.prototype.neg=function(t){return t.isZero()?t.clone():this.m.sub(t)._forceRed(this)},H.prototype.add=function(t,r){this._verify2(t,r);var o=t.add(r);return o.cmp(this.m)>=0&&o.isub(this.m),o._forceRed(this)},H.prototype.iadd=function(t,r){this._verify2(t,r);var o=t.iadd(r);return o.cmp(this.m)>=0&&o.isub(this.m),o},H.prototype.sub=function(t,r){this._verify2(t,r);var o=t.sub(r);return o.cmpn(0)<0&&o.iadd(this.m),o._forceRed(this)},H.prototype.isub=function(t,r){this._verify2(t,r);var o=t.isub(r);return o.cmpn(0)<0&&o.iadd(this.m),o},H.prototype.shl=function(t,r){return this._verify1(t),this.imod(t.ushln(r))},H.prototype.imul=function(t,r){return this._verify2(t,r),this.imod(t.imul(r))},H.prototype.mul=function(t,r){return this._verify2(t,r),this.imod(t.mul(r))},H.prototype.isqr=function(t){return this.imul(t,t.clone())},H.prototype.sqr=function(t){return this.mul(t,t)},H.prototype.sqrt=function(t){if(t.isZero())return t.clone();var r=this.m.andln(3);if(a(r%2===1),r===3){var o=this.m.add(new s(1)).iushrn(2);return this.pow(t,o)}for(var h=this.m.subn(1),c=0;!h.isZero()&&h.andln(1)===0;)c++,h.iushrn(1);a(!h.isZero());var m=new s(1).toRed(this),w=m.redNeg(),u=this.m.subn(1).iushrn(1),e=this.m.bitLength();for(e=new s(2*e*e).toRed(this);this.pow(e,u).cmp(w)!==0;)e.redIAdd(w);for(var l=this.pow(e,h),B=this.pow(t,h.addn(1).iushrn(1)),R=this.pow(t,h),T=c;R.cmp(m)!==0;){for(var q=R,U=0;q.cmp(m)!==0;U++)q=q.redSqr();a(U<T);var N=this.pow(l,new s(1).iushln(T-U-1));B=B.redMul(N),l=N.redSqr(),R=R.redMul(l),T=U}return B},H.prototype.invm=function(t){var r=t._invmp(this.m);return r.negative!==0?(r.negative=0,this.imod(r).redNeg()):this.imod(r)},H.prototype.pow=function(t,r){if(r.isZero())return new s(1).toRed(this);if(r.cmpn(1)===0)return t.clone();var o=4,h=new Array(1<<o);h[0]=new s(1).toRed(this),h[1]=t;for(var c=2;c<h.length;c++)h[c]=this.mul(h[c-1],t);var m=h[0],w=0,u=0,e=r.bitLength()%26;for(e===0&&(e=26),c=r.length-1;c>=0;c--){for(var l=r.words[c],B=e-1;B>=0;B--){var R=l>>B&1;if(m!==h[0]&&(m=this.sqr(m)),R===0&&w===0){u=0;continue}w<<=1,w|=R,u++,!(u!==o&&(c!==0||B!==0))&&(m=this.mul(m,h[w]),u=0,w=0)}e=26}return m},H.prototype.convertTo=function(t){var r=t.umod(this.m);return r===t?r.clone():r},H.prototype.convertFrom=function(t){var r=t.clone();return r.red=null,r},s.mont=function(t){return new Ct(t)};function Ct(p){H.call(this,p),this.shift=this.m.bitLength(),this.shift%26!==0&&(this.shift+=26-this.shift%26),this.r=new s(1).iushln(this.shift),this.r2=this.imod(this.r.sqr()),this.rinv=this.r._invmp(this.m),this.minv=this.rinv.mul(this.r).isubn(1).div(this.m),this.minv=this.minv.umod(this.r),this.minv=this.r.sub(this.minv)}y(Ct,H),Ct.prototype.convertTo=function(t){return this.imod(t.ushln(this.shift))},Ct.prototype.convertFrom=function(t){var r=this.imod(t.mul(this.rinv));return r.red=null,r},Ct.prototype.imul=function(t,r){if(t.isZero()||r.isZero())return t.words[0]=0,t.length=1,t;var o=t.imul(r),h=o.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),c=o.isub(h).iushrn(this.shift),m=c;return c.cmp(this.m)>=0?m=c.isub(this.m):c.cmpn(0)<0&&(m=c.iadd(this.m)),m._forceRed(this)},Ct.prototype.mul=function(t,r){if(t.isZero()||r.isZero())return new s(0)._forceRed(this);var o=t.mul(r),h=o.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),c=o.isub(h).iushrn(this.shift),m=c;return c.cmp(this.m)>=0?m=c.isub(this.m):c.cmpn(0)<0&&(m=c.iadd(this.m)),m._forceRed(this)},Ct.prototype.invm=function(t){var r=this.imod(t._invmp(this.m).mul(this.r2));return r._forceRed(this)}})(b,Xr)}(jt)),jt.exports}var we,sr;function br(){if(sr)return we;sr=1;const b=qt(),i=xr(),n=xe().DecoderBuffer,a=wr(),y=Mr();function s(v){this.enc="der",this.name=v.name,this.entity=v,this.tree=new _,this.tree._init(v.body)}we=s,s.prototype.decode=function(f,g){return n.isDecoderBuffer(f)||(f=new n(f,g)),this.tree._decode(f,g)};function _(v){a.call(this,"der",v)}b(_,a),_.prototype._peekTag=function(f,g,d){if(f.isEmpty())return!1;const M=f.save(),k=x(f,'Failed to peek tag: "'+g+'"');return f.isError(k)?k:(f.restore(M),k.tag===g||k.tagStr===g||k.tagStr+"of"===g||d)},_.prototype._decodeTag=function(f,g,d){const M=x(f,'Failed to decode tag of "'+g+'"');if(f.isError(M))return M;let k=S(f,M.primitive,'Failed to get length of "'+g+'"');if(f.isError(k))return k;if(!d&&M.tag!==g&&M.tagStr!==g&&M.tagStr+"of"!==g)return f.error('Failed to match tag: "'+g+'"');if(M.primitive||k!==null)return f.skip(k,'Failed to match body of: "'+g+'"');const E=f.save(),C=this._skipUntilEnd(f,'Failed to skip indefinite length body: "'+this.tag+'"');return f.isError(C)?C:(k=f.offset-E.offset,f.restore(E),f.skip(k,'Failed to match body of: "'+g+'"'))},_.prototype._skipUntilEnd=function(f,g){for(;;){const d=x(f,g);if(f.isError(d))return d;const M=S(f,d.primitive,g);if(f.isError(M))return M;let k;if(d.primitive||M!==null?k=f.skip(M):k=this._skipUntilEnd(f,g),f.isError(k))return k;if(d.tagStr==="end")break}},_.prototype._decodeList=function(f,g,d,M){const k=[];for(;!f.isEmpty();){const E=this._peekTag(f,"end");if(f.isError(E))return E;const C=d.decode(f,"der",M);if(f.isError(C)&&E)break;k.push(C)}return k},_.prototype._decodeStr=function(f,g){if(g==="bitstr"){const d=f.readUInt8();return f.isError(d)?d:{unused:d,data:f.raw()}}else if(g==="bmpstr"){const d=f.raw();if(d.length%2===1)return f.error("Decoding of string type: bmpstr length mismatch");let M="";for(let k=0;k<d.length/2;k++)M+=String.fromCharCode(d.readUInt16BE(k*2));return M}else if(g==="numstr"){const d=f.raw().toString("ascii");return this._isNumstr(d)?d:f.error("Decoding of string type: numstr unsupported characters")}else{if(g==="octstr")return f.raw();if(g==="objDesc")return f.raw();if(g==="printstr"){const d=f.raw().toString("ascii");return this._isPrintstr(d)?d:f.error("Decoding of string type: printstr unsupported characters")}else return/str$/.test(g)?f.raw().toString():f.error("Decoding of string type: "+g+" unsupported")}},_.prototype._decodeObjid=function(f,g,d){let M;const k=[];let E=0,C=0;for(;!f.isEmpty();)C=f.readUInt8(),E<<=7,E|=C&127,(C&128)===0&&(k.push(E),E=0);C&128&&k.push(E);const I=k[0]/40|0,D=k[0]%40;if(d?M=k:M=[I,D].concat(k.slice(1)),g){let Mt=g[M.join(" ")];Mt===void 0&&(Mt=g[M.join(".")]),Mt!==void 0&&(M=Mt)}return M},_.prototype._decodeTime=function(f,g){const d=f.raw().toString();let M,k,E,C,I,D;if(g==="gentime")M=d.slice(0,4)|0,k=d.slice(4,6)|0,E=d.slice(6,8)|0,C=d.slice(8,10)|0,I=d.slice(10,12)|0,D=d.slice(12,14)|0;else if(g==="utctime")M=d.slice(0,2)|0,k=d.slice(2,4)|0,E=d.slice(4,6)|0,C=d.slice(6,8)|0,I=d.slice(8,10)|0,D=d.slice(10,12)|0,M<70?M=2e3+M:M=1900+M;else return f.error("Decoding "+g+" time is not supported yet");return Date.UTC(M,k-1,E,C,I,D,0)},_.prototype._decodeNull=function(){return null},_.prototype._decodeBool=function(f){const g=f.readUInt8();return f.isError(g)?g:g!==0},_.prototype._decodeInt=function(f,g){const d=f.raw();let M=new i(d);return g&&(M=g[M.toString(10)]||M),M},_.prototype._use=function(f,g){return typeof f=="function"&&(f=f(g)),f._getDecoder("der").tree};function x(v,f){let g=v.readUInt8(f);if(v.isError(g))return g;const d=y.tagClass[g>>6],M=(g&32)===0;if((g&31)===31){let E=g;for(g=0;(E&128)===128;){if(E=v.readUInt8(f),v.isError(E))return E;g<<=7,g|=E&127}}else g&=31;const k=y.tag[g];return{cls:d,primitive:M,tag:g,tagStr:k}}function S(v,f,g){let d=v.readUInt8(g);if(v.isError(d))return d;if(!f&&d===128)return null;if((d&128)===0)return d;const M=d&127;if(M>4)return v.error("length octect is too long");d=0;for(let k=0;k<M;k++){d<<=8;const E=v.readUInt8(g);if(v.isError(E))return E;d|=E}return d}return we}var Me,or;function Qr(){if(or)return Me;or=1;const b=qt(),i=be().Buffer,n=br();function a(y){n.call(this,y),this.enc="pem"}return b(a,n),Me=a,a.prototype.decode=function(s,_){const x=s.toString().split(/[\r\n]+/g),S=_.label.toUpperCase(),v=/^-----(BEGIN|END) ([^-]+)-----$/;let f=-1,g=-1;for(let k=0;k<x.length;k++){const E=x[k].match(v);if(E!==null&&E[2]===S)if(f===-1){if(E[1]!=="BEGIN")break;f=k}else{if(E[1]!=="END")break;g=k;break}}if(f===-1||g===-1)throw new Error("PEM section not found for: "+S);const d=x.slice(f+1,g).join("");d.replace(/[^a-z0-9+/=]+/gi,"");const M=i.from(d,"base64");return n.prototype.decode.call(this,M,_)},Me}var ar;function ti(){return ar||(ar=1,function(b){const i=b;i.der=br(),i.pem=Qr()}(ve)),ve}var hr;function ei(){return hr||(hr=1,function(b){const i=Yr(),n=ti(),a=qt(),y=b;y.define=function(x,S){return new s(x,S)};function s(_,x){this.name=_,this.body=x,this.decoders={},this.encoders={}}s.prototype._createNamed=function(x){const S=this.name;function v(f){this._initNamed(f,S)}return a(v,x),v.prototype._initNamed=function(g,d){x.call(this,g,d)},new v(this)},s.prototype._getDecoder=function(x){return x=x||"der",this.decoders.hasOwnProperty(x)||(this.decoders[x]=this._createNamed(n[x])),this.decoders[x]},s.prototype.decode=function(x,S,v){return this._getDecoder(S).decode(x,v)},s.prototype._getEncoder=function(x){return x=x||"der",this.encoders.hasOwnProperty(x)||(this.encoders[x]=this._createNamed(i[x])),this.encoders[x]},s.prototype.encode=function(x,S,v){return this._getEncoder(S).encode(x,v)}}(le)),le}var ri=ei();const ii=ur(ri);var ni=xr();const kr=ur(ni),Dt=ii.define,si=Dt("RSAPublicKey",function(){this.seq().obj(this.key("n").int(),this.key("e").int())}),Sr=Dt("AlgorithmIdentifier",function(){this.seq().obj(this.key("algorithm").objid(),this.key("parameters").optional().any())});Dt("PublicKeyInfo",function(){this.seq().obj(this.key("algorithm").use(Sr),this.key("publicKey").bitstr())});const Er=Dt("Version",function(){this.int({0:"two-prime",1:"multi"})}),oi=Dt("OtherPrimeInfos",function(){this.seq().obj(this.key("ri").int(),this.key("di").int(),this.key("ti").int())}),ai=Dt("RSAPrivateKey",function(){this.seq().obj(this.key("version").use(Er),this.key("n").int(),this.key("e").int(),this.key("d").int(),this.key("p").int(),this.key("q").int(),this.key("dp").int(),this.key("dq").int(),this.key("qi").int(),this.key("other").optional().use(oi))});Dt("PrivateKeyInfo",function(){this.seq().obj(this.key("version").use(Er),this.key("algorithm").use(Sr),this.key("privateKey").bitstr())});function hi(b){return{n:Bt(b.n),e:Bt(b.e),d:b.d&&Bt(b.d),p:b.p&&Bt(b.p),q:b.q&&Bt(b.q),dp:b.dp&&Bt(b.dp),dq:b.dq&&Bt(b.dq),qi:b.qi&&Bt(b.qi)}}function fi(b){return new kr(zt.Buffer.from(b,"base64"))}function Bt(b){return/^[0-9]+$/.test(b)?new kr(b,10):fi(b)}function _i(b){const i=hi(b),n=!!i.d,a=n?"PRIVATE":"PUBLIC",y="-----BEGIN RSA "+a+` KEY-----
`,s=`
-----END RSA `+a+` KEY-----
`;let _=zt.Buffer.alloc(0);n?(i.version="two-prime",_=ai.encode(i,"der")):_=si.encode(i,"der");const x=_.toString("base64").match(/.{1,64}/g).join(`
`);return y+x+s}export{yr as A,Nr as W,Tt as c,_i as j,_t as s};

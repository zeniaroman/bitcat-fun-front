import{a as pt}from"./vendor-vue-router-PmQVL-xb.js";import{s as Y}from"./index-BFwD7SI8.js";import{w as rt,v as it}from"./vendor-vue/runtime-dom-Ll8vq9eS.js";import{a as O}from"./vendor-axios-Hz4xvOoZ.js";import{T as gt}from"./solana-vendors-DGPAp7Fj.js";import{A as yt}from"./Toast-CHOcTYnn.js";import{_ as $}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r as u,b as Z}from"./vendor-vue/reactivity-CqT5sv9X.js";import{c as x,E as tt,h as n,i as e,k as p,j as C,F as J,l as G,e as K,r as S,o,m as P,H as dt,b as vt,J as bt}from"./vendor-vue/runtime-core-CL52-QWR.js";import{t as d,b as W}from"./vendor-vue/shared-lLteBOIO.js";import{u as ct}from"./vendor-vuex-KmQPsw4D.js";import"./vendor-vuex-router-sync-DE8Azp4R.js";import"./vendor-socket.io-client-Bfvk10tG.js";import"./vendor-engine.io-client-sigXSzQJ.js";import"./vendor-engine.io-parser-BiEtp6m2.js";import"./vendor-socket.io/component-emitter-Dkula2eQ.js";import"./vendor-socket.io-parser-Cuf20g09.js";import"./vendor-buffer-DVXvU5G6.js";import"./vendor-base64-js-C2zTC7ec.js";import"./vendor-ieee754-vIlwft-x.js";import"./vendor-events-cQ9mhZQJ.js";import"./vendor-process-DXjpGiAn.js";import"./vendor-lodash.isequal-D20p4pc-.js";import"./vendor-elliptic-BTxzAQL_.js";import"./vendor-minimalistic-assert-OF9c2MWr.js";import"./vendor-minimalistic-crypto-utils-DpWPKLSp.js";import"./vendor-brorand-6pV8Y5jC.js";import"./vendor-crypto-browserify-NMg_40A5.js";import"./vendor-randombytes-ndKo2FAH.js";import"./vendor-safe-buffer-BPihLaHX.js";import"./vendor-create-hash-BsmGkCgx.js";import"./vendor-inherits-BICa84dG.js";import"./vendor-md5.js-BmCTTIue.js";import"./vendor-hash-base-CXljNKss.js";import"./vendor-readable-stream-BpYOL4VF.js";import"./vendor-asn1.js-Cgb4HcA4.js";import"./vendor-util-deprecate-C5bwERXh.js";import"./vendor-string_decoder-CzqD1_ea.js";import"./vendor-ripemd160-B-g9_ZaO.js";import"./vendor-sha.js-C_Iv65sP.js";import"./vendor-cipher-base-CVoreX1z.js";import"./vendor-stream-browserify-BiXhMpOM.js";import"./vendor-create-hmac-Dt8PQ7js.js";import"./vendor-browserify-sign-DLX2f2Lw.js";import"./vendor-process-nextick-args-DZA8cFXf.js";import"./vendor-core-util-is-OG-hh3cz.js";import"./vendor-browserify-rsa-DRghgnJS.js";import"./vendor-bn.js-CN51n21Z.js";import"./vendor-parse-asn1-CnRUGrVC.js";import"./vendor-evp_bytestokey-V5JLH1pP.js";import"./vendor-browserify-aes-Dzp1Wr7h.js";import"./vendor-buffer-xor-BGVZWPAd.js";import"./vendor-pbkdf2-D8c51p7I.js";import"./vendor-browserify-cipher-CRpPeA_V.js";import"./vendor-browserify-des-7ZFmx5Md.js";import"./vendor-des.js-DyWMuwdI.js";import"./vendor-diffie-hellman-CdruneMD.js";import"./vendor-miller-rabin-D60nYGZr.js";import"./vendor-create-ecdh-D3sJE6Oq.js";import"./vendor-public-encrypt-BRl7BMPZ.js";import"./vendor-randomfill-PyDjCq6P.js";import"./vendor-hash.js-Dda3EUYz.js";import"./vendor-hmac-drbg-Ss9liF53.js";import"./vendor-vueuse/core-Dowf-keF.js";import"./vendor-vueuse/shared-D4hqHlE2.js";import"./vendor-eventemitter3-C1FPriCL.js";import"./vendor-bignumber.js-Dj_rIxHg.js";import"./vendor-bigint-buffer-5mUCZ2jv.js";import"./vendor-noble/ed25519-DHS8bCE8.js";import"./vendor-node-fetch-DFwHyKwz.js";import"./vendor-url-Fv_L5Bhg.js";import"./vendor-qs-CKXrMD_V.js";import"./vendor-side-channel-CjkecZmv.js";import"./vendor-es-errors-CxTyLFAO.js";import"./vendor-object-inspect-C0kqJKki.js";import"./vendor-side-channel-list-DJbPV7dX.js";import"./vendor-side-channel-map-OCAkmCSB.js";import"./vendor-get-intrinsic-Ci-jyTpD.js";import"./vendor-es-object-atoms-BR76m4z7.js";import"./vendor-math-intrinsics-DP1tGiab.js";import"./vendor-gopd-C1lCZ5Qs.js";import"./vendor-es-define-property-D_7cP-M3.js";import"./vendor-has-symbols-CySAGvJ4.js";import"./vendor-get-proto-BI0zWv-p.js";import"./vendor-dunder-proto-5sdYuMkY.js";import"./vendor-call-bind-apply-helpers-BfAPCzjd.js";import"./vendor-function-bind-CHqF18-c.js";import"./vendor-hasown-CH2RbkDu.js";import"./vendor-call-bound-nPIHF2bX.js";import"./vendor-side-channel-weakmap-D938crsm.js";import"./vendor-whatwg-url-BNoC3hI6.js";import"./vendor-webidl-conversions-DuBT_cRJ.js";import"./vendor-punycode-BGZJxaHx.js";import"./vendor-tr46-_6nBz5KS.js";import"./vendor-mime-DOJa-gVj.js";import"./vendor-assert-CCtLV3vt.js";import"./vendor-util-BEO2nGWh.js";import"./vendor-is-arguments-D-oLGwWh.js";import"./vendor-has-tostringtag-BU9GnA_1.js";import"./vendor-is-generator-function-Bk_W3rfd.js";import"./vendor-safe-regex-test-BtqTbUmV.js";import"./vendor-is-regex-BKTFpgjH.js";import"./vendor-which-typed-array-Bufg-IXZ.js";import"./vendor-for-each-HvIZAWYy.js";import"./vendor-is-callable-BYFz_UGF.js";import"./vendor-available-typed-arrays-uQGnJldC.js";import"./vendor-possible-typed-array-names-BKRybAhF.js";import"./vendor-call-bind-3YpglFCb.js";import"./vendor-set-function-length-Cm7PFPrZ.js";import"./vendor-define-data-property-BppnLwnj.js";import"./vendor-has-property-descriptors-ChC8uhsk.js";import"./vendor-is-typed-array-CZaxorcA.js";import"./vendor-object.assign-D0NKsUk4.js";import"./vendor-object-keys-BRu_Tray.js";import"./vendor-object-is-DkNyiNMZ.js";import"./vendor-define-properties-CgTwYkbs.js";import"./vendor-is-nan-BtAA6g8u.js";import"./vendor-debug-DLVl9QA3.js";import"./vendor-ms-CzQ2E3wO.js";import"./vendor-babel/runtime-w7AU6ifp.js";import"./vendor-js-sha3-DkKfOMXT.js";import"./vendor-typescript-collections-DaJ0MJpz.js";import"./vendor-lodash.clonedeep-C3jeG2fR.js";import"./vendor-ansicolors-BFAL4nhq.js";import"./vendor-bs58-DhqqakFZ.js";import"./vendor-base-x-BHV1Xppf.js";import"./vendor-base64url-D1J1q9RC.js";import"./vendor-arbundles-CR3XhIxB.js";import"./vendor-async-retry-DWdC6xTk.js";import"./vendor-retry-ByBYrtbW.js";import"./vendor-irys/arweave-CO_npObX.js";import"./vendor-safer-buffer-CIAg7E_-.js";import"./vendor-secp256k1-gx_3s_gH.js";import"./vendor-keccak-Bl_8Z6TM.js";import"./vendor-ethersproject/bytes-BFUO92dS.js";import"./vendor-ethersproject/logger-BIOSViGG.js";import"./vendor-ethersproject/wallet-_-D8aoNy.js";import"./vendor-ethersproject/address-C-94Rlzo.js";import"./vendor-ethersproject/keccak256-BpI13PIi.js";import"./vendor-ethersproject/rlp-L8r_OHwd.js";import"./vendor-ethersproject/bignumber-DuyZ-PBD.js";import"./vendor-ethersproject/abstract-provider-BJATZ19F.js";import"./vendor-ethersproject/properties-Bism-GXA.js";import"./vendor-ethersproject/abstract-signer-vaofOY7d.js";import"./vendor-ethersproject/strings-BqJBhWqj.js";import"./vendor-ethersproject/hdnode-De1GriMn.js";import"./vendor-ethersproject/basex-GbQJAx3e.js";import"./vendor-ethersproject/signing-key-DZY4IiDE.js";import"./vendor-ethersproject/sha2-C3DRumhS.js";import"./vendor-ethersproject/wordlists-Bgp1_tq6.js";import"./vendor-ethersproject/pbkdf2-RF0eycJB.js";import"./vendor-ethersproject/json-wallets-DmRppK22.js";import"./vendor-aes-js-CVO7b-af.js";import"./vendor-scrypt-js-pU08l4Iy.js";import"./vendor-ethersproject/random-UwHXQyRf.js";import"./vendor-ethersproject/hash-CaQkUgof.js";import"./vendor-ethersproject/transactions-DgEmUiir.js";import"./vendor-irys/sdk-zMcAFY0m.js";import"./vendor-irys/query-BJ-9co3k.js";import"./vendor-near-js/crypto-DYaHgGqH.js";import"./vendor-borsh-uT6VLZDJ.js";import"./vendor-text-encoding-utf-8-CyyJ4wbt.js";import"./vendor-tweetnacl-DH0kfJ7g.js";import"./vendor-crypto-js-TDtrdbi3.js";import"./vendor-near-js/types-BW5UzBhQ.js";import"./vendor-near-js/keystores-browser-C7Ipq7jt.js";import"./vendor-near-js/keystores-DZ_AKmgs.js";import"./vendor-near-js/transactions-CNW8gb_X.js";import"./vendor-js-sha256-J9Bkl3or.js";import"./vendor-ethersproject/contracts-BfB5cMkz.js";import"./vendor-ethersproject/abi-BZPj2eRn.js";import"./vendor-ethersproject/constants-DnPC-4nq.js";import"./vendor-aptos-COdaePwy.js";import"./vendor-scure/base-BmqIkRj2.js";import"./vendor-supercharge/promise-pool-CxlJr3BL.js";import"./vendor-noble/curves-Bi3lEKLw.js";import"./vendor-noble/hashes-DJrKYuPd.js";import"./vendor-jayson-C-feTq4c.js";import"./vendor-uuid-42xqzRtG.js";import"./vendor-rpc-websockets-CS_NMCMZ.js";import"./vendor-vue/devtools-api-Cow_pXkh.js";const _t={name:"AvailableNfts",components:{AppToast:yt},props:{},setup(){const y=u(!0),t=u(!1),b=u([]),s=u(""),_=u(10),v=Z({}),c=Z({}),r=u(!1),a=u(null),m=u(null),w=u(null),T=u(null),f=u(null),R=u(null),M=Z({show:!1,message:"",type:"info",duration:5e3}),k=x(()=>Y.getters.isAuthenticated),N=x(()=>Y.getters.walletAddress),L=x(()=>Y.getters.userTag),E=x(()=>b.value.filter(i=>{const l=i.name&&i.name.toLowerCase().includes(s.value.toLowerCase()),g=parseFloat(i.dayPrice)<=_.value;return l&&g}).sort((i,l)=>parseFloat(i.dayPrice)-parseFloat(l.dayPrice))),I=async()=>{try{y.value=!0;const i=await O.get("/nft-rental/all",{params:{available_for_rent:1}});b.value=i.data}catch(i){console.error("Error fetching available NFTs:",i)}finally{y.value=!1}},z=()=>{I()},et=i=>parseFloat(i).toFixed(3),F=i=>i||"Unknown",U=i=>{const l=Math.min(i,7);return Array.from({length:l},(g,h)=>h+1)},D=i=>{const g={1:0,2:5,3:10,4:15,5:18,6:22,7:25}[i]||0;return g>0?`(-${g}%)`:""},j=i=>{const l=new Date;return l.setDate(l.getDate()+parseInt(i)),l.toLocaleDateString()},st=i=>i?new Date(i).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):"",B=i=>{const l=v[i.id];if(!l)return;const h={1:0,2:5,3:10,4:15,5:18,6:22,7:25}[l]||0,V=(100-h)/100,H=parseFloat(i.dayPrice),A=H*V,q=A*l,ft=q*.05;c[i.id]={days:l,discountPercent:h,originalDailyPrice:H,discountedDailyPrice:A,totalPrice:q,platformFee:ft}},Q=i=>{if(console.log("Comparing nft.userTag:",i.userTag,"with userTag:",L.value),!i.userTag||!L.value)return!1;const l=i.userTag.toLowerCase().trim(),g=L.value.toLowerCase().trim();return console.log("Normalized comparison:",l,"===",g),l===g},at=i=>{if(k.value){if(Q(i)){M.type="error",M.message="You cannot rent your own NFT",M.show=!0;return}a.value=i,m.value=null,r.value=!0,X(i)}},X=async i=>{var l,g;if(!(!i||!v[i.id]))try{const h=await O.post("/nft-rental/rent",{rentalId:i.id,days:v[i.id],renterWallet:Y.getters.walletAddress},{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});m.value=h.data.rental}catch(h){console.error("Error fetching rent transaction info:",h),M.type="error",M.message=`Failed to get rental information: ${((g=(l=h.response)==null?void 0:l.data)==null?void 0:g.error)||h.message||"Unknown error"}`,M.show=!0}},ot=()=>{T.value!=="pending"&&(r.value=!1,a.value=null,m.value=null,T.value=null,f.value=null,R.value=null)},nt=()=>{T.value=null,f.value=null,R.value=null},ut=async()=>{var i,l;if(!(!a.value||!v[a.value.id]||!m.value))try{t.value=!0,T.value=null,f.value=null,R.value=null;const g=await O.post("/nft-rental/rent",{rentalId:a.value.id,days:v[a.value.id],renterWallet:Y.getters.walletAddress},{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}}),{transaction:h}=g.data,V=Uint8Array.from(atob(h),A=>A.charCodeAt(0)),H=gt.from(V);T.value="pending";try{const A=window.solana;if(!A)throw new Error("Phantom wallet not found");const q=await A.signAndSendTransaction(H);f.value=q.signature;const ft=await O.post("/nft-rental/confirm",{rentalId:a.value.id,signature:q.signature,rentedBy:Y.state.userTag,days:v[a.value.id]},{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});m.value&&(m.value.days=v[a.value.id]),T.value="success",setTimeout(async()=>{await Y.dispatch("fetchRentalHistory")},2e3),setTimeout(()=>{v[a.value.id]="",I()},500)}catch(A){console.error("Transaction error:",A),T.value="error",R.value=A.message||"Failed to sign or confirm transaction"}}catch(g){console.error("Rent error:",g),T.value="error",R.value=((l=(i=g.response)==null?void 0:i.data)==null?void 0:l.error)||g.message||"Failed to create rental transaction"}finally{t.value=!1}},mt=i=>{w.value=w.value===i?null:i},lt=(i,l)=>{v[i.id]=l,B(i),w.value=null};return tt(()=>{I(),b.value.forEach(i=>{v[i.id]||(v[i.id]=1,B(i))}),document.addEventListener("click",i=>{w.value!==null&&!i.target.closest(".custom-select")&&(w.value=null)})}),{loading:y,rentLoading:t,nfts:b,filteredNfts:E,searchQuery:s,maxPriceFilter:_,rentDays:v,discountInfo:c,showRentModal:r,selectedNft:a,currentRentalInfo:m,isAuthenticated:k,walletAddress:N,userTag:L,toast:M,refreshData:z,formatPrice:et,formatUserTag:F,getRentDaysOptions:U,getDiscountText:D,calculateEndDate:j,formatDate:st,selectedDaysChanged:B,rentNft:at,closeRentModal:ot,confirmRent:ut,isOwnNft:Q,openDropdown:w,toggleDropdown:mt,selectDays:lt,retryRental:nt,transactionStatus:T,transactionSignature:f,transactionError:R}}},Tt={class:"available-nfts"},ht={key:1,class:"loading-container"},wt={key:2,class:"empty-state"},kt={key:3,class:"nft-grid"},Nt={class:"nft-image-container"},Ft=["src","alt"],Rt={class:"nft-info"},Pt={class:"nft-name"},Dt={class:"nft-owner"},Mt={class:"nft-price"},Ct={class:"price-amount"},Lt={class:"nft-details"},At={class:"detail-item"},St={class:"detail-value"},xt={key:0,class:"rent-controls"},Et={key:0,class:"own-nft-message"},It={key:1,class:"rent-options"},Ut={class:"rental-period"},Bt=["onClick"],Ot={class:"selected-option"},zt={key:0,class:"options-dropdown"},Vt=["onClick"],Ht=["onClick","disabled"],Yt={key:1,class:"auth-message"},Kt={key:2,class:"discount-info"},Wt={class:"discount-row"},jt={class:"discount-value"},Jt={key:0,class:"discount-row discount"},Qt={class:"discount-value"},Xt={class:"discount-row total"},qt={class:"discount-label"},Gt={class:"discount-value"},Zt={key:0},$t={key:0,class:"rental-summary"},te={class:"summary-item"},ee={class:"summary-value"},se={class:"summary-item"},ae={class:"summary-value"},oe={class:"summary-item"},ne={class:"summary-value"},le={key:0,class:"summary-item discount"},re={class:"summary-value"},ie={key:1,class:"summary-item"},de={class:"summary-value"},ce={class:"summary-item total"},ue={class:"summary-value"},me={class:"summary-item end-date"},ve={class:"summary-value"},ye={key:1,class:"loading-info"},fe={class:"modal-actions"},pe=["disabled"],ge={key:0,class:"loading-spinner small"},be={key:1},_e={key:1},Te={class:"transaction-processing"},he={class:"transaction-info"},we={class:"pending-details"},ke={class:"pending-detail"},Ne={class:"pending-detail"},Fe={key:2},Re={class:"transaction-success"},Pe={class:"rental-summary success-summary"},De={class:"summary-item"},Me={class:"summary-value"},Ce={class:"summary-item"},Le={class:"summary-value"},Ae={class:"summary-item"},Se={class:"summary-value"},xe={class:"summary-item"},Ee={class:"summary-value"},Ie={class:"summary-item"},Ue=["href"],Be={class:"modal-actions success-actions"},Oe={key:3},ze={class:"transaction-error"},Ve={class:"error-content"},He={class:"error-message"},Ye={class:"modal-actions error-actions"};function Ke(y,t,b,s,_,v){const c=S("router-link"),r=S("AppToast");return o(),n("div",Tt,[t[48]||(t[48]=e("h2",{class:"section-title"},"Available NFTs for Rent",-1)),p("",!0),s.loading?(o(),n("div",ht,t[11]||(t[11]=[e("div",{class:"loading-spinner"},null,-1),e("p",null,"Loading available NFTs...",-1)]))):s.filteredNfts.length===0?(o(),n("div",wt,[t[12]||(t[12]=e("p",null,"No NFTs available for rent right now.",-1)),e("button",{onClick:t[2]||(t[2]=(...a)=>s.refreshData&&s.refreshData(...a)),class:"refresh-btn"},"Refresh")])):(o(),n("div",kt,[(o(!0),n(J,null,G(s.filteredNfts,a=>(o(),n("div",{key:a.id,class:"nft-card"},[e("div",Nt,[e("img",{src:a.imageUrl||"/images/default-nft.png",alt:a.name,class:"nft-image"},null,8,Ft)]),e("div",Rt,[e("h3",Pt,[C(c,{to:`/nft/${a.nftMint}`},{default:K(()=>[P(d(a.name||"Unnamed NFT"),1)]),_:2},1032,["to"])]),e("p",Dt,[t[13]||(t[13]=P("Owner: ")),C(c,{to:`/player/${a.userTag}`},{default:K(()=>[P(d(s.formatUserTag(a.userTag)),1)]),_:2},1032,["to"])]),e("div",Mt,[t[14]||(t[14]=e("span",{class:"price-label"},"Daily Price:",-1)),e("span",Ct,d(s.formatPrice(a.dayPrice))+" SOL",1)]),e("div",Lt,[e("div",At,[t[15]||(t[15]=e("span",{class:"detail-label"},"Max rental duration:",-1)),e("span",St,d(a.maxDays)+" day(s)",1)])]),s.isAuthenticated&&s.walletAddress?(o(),n("div",xt,[a.userTag===s.userTag?(o(),n("div",Et,t[16]||(t[16]=[e("div",{class:"own-nft-label"},"Your Listed NFT",-1),e("p",{class:"own-nft-description"},"This NFT is listed by you for rent",-1)]))):p("",!0),a.userTag!==s.userTag?(o(),n("div",It,[e("div",Ut,[t[17]||(t[17]=e("label",{for:"rental-days",class:"rental-period-label"},"Rental period:",-1)),e("div",{class:W(["custom-select",{"is-open":s.openDropdown===a.id}]),onClick:m=>s.toggleDropdown(a.id)},[e("div",Ot,d(s.rentDays[a.id]?`${s.rentDays[a.id]} day${s.rentDays[a.id]>1?"s":""} ${s.getDiscountText(s.rentDays[a.id])}`:"Select period"),1),s.openDropdown===a.id?(o(),n("div",zt,[(o(!0),n(J,null,G(s.getRentDaysOptions(a.maxDays),m=>(o(),n("div",{key:m,class:W(["option",{selected:s.rentDays[a.id]===m}]),onClick:rt(w=>s.selectDays(a,m),["stop"])},d(m)+" day"+d(m>1?"s":"")+" "+d(s.getDiscountText(m)),11,Vt))),128))])):p("",!0)],10,Bt)]),e("button",{onClick:m=>s.rentNft(a),class:"rent-button",disabled:!s.rentDays[a.id]}," Rent NFT ",8,Ht)])):p("",!0)])):(o(),n("div",Yt,t[18]||(t[18]=[e("p",null,"Please connect your wallet to rent NFTs",-1)]))),s.rentDays[a.id]&&s.discountInfo[a.id]&&a.userTag!==s.userTag?(o(),n("div",Kt,[e("div",Wt,[t[19]||(t[19]=e("span",{class:"discount-label"},"Base price:",-1)),e("span",jt,d(s.formatPrice(a.dayPrice))+" SOL/day",1)]),s.discountInfo[a.id].discountPercent>0?(o(),n("div",Jt,[t[20]||(t[20]=e("span",{class:"discount-label"},"Discount:",-1)),e("span",Qt,"-"+d(s.discountInfo[a.id].discountPercent)+"% OFF",1)])):p("",!0),e("div",Xt,[e("span",qt,"Total for "+d(s.rentDays[a.id])+" days:",1),e("span",Gt,d(s.formatPrice(s.discountInfo[a.id].totalPrice))+" SOL",1)])])):p("",!0)])]))),128))])),s.showRentModal?(o(),n("div",{key:4,class:"modal-overlay",onClick:t[9]||(t[9]=(...a)=>s.closeRentModal&&s.closeRentModal(...a))},[e("div",{class:"modal-content",onClick:t[8]||(t[8]=rt(()=>{},["stop"]))},[s.transactionStatus?s.transactionStatus==="pending"?(o(),n("div",_e,[t[35]||(t[35]=e("h3",{class:"modal-title pending-title"},"Processing Transaction",-1)),e("div",Te,[t[33]||(t[33]=e("div",{class:"loading-spinner pending-spinner"},null,-1)),t[34]||(t[34]=e("p",{class:"pending-message"},"Your rental transaction is being processed...",-1)),e("div",he,[t[32]||(t[32]=e("p",{class:"small-text"},"Please wait while we confirm your transaction on the Solana blockchain.",-1)),e("div",we,[e("div",ke,[t[30]||(t[30]=e("span",{class:"detail-icon"},"💰",-1)),e("span",null,d(s.formatPrice(s.currentRentalInfo.subtotal))+" SOL",1)]),e("div",Ne,[t[31]||(t[31]=e("span",{class:"detail-icon"},"⏱️",-1)),e("span",null,d(s.rentDays[s.selectedNft.id])+" days rental",1)])])])])])):s.transactionStatus==="success"?(o(),n("div",Fe,[t[44]||(t[44]=e("h3",{class:"modal-title success-title"},"Rental Successful!",-1)),e("div",Re,[t[41]||(t[41]=e("div",{class:"success-icon-container"},[e("div",{class:"success-icon"},"✓")],-1)),e("div",Pe,[e("div",De,[t[36]||(t[36]=e("span",{class:"summary-label"},"NFT:",-1)),e("span",Me,d(s.selectedNft.name),1)]),e("div",Ce,[t[37]||(t[37]=e("span",{class:"summary-label"},"Rental Period:",-1)),e("span",Le,d(s.currentRentalInfo.days)+" days",1)]),e("div",Ae,[t[38]||(t[38]=e("span",{class:"summary-label"},"Total Cost:",-1)),e("span",Se,d(s.formatPrice(s.currentRentalInfo.subtotal))+" SOL",1)]),e("div",xe,[t[39]||(t[39]=e("span",{class:"summary-label"},"Rental End Date:",-1)),e("span",Ee,d(s.formatDate(s.currentRentalInfo.rentalEndTime)),1)]),e("div",Ie,[t[40]||(t[40]=e("span",{class:"summary-label"},"Transaction:",-1)),e("a",{href:`https://explorer.solana.com/tx/${s.transactionSignature}`,target:"_blank",class:"transaction-link"}," View on Solana Explorer ",8,Ue)])]),t[42]||(t[42]=e("p",{class:"success-message"},'Your rented NFT is now available in the "My Rented NFTs" tab.',-1))]),e("div",Be,[e("button",{onClick:t[5]||(t[5]=(...a)=>s.closeRentModal&&s.closeRentModal(...a)),class:"cancel-button"},"Close"),C(c,{to:`/nft/${s.selectedNft.nftMint}`,class:"view-nft-button"},{default:K(()=>t[43]||(t[43]=[P(" Open NFT Page ")])),_:1},8,["to"])])])):s.transactionStatus==="error"?(o(),n("div",Oe,[t[47]||(t[47]=e("h3",{class:"modal-title error-title"},"Rental Failed",-1)),e("div",ze,[t[46]||(t[46]=e("div",{class:"error-icon-container"},[e("div",{class:"error-icon"},"✗")],-1)),e("div",Ve,[e("p",He,d(s.transactionError||"There was an error processing your rental transaction."),1),t[45]||(t[45]=e("div",{class:"error-details"},[e("p",{class:"small-text"},"Please try again or contact support if the problem persists.")],-1))])]),e("div",Ye,[e("button",{onClick:t[6]||(t[6]=(...a)=>s.closeRentModal&&s.closeRentModal(...a)),class:"cancel-button"},"Close"),e("button",{onClick:t[7]||(t[7]=(...a)=>s.retryRental&&s.retryRental(...a)),class:"retry-button"},"Try Again")])])):p("",!0):(o(),n("div",Zt,[t[29]||(t[29]=e("h3",null,"Confirm NFT Rental",-1)),s.selectedNft&&s.currentRentalInfo?(o(),n("div",$t,[e("div",te,[t[21]||(t[21]=e("span",{class:"summary-label"},"NFT:",-1)),e("span",ee,d(s.selectedNft.name),1)]),e("div",se,[t[22]||(t[22]=e("span",{class:"summary-label"},"Rental Period:",-1)),e("span",ae,d(s.rentDays[s.selectedNft.id])+" days",1)]),e("div",oe,[t[23]||(t[23]=e("span",{class:"summary-label"},"Original Daily Price:",-1)),e("span",ne,d(s.formatPrice(s.selectedNft.dayPrice))+" SOL",1)]),s.currentRentalInfo.discountPercent>0?(o(),n("div",le,[t[24]||(t[24]=e("span",{class:"summary-label"},"Discount:",-1)),e("span",re,d(s.currentRentalInfo.discountPercent)+"% OFF",1)])):p("",!0),s.currentRentalInfo.discountPercent>0?(o(),n("div",ie,[t[25]||(t[25]=e("span",{class:"summary-label"},"Discounted Daily Price:",-1)),e("span",de,d(s.formatPrice(s.currentRentalInfo.discountedDailyPrice))+" SOL",1)])):p("",!0),e("div",ce,[t[26]||(t[26]=e("span",{class:"summary-label"},"Total Cost:",-1)),e("span",ue,d(s.formatPrice(s.currentRentalInfo.subtotal))+" SOL",1)]),e("div",me,[t[27]||(t[27]=e("span",{class:"summary-label"},"Rental End Date:",-1)),e("span",ve,d(s.formatDate(s.currentRentalInfo.rentalEndTime)),1)])])):s.selectedNft?(o(),n("div",ye,t[28]||(t[28]=[e("div",{class:"loading-spinner small"},null,-1),e("p",null,"Loading rental details...",-1)]))):p("",!0),e("div",fe,[e("button",{onClick:t[3]||(t[3]=(...a)=>s.closeRentModal&&s.closeRentModal(...a)),class:"cancel-button"},"Cancel"),e("button",{onClick:t[4]||(t[4]=(...a)=>s.confirmRent&&s.confirmRent(...a)),disabled:s.rentLoading,class:"confirm-button"},[s.rentLoading?(o(),n("span",ge)):(o(),n("span",be,"Confirm Rental"))],8,pe)])]))])])):p("",!0),C(r,{show:s.toast.show,message:s.toast.message,type:s.toast.type,onClose:t[10]||(t[10]=a=>s.toast.show=!1),duration:s.toast.duration},null,8,["show","message","type","duration"])])}const We=$(_t,[["render",Ke],["__scopeId","data-v-faf56f1c"]]),je={name:"MyListedNfts",components:{AppToast:yt},props:{wallet:{type:String,default:""},userTag:{type:String,default:""}},setup(y,{emit:t}){ct();const b=u(!0),s=u([]),_=Z({}),v=u(!1),c=u(null),r=u(!1),a=u(!1),m=u(""),w=u(""),T=u(""),f=u(""),R=u(!1),M=u(null),k=u(null),N=Z({show:!1,message:"",type:"info",duration:5e3}),L=u(!1),E=u({dayPrice:"",maxDays:""}),I=u(!1),z=u(null),et=x(()=>!!y.wallet&&!!y.userTag),F=async()=>{if(!et.value){s.value=[];return}try{b.value=!0;const l=await O.get(`/nft-rental/user/${y.userTag}`,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});s.value=l.data}catch(l){console.error("Error fetching listed NFTs:",l),N.type="error",N.message="Failed to load your listed NFTs",N.show=!0}finally{b.value=!1}},U=l=>parseFloat(l).toFixed(3),D=l=>l?new Date(l).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):"",j=l=>!l.availableForRent&&l.rentedBy?"Rented":l.availableForRent?l.availableForRent?"Available":"Unavailable":"Paused",st=l=>!l.availableForRent&&l.rentedBy?"status-rented":l.availableForRent?l.availableForRent?"status-available":"status-unavailable":"status-paused",B=l=>{c.value=l,v.value=!0},Q=()=>{v.value=!1,c.value=null},at=async()=>{var l,g;if(c.value)try{r.value=!0,_[c.value.id]=!0,await O.post("/nft-rental/cancel",{rentalId:c.value.id,userTag:y.userTag},{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}}),s.value=s.value.filter(h=>h.id!==c.value.id),Q()}catch(h){console.error("Error cancelling rental listing:",h),N.type="error",N.message=`Failed to cancel listing: ${((g=(l=h.response)==null?void 0:l.data)==null?void 0:g.error)||h.message||"Unknown error"}`,N.show=!0}finally{r.value=!1,c.value&&(_[c.value.id]=!1)}},X=async(l,g)=>{var h,V;try{if((await O.put(`/nft-rental/listings/${l}/availability`,{available_for_rent:g?1:0},{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}})).data.success){const A=s.value.findIndex(q=>q.id===l);A!==-1&&(s.value[A].availableForRent=g?1:0)}}catch(H){console.error("Error updating NFT availability:",H),N.type="error",N.message=((V=(h=H.response)==null?void 0:h.data)==null?void 0:V.error)||"Failed to update NFT availability",N.show=!0}},ot=(l,g)=>{M.value=l,k.value=g,g?(m.value="Open NFT for Rental",w.value="By opening this NFT for rental, it will become available for anyone to rent. Are you sure you want to proceed?",T.value="Open Rental",f.value="open"):(m.value="Close NFT Rental",w.value="By closing this NFT for rental, it will no longer be available for new rentals. If the NFT is currently rented, the current rental will continue until its end date. Are you sure you want to proceed?",T.value="Close Rental",f.value="close"),a.value=!0},nt=()=>{a.value=!1,M.value=null,k.value=null,R.value=!1},ut=async()=>{if(!(!M.value||k.value===null))try{R.value=!0,await X(M.value,k.value),nt()}catch(l){console.error("Error confirming availability change:",l)}},mt=l=>{z.value=l,E.value={dayPrice:l.dayPrice,maxDays:l.maxDays},L.value=!0},lt=()=>{L.value=!1,z.value=null,E.value={dayPrice:"",maxDays:""},I.value=!1},i=async()=>{var l,g;if(z.value)try{if(I.value=!0,(await O.put(`/nft-rental/listings/${z.value.id}/parameters`,E.value,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}})).data.success){const V=s.value.findIndex(H=>H.id===z.value.id);V!==-1&&(s.value[V].dayPrice=E.value.dayPrice,s.value[V].maxDays=E.value.maxDays),lt()}}catch(h){console.error("Error updating rental parameters:",h),N.type="error",N.message=((g=(l=h.response)==null?void 0:l.data)==null?void 0:g.error)||"Failed to update rental parameters",N.show=!0}finally{I.value=!1}};return tt(()=>{F()}),{loading:b,listedNfts:s,cancelLoading:_,showCancelModal:v,confirmCancelLoading:r,isAuthenticated:et,formatPrice:U,formatDate:D,getRentalStatus:j,getRentalStatusClass:st,cancelListing:B,closeCancelModal:Q,confirmCancel:at,updateAvailability:X,showAvailabilityModal:a,availabilityModalTitle:m,availabilityModalMessage:w,availabilityModalAction:T,availabilityModalType:f,availabilityLoading:R,selectedNftId:M,selectedAvailability:k,openAvailabilityModal:ot,closeAvailabilityModal:nt,confirmAvailabilityChange:ut,showUpdateParametersModal:L,updateParameters:E,toast:N,updateParametersLoading:I,selectedNftForUpdate:z,openUpdateParametersModal:mt,closeUpdateParametersModal:lt,confirmUpdateParameters:i}}},Je={class:"my-listed-nfts"},Qe={key:0,class:"auth-message"},Xe={key:1,class:"loading-container"},qe={key:2,class:"empty-state"},Ge={key:3,class:"nft-grid"},Ze={class:"nft-image-container"},$e=["src","alt"],ts={class:"nft-info"},es={class:"nft-name"},ss={class:"nft-price"},as={class:"price-amount"},os={class:"nft-details"},ns={class:"detail-item"},ls={class:"detail-value"},rs={class:"detail-item"},is={key:0,class:"detail-item"},ds={key:1,class:"detail-item"},cs={class:"detail-value"},us={class:"nft-actions"},ms=["onClick"],vs=["onClick"],ys=["onClick"],fs={class:"modal-actions"},ps=["disabled"],gs={key:0,class:"loading-spinner small"},bs={key:1},_s={class:"form-group"},Ts={class:"form-group"},hs={class:"modal-actions"},ws=["disabled"],ks={key:0,class:"loading-spinner small"},Ns={key:1};function Fs(y,t,b,s,_,v){const c=S("router-link"),r=S("AppToast");return o(),n(J,null,[e("div",Je,[t[22]||(t[22]=e("h2",{class:"section-title"},"My Listed NFTs",-1)),s.isAuthenticated?s.loading?(o(),n("div",Xe,t[12]||(t[12]=[e("div",{class:"loading-spinner"},null,-1),e("p",null,"Loading your listed NFTs...",-1)]))):s.listedNfts.length===0?(o(),n("div",qe,t[13]||(t[13]=[e("p",null,[P("You haven't listed any NFTs for rent yet."),e("br"),P("List an NFT for Rent")],-1)]))):(o(),n("div",Ge,[(o(!0),n(J,null,G(s.listedNfts,a=>(o(),n("div",{key:a.id,class:"nft-card"},[e("div",Ze,[e("img",{src:a.imageUrl||"/images/default-nft.png",alt:a.name,class:"nft-image"},null,8,$e)]),e("div",ts,[e("h3",es,[C(c,{to:`/nft/${a.nftMint}`},{default:K(()=>[P(d(a.name||"Unnamed NFT"),1)]),_:2},1032,["to"])]),e("div",ss,[t[14]||(t[14]=e("span",{class:"price-label"},"Daily Price:",-1)),e("span",as,d(s.formatPrice(a.dayPrice))+" SOL",1)]),e("div",os,[e("div",ns,[t[15]||(t[15]=e("span",{class:"detail-label"},"Max Rental Period:",-1)),e("span",ls,d(a.maxDays)+" days",1)]),e("div",rs,[t[16]||(t[16]=e("span",{class:"detail-label"},"Status:",-1)),e("span",{class:W(["status-badge",s.getRentalStatusClass(a)])},d(s.getRentalStatus(a)),3)]),a.rentedBy?(o(),n("div",is,[t[17]||(t[17]=e("span",{class:"detail-label"},"Rented By:",-1)),C(c,{to:`/player/${a.rentedBy}`,class:"detail-value"},{default:K(()=>[P(d(a.rentedBy),1)]),_:2},1032,["to"])])):p("",!0),a.rentalEndTime?(o(),n("div",ds,[t[18]||(t[18]=e("span",{class:"detail-label"},"Rental Ends:",-1)),e("span",cs,d(s.formatDate(a.rentalEndTime)),1)])):p("",!0)]),e("div",us,[a.availableForRent?(o(),n("button",{key:0,onClick:m=>s.openAvailabilityModal(a.id,!1),class:"close-rental-button"}," Close Rental ",8,ms)):(o(),n("button",{key:1,onClick:m=>s.openAvailabilityModal(a.id,!0),class:"open-rental-button"}," Open Rental ",8,vs)),e("button",{onClick:m=>s.openUpdateParametersModal(a),class:"update-parameters-button"}," Update Rental ",8,ys)])])]))),128))])):(o(),n("div",Qe,t[11]||(t[11]=[e("p",null,"Please connect your wallet to view your listed NFTs.",-1)]))),s.showAvailabilityModal?(o(),n("div",{key:4,class:"modal-overlay",onClick:t[3]||(t[3]=(...a)=>s.closeAvailabilityModal&&s.closeAvailabilityModal(...a))},[e("div",{class:"modal-content",onClick:t[2]||(t[2]=rt(()=>{},["stop"]))},[e("h3",null,d(s.availabilityModalTitle),1),e("p",null,d(s.availabilityModalMessage),1),e("div",fs,[e("button",{onClick:t[0]||(t[0]=(...a)=>s.closeAvailabilityModal&&s.closeAvailabilityModal(...a)),class:"secondary-button"},"Cancel"),e("button",{onClick:t[1]||(t[1]=(...a)=>s.confirmAvailabilityChange&&s.confirmAvailabilityChange(...a)),disabled:s.availabilityLoading,class:W(["primary-button",s.availabilityModalType])},[s.availabilityLoading?(o(),n("span",gs)):(o(),n("span",bs,d(s.availabilityModalAction),1))],10,ps)])])])):p("",!0),s.showUpdateParametersModal?(o(),n("div",{key:5,class:"modal-overlay",onClick:t[9]||(t[9]=(...a)=>s.closeUpdateParametersModal&&s.closeUpdateParametersModal(...a))},[e("div",{class:"modal-content",onClick:t[8]||(t[8]=rt(()=>{},["stop"]))},[t[21]||(t[21]=e("h3",null,"Update Rental Parameters",-1)),e("div",_s,[t[19]||(t[19]=e("label",{for:"dayPrice"},"Daily Price (SOL)",-1)),dt(e("input",{type:"number",id:"dayPrice","onUpdate:modelValue":t[4]||(t[4]=a=>s.updateParameters.dayPrice=a),min:"0.001",step:"0.001",class:"form-input"},null,512),[[it,s.updateParameters.dayPrice]])]),e("div",Ts,[t[20]||(t[20]=e("label",{for:"maxDays"},"Maximum Rental Period (days)",-1)),dt(e("input",{type:"number",id:"maxDays","onUpdate:modelValue":t[5]||(t[5]=a=>s.updateParameters.maxDays=a),min:"1",step:"1",class:"form-input"},null,512),[[it,s.updateParameters.maxDays]])]),e("div",hs,[e("button",{onClick:t[6]||(t[6]=(...a)=>s.closeUpdateParametersModal&&s.closeUpdateParametersModal(...a)),class:"secondary-button"},"Cancel"),e("button",{onClick:t[7]||(t[7]=(...a)=>s.confirmUpdateParameters&&s.confirmUpdateParameters(...a)),disabled:s.updateParametersLoading,class:"primary-button update"},[s.updateParametersLoading?(o(),n("span",ks)):(o(),n("span",Ns,"Update Parameters"))],8,ws)])])])):p("",!0)]),C(r,{show:s.toast.show,message:s.toast.message,type:s.toast.type,onClose:t[10]||(t[10]=a=>s.toast.show=!1),duration:s.toast.duration},null,8,["show","message","type","duration"])],64)}const Rs=$(je,[["render",Fs],["__scopeId","data-v-5e0912e2"]]),Ps={name:"MyRentedNfts",props:{wallet:{type:String,default:""},userTag:{type:String,default:""}},setup(y){ct(),pt();const t=u(!0),b=u([]),s=x(()=>!!y.wallet&&!!y.userTag),_=async()=>{if(!s.value){b.value=[];return}try{t.value=!0;const f=await O.get(`/nft-rental/rented-by/${y.userTag}`,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});b.value=f.data}catch(f){console.error("Error fetching rented NFTs:",f)}finally{t.value=!1}},v=f=>parseFloat(f).toFixed(3),c=f=>f?new Date(f).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):"",r=f=>{const R=new Date,k=new Date(f.rentalEndTime)-R;if(k<=0)return"Expired";const N=Math.floor(k/(1e3*60*60*24)),L=Math.floor(k%(1e3*60*60*24)/(1e3*60*60));if(N>0)return`${N}d ${L}h left`;{const E=Math.floor(k%36e5/6e4);return`${L}h ${E}m left`}},a=f=>{const R=new Date,k=new Date(f.rentalEndTime)-R;return k<=0?"expired":Math.floor(k/(1e3*60*60*24))<=1?"expiring-soon":"active"},m=f=>{const R=new Date,k=new Date(f.rentalEndTime)-R;return k<=0?!1:Math.floor(k/(1e3*60*60*24))<=2},w=f=>{const R=`https://explorer.solana.com/tx/${f}`;window.open(R,"_blank")},T=()=>{window.dispatchEvent(new CustomEvent("switch-tab",{detail:"available"}))};return tt(()=>{_();const f=setInterval(()=>{b.value.length>0&&(b.value=[...b.value])},6e4);return()=>{clearInterval(f)}}),{loading:t,rentedNfts:b,isAuthenticated:s,formatPrice:v,formatDate:c,getTimeRemaining:r,getTimeRemainingClass:a,isRentalExpiring:m,viewTransaction:w,goToAvailableNfts:T}}},Ds={class:"my-rented-nfts"},Ms={key:0,class:"auth-message"},Cs={key:1,class:"loading-container"},Ls={key:2,class:"empty-state"},As={key:3,class:"nft-grid"},Ss={class:"nft-image-container"},xs=["src","alt"],Es={class:"nft-info"},Is={class:"nft-name"},Us={class:"nft-details"},Bs={class:"detail-item"},Os={class:"detail-item"},zs={class:"detail-value"},Vs={class:"detail-item"},Hs={class:"detail-value"},Ys={class:"transaction-info"},Ks=["onClick"],Ws={class:"nft-actions"};function js(y,t,b,s,_,v){const c=S("router-link");return o(),n("div",Ds,[t[8]||(t[8]=e("h2",{class:"section-title"},"My Rented NFTs",-1)),s.isAuthenticated?s.loading?(o(),n("div",Cs,t[2]||(t[2]=[e("div",{class:"loading-spinner"},null,-1),e("p",null,"Loading your rented NFTs...",-1)]))):s.rentedNfts.length===0?(o(),n("div",Ls,[t[3]||(t[3]=e("p",null,"You haven't rented any NFTs yet.",-1)),e("button",{onClick:t[0]||(t[0]=(...r)=>s.goToAvailableNfts&&s.goToAvailableNfts(...r)),class:"primary-button"},"Browse Available NFTs")])):(o(),n("div",As,[(o(!0),n(J,null,G(s.rentedNfts,r=>(o(),n("div",{key:r.id,class:"nft-card"},[e("div",Ss,[e("img",{src:r.imageUrl||"/images/default-nft.png",alt:r.name,class:"nft-image"},null,8,xs),e("div",{class:W(["time-remaining-badge",s.getTimeRemainingClass(r)])},d(s.getTimeRemaining(r)),3)]),e("div",Es,[e("h3",Is,d(r.name||"Unnamed NFT"),1),e("div",Us,[e("div",Bs,[t[4]||(t[4]=e("span",{class:"detail-label"},"Owner:",-1)),C(c,{to:`/player/${r.userTag}`,class:"detail-value"},{default:K(()=>[P(d(r.userTag),1)]),_:2},1032,["to"])]),e("div",Os,[t[5]||(t[5]=e("span",{class:"detail-label"},"Daily Price:",-1)),e("span",zs,d(s.formatPrice(r.dayPrice))+" SOL",1)]),e("div",Vs,[t[6]||(t[6]=e("span",{class:"detail-label"},"Rental End:",-1)),e("span",Hs,d(s.formatDate(r.rentalEndTime)),1)])]),e("div",Ys,[r.transactionSignature?(o(),n("button",{key:0,onClick:a=>s.viewTransaction(r.transactionSignature),class:"view-tx-button"}," View Transaction ",8,Ks)):p("",!0)]),e("div",Ws,[C(c,{to:`/nft/${r.mint}`,class:"view-details-button"},{default:K(()=>t[7]||(t[7]=[P(" View NFT Details ")])),_:2},1032,["to"])])])]))),128))])):(o(),n("div",Ms,t[1]||(t[1]=[e("p",null,"Please connect your wallet to view your rented NFTs.",-1)])))])}const Js=$(Ps,[["render",js],["__scopeId","data-v-a600b160"]]),Qs={name:"RentalHistory",setup(){const y=ct(),t=u(!0),b=x(()=>y.getters.nftRentalHistory),s=async()=>{try{t.value=!0,await y.dispatch("fetchRentalHistory")}catch(a){console.error("Error fetching rental history:",a)}finally{t.value=!1}},_=a=>a?`${a.substring(0,4)}...${a.substring(a.length-4)}`:"-",v=a=>parseFloat(a).toFixed(3),c=a=>a?new Date(a).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):"",r=a=>{const m=`https://explorer.solana.com/tx/${a}`;window.open(m,"_blank")};return tt(()=>{s()}),{loading:t,formatPrice:v,formatDate:c,shortenAddress:_,viewTransaction:r,nftRentalHistory:b}}},Xs={class:"rental-history"},qs={key:0,class:"loading-container"},Gs={key:1,class:"empty-state"},Zs={key:2,class:"rental-history-grid"},$s={class:"rental-card-header"},ta={class:"rental-price"},ea=["onClick"],sa={class:"rental-card-body"},aa={class:"rental-detail-row"},oa={class:"rental-detail-row"},na={class:"rental-detail-row"},la={class:"detail-label"};function ra(y,t,b,s,_,v){const c=S("router-link");return o(),n("div",Xs,[t[7]||(t[7]=e("h2",{class:"section-title"},"Rental History",-1)),t[8]||(t[8]=e("p",{class:"section-subtitle"},"Last 20 rented NFTs",-1)),s.loading?(o(),n("div",qs,t[0]||(t[0]=[e("div",{class:"loading-spinner"},null,-1),e("p",null,"Loading rental history...",-1)]))):s.nftRentalHistory.length===0?(o(),n("div",Gs,t[1]||(t[1]=[e("p",null,"No rental history available yet.",-1)]))):(o(),n("div",Zs,[(o(!0),n(J,null,G(s.nftRentalHistory,r=>(o(),n("div",{key:r.id,class:"rental-card"},[e("div",$s,[e("div",ta,[t[2]||(t[2]=e("i",{class:"fas fa-coins"},null,-1)),P(" "+d(s.formatPrice(r.price))+" SOL ",1)]),r.transaction?(o(),n("button",{key:0,onClick:a=>s.viewTransaction(r.transaction),class:"view-tx-button"},t[3]||(t[3]=[e("i",{class:"fas fa-receipt"},null,-1),P(" TX ")]),8,ea)):p("",!0)]),e("div",sa,[e("div",aa,[t[4]||(t[4]=e("span",{class:"detail-label"},[e("i",{class:"fas fa-image"}),P(" NFT:")],-1)),C(c,{to:`/nft/${r.mint}`,class:"nft-link"},{default:K(()=>[P(d(s.shortenAddress(r.mint)),1)]),_:2},1032,["to"])]),e("div",oa,[t[5]||(t[5]=e("span",{class:"detail-label"},[e("i",{class:"fas fa-user"}),P(" Rented By:")],-1)),C(c,{to:`/player/${r.rentedBy}`,class:"user-link"},{default:K(()=>[P(d(r.rentedBy),1)]),_:2},1032,["to"])]),e("div",na,[e("span",la,[t[6]||(t[6]=e("i",{class:"fas fa-calendar-day"},null,-1)),P(" "+d(s.formatDate(r.startDate))+" for "+d(r.days)+" day(s)",1)])])])]))),128))]))])}const ia=$(Qs,[["render",ra],["__scopeId","data-v-66ee1aa4"]]),da={name:"ListNftForRent",components:{AppToast:yt},props:{wallet:{type:String,default:""},userTag:{type:String,default:""}},emits:["nft-listed"],setup(y,{emit:t}){ct();const b=u(!0),s=u(!1),_=u([]),v=u(null),c=u("0.1"),r=u(7),a=Z({show:!1,message:"",type:"info",duration:5e3}),m=u(""),w=u(""),T=u(""),f=x(()=>!!y.wallet&&!!y.userTag),R=x(()=>!m.value&&!w.value&&c.value&&parseFloat(c.value)>0&&r.value&&parseInt(r.value)>0),M=()=>{m.value="";const F=parseFloat(c.value);return isNaN(F)?(m.value="Please enter a valid price",!1):F<=0?(m.value="Price must be greater than 0",!1):F<.001?(m.value="Minimum price is 0.001 SOL",!1):!0},k=()=>{w.value="";const F=parseInt(r.value);return isNaN(F)?(w.value="Please enter a valid number of days",!1):F<=0?(w.value="Rental period must be at least 1 day",!1):F>7?(w.value="Maximum rental period is 7 days",!1):!0},N=x(()=>{if(!c.value||parseFloat(c.value)<=0)return[];const F={1:0,2:5,3:10,4:15,5:18,6:22,7:25},U=[],D=parseFloat(c.value),j=parseInt(r.value)||7,st=Math.min(j,7);for(let B=1;B<=st;B++){const Q=F[B]||0,at=(100-Q)/100,X=D*at,ot=X*B;U.push({days:B,discountPercent:Q,discountedDailyPrice:X,totalPrice:ot})}return U}),L=async()=>{var F,U;if(!f.value){_.value=[],b.value=!1;return}try{b.value=!0,console.log("Fetching user NFTs...");const D=await O.get("/nft-rental/nfts",{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});console.log("NFT response:",D.data),D.data?D.data.success?(_.value=D.data.nfts||[],console.log(`Loaded ${_.value.length} NFTs`)):(console.error("Error in NFT response:",D.data.error||"Unknown error"),a.type="error",a.message=D.data.error||"Failed to load your NFTs",a.show=!0,_.value=[]):(console.error("No data in NFT response"),_.value=[])}catch(D){console.error("Error fetching user NFTs:",D),a.type="error",a.message=((U=(F=D.response)==null?void 0:F.data)==null?void 0:U.error)||"Failed to load your NFTs",a.show=!0,_.value=[]}finally{b.value=!1}},E=F=>{v.value=F,M(),k()},I=()=>{v.value=null,c.value="0.1",r.value=7,m.value="",w.value="",T.value=""},z=async()=>{if(!v.value||!f.value)return;const F=M(),U=k();if(!(!F||!U))try{T.value="",s.value=!0;const D={userTag:y.userTag,nftMint:v.value.assetPublicKey,dayPrice:parseFloat(c.value),maxDays:parseInt(r.value),wallet:y.wallet},j=await O.post("/nft-rental/create",D,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});j.data&&j.data.discounts&&console.log("Discounts from server:",j.data.discounts),a.type="success",a.message="Your NFT has been listed for rent successfully!",a.show=!0,I(),await L(),t("nft-listed")}catch(D){console.error("Error listing NFT for rent:",D.response.data.error),T.value=D.response.data.error||"Failed to list NFT",a.type="error",a.message=`Failed to list NFT: ${T.value}`,a.show=!0}finally{s.value=!1}};return tt(()=>{L()}),{loading:b,listLoading:s,userNfts:_,selectedNft:v,dayPrice:c,maxDays:r,priceError:m,daysError:w,discountTable:N,isAuthenticated:f,isFormValid:R,selectNft:E,cancelSelection:I,listNftForRent:z,formatPrice:F=>parseFloat(F).toFixed(3),backendError:T,toast:a}}},ca={class:"list-nft-for-rent"},ua={key:0,class:"auth-message"},ma={key:1},va={key:0,class:"loading-container"},ya={key:1,class:"empty-state"},fa={class:"empty-actions"},pa={key:2},ga={class:"nft-selection"},ba={class:"nft-grid"},_a=["onClick"],Ta={class:"nft-image-container"},ha=["src","alt"],wa={class:"nft-info"},ka={class:"nft-name"},Na={key:0,class:"rental-form"},Fa={class:"form-group"},Ra={key:0,class:"error-message"},Pa={class:"form-group"},Da={key:0,class:"error-message"},Ma={key:0,class:"discount-table"},Ca={class:"discount-table-container"},La={key:1,class:"backend-error-message error-message"},Aa={class:"buttons-container"},Sa=["disabled"],xa={key:0,class:"loading-spinner small"},Ea={key:1};function Ia(y,t,b,s,_,v){const c=S("router-link"),r=S("AppToast");return o(),n(J,null,[e("div",ca,[t[19]||(t[19]=e("h2",{class:"section-title"},"List Your NFT for Rent",-1)),s.isAuthenticated?(o(),n("div",ma,[s.loading?(o(),n("div",va,t[6]||(t[6]=[e("div",{class:"loading-spinner"},null,-1),e("p",null,"Loading your NFTs...",-1)]))):s.userNfts.length===0?(o(),n("div",ya,[t[8]||(t[8]=e("p",null,"You don't have any NFTs to list for rent.",-1)),e("div",fa,[C(c,{to:"/nft-mint",class:"mint-btn"},{default:K(()=>t[7]||(t[7]=[P("Mint new NFT")])),_:1})])])):(o(),n("div",pa,[e("div",ga,[t[9]||(t[9]=e("label",{class:"section-label"},"1. Choose an NFT to list for rent",-1)),e("div",ba,[(o(!0),n(J,null,G(s.userNfts,(a,m)=>(o(),n("div",{key:m,class:W(["nft-card",{selected:s.selectedNft&&s.selectedNft.createdAt===a.createdAt}]),onClick:w=>s.selectNft(a)},[e("div",Ta,[e("img",{src:a.imageUri||"/images/default-nft.png",alt:a.name,class:"nft-image",loading:"lazy"},null,8,ha)]),e("div",wa,[e("h3",ka,d(a.name||"Unnamed NFT"),1)])],10,_a))),128))])]),s.selectedNft?(o(),n("div",Na,[t[17]||(t[17]=e("div",{class:"section-divider"},null,-1)),t[18]||(t[18]=e("label",{class:"section-label"},"2. Set rental details",-1)),e("div",Fa,[t[10]||(t[10]=e("label",{for:"day-price"},"Daily Price (SOL)",-1)),dt(e("input",{id:"day-price","onUpdate:modelValue":t[0]||(t[0]=a=>s.dayPrice=a),type:"number",min:"0.001",step:"0.001",placeholder:"Daily rental price in SOL",class:"input-field"},null,512),[[it,s.dayPrice]]),s.priceError?(o(),n("div",Ra,d(s.priceError),1)):p("",!0)]),e("div",Pa,[t[11]||(t[11]=e("label",{for:"max-days"},"Maximum Rental Period (days)",-1)),dt(e("input",{id:"max-days","onUpdate:modelValue":t[1]||(t[1]=a=>s.maxDays=a),type:"number",min:"1",max:"7",placeholder:"Maximum rental period in days",class:"input-field"},null,512),[[it,s.maxDays]]),t[12]||(t[12]=e("small",{class:"helper-text"},"Maximum allowed rental period is 7 days",-1)),s.daysError?(o(),n("div",Da,d(s.daysError),1)):p("",!0)]),s.dayPrice&&s.maxDays&&!s.priceError&&!s.daysError?(o(),n("div",Ma,[t[14]||(t[14]=e("h4",{class:"discount-table-title"},"Rental Discount Rates",-1)),t[15]||(t[15]=e("p",{class:"discount-table-description"},"Longer rental periods offer discounts to encourage extended use:",-1)),e("div",Ca,[e("table",null,[t[13]||(t[13]=e("thead",null,[e("tr",null,[e("th",null,"Days"),e("th",null,"Discount"),e("th",null,"Daily Price"),e("th",null,"Total")])],-1)),e("tbody",null,[(o(!0),n(J,null,G(s.discountTable,(a,m)=>(o(),n("tr",{key:m,class:W({highlight:a.days===parseInt(s.maxDays)})},[e("td",null,d(a.days),1),e("td",null,d(a.discountPercent)+"%",1),e("td",null,d(s.formatPrice(a.discountedDailyPrice))+" SOL",1),e("td",null,d(s.formatPrice(a.totalPrice))+" SOL",1)],2))),128))])])]),t[16]||(t[16]=e("p",{class:"platform-fee-note"},"Note: A 5% platform fee will be charged to the tenant at time of rental.",-1))])):p("",!0),s.backendError?(o(),n("div",La,[e("p",null,"Error: "+d(s.backendError),1)])):p("",!0),e("div",Aa,[e("button",{onClick:t[2]||(t[2]=(...a)=>s.cancelSelection&&s.cancelSelection(...a)),class:"cancel-button"}," Cancel "),e("button",{onClick:t[3]||(t[3]=(...a)=>s.listNftForRent&&s.listNftForRent(...a)),class:"list-button",disabled:s.listLoading||!s.isFormValid},[s.listLoading?(o(),n("span",xa)):(o(),n("span",Ea,"List NFT for Rent"))],8,Sa)])])):p("",!0)]))])):(o(),n("div",ua,t[5]||(t[5]=[e("p",null,"Please connect your wallet to list NFTs for rent.",-1)])))]),C(r,{show:s.toast.show,message:s.toast.message,type:s.toast.type,onClose:t[4]||(t[4]=a=>s.toast.show=!1),duration:s.toast.duration},null,8,["show","message","type","duration"])],64)}const Ua=$(da,[["render",Ia],["__scopeId","data-v-54743c01"]]),Ba={name:"NftRentalPage",components:{AvailableNfts:We,MyListedNfts:Rs,MyRentedNfts:Js,RentalHistory:ia,ListNftForRent:Ua},setup(){pt();const y=u("available"),t=x(()=>[{id:"available",label:"Available NFTs"},{id:"my-listed",label:"My Listed NFTs"},{id:"my-rented",label:"My Rented NFTs"}]);tt(()=>{!Y.getters.isAuthenticated&&y.value!=="available"&&(y.value="available"),window.addEventListener("switch-tab",r=>{y.value=r.detail})}),bt(()=>{window.removeEventListener("switch-tab",r=>{y.value=r.detail})});const b=()=>{y.value="my-listed"},s=x(()=>Y.getters.userTag||""),_=x(()=>Y.getters.walletAddress||""),v=u(null);return{currentTab:y,tabs:t,handleNftListed:b,userTag:s,walletPublicKey:_,transactionStatus:v,handleRentalSuccess:r=>{v.value={title:"Аренда успешна",message:`NFT успешно арендован до ${new Date(r.rentalEndTime).toLocaleDateString()}`,isLoading:!1,error:null}}}}},Oa={class:"nft-rental-page"},za={class:"nft-rental-container"},Va={class:"rent-listing-section"},Ha={class:"rental-tabs-section"},Ya={class:"tab-container"},Ka={class:"tabs"},Wa={class:"tabs-navigation"},ja={key:0,class:"active-indicator"},Ja={key:0,class:"active-indicator"},Qa={key:0,class:"active-indicator"},Xa={class:"tab-content"},qa={class:"rental-history-section"},Ga={key:0,class:"transaction-modal"},Za={class:"modal-content"},$a={key:0,class:"loading-spinner"},to={key:1,class:"error-message"};function eo(y,t,b,s,_,v){const c=S("ListNftForRent"),r=S("AvailableNfts"),a=S("MyListedNfts"),m=S("MyRentedNfts"),w=S("RentalHistory");return o(),n("div",Oa,[e("div",za,[t[10]||(t[10]=e("h1",{class:"page-title"},"NFT Rental Market",-1)),t[11]||(t[11]=e("p",{class:"subtitle"},"List your NFTs for rental or rent NFTs from other users",-1)),e("section",Va,[C(c,{wallet:s.walletPublicKey,userTag:s.userTag,onNftListed:s.handleNftListed},null,8,["wallet","userTag","onNftListed"])]),e("section",Ha,[e("div",Ya,[e("div",Ka,[e("div",Wa,[e("button",{class:W(["tab-button",{active:s.currentTab==="available"}]),onClick:t[0]||(t[0]=T=>s.currentTab="available")},[t[4]||(t[4]=e("i",{class:"fas fa-store tab-icon"},null,-1)),t[5]||(t[5]=P(" Available ")),s.currentTab==="available"?(o(),n("div",ja)):p("",!0)],2),e("button",{class:W(["tab-button",{active:s.currentTab==="my-listed"}]),onClick:t[1]||(t[1]=T=>s.currentTab="my-listed")},[t[6]||(t[6]=e("i",{class:"fas fa-list tab-icon"},null,-1)),t[7]||(t[7]=P(" Listed ")),s.currentTab==="my-listed"?(o(),n("div",Ja)):p("",!0)],2),e("button",{class:W(["tab-button",{active:s.currentTab==="my-rented"}]),onClick:t[2]||(t[2]=T=>s.currentTab="my-rented")},[t[8]||(t[8]=e("i",{class:"fas fa-box-open tab-icon"},null,-1)),t[9]||(t[9]=P(" Rented ")),s.currentTab==="my-rented"?(o(),n("div",Qa)):p("",!0)],2)])]),e("div",Xa,[s.currentTab==="available"?(o(),vt(r,{key:"available",onRentalSuccess:s.handleRentalSuccess},null,8,["onRentalSuccess"])):p("",!0),s.currentTab==="my-listed"?(o(),vt(a,{key:"my-listed",wallet:s.walletPublicKey,userTag:s.userTag},null,8,["wallet","userTag"])):p("",!0),s.currentTab==="my-rented"?(o(),vt(m,{key:"my-rented",wallet:s.walletPublicKey,userTag:s.userTag},null,8,["wallet","userTag"])):p("",!0)])])]),e("section",qa,[C(w)])]),s.transactionStatus?(o(),n("div",Ga,[e("div",Za,[e("h3",null,d(s.transactionStatus.title),1),e("p",null,d(s.transactionStatus.message),1),s.transactionStatus.isLoading?(o(),n("div",$a)):p("",!0),s.transactionStatus.error?(o(),n("div",to,d(s.transactionStatus.error),1)):p("",!0),s.transactionStatus.isLoading?p("",!0):(o(),n("button",{key:2,onClick:t[3]||(t[3]=T=>s.transactionStatus=null),class:"close-button"}," Close "))])])):p("",!0)])}const kr=$(Ba,[["render",eo],["__scopeId","data-v-d1a4c8a6"]]);export{kr as default};

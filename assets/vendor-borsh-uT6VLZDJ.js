import{b as a}from"./vendor-buffer-DVXvU5G6.js";import{r as L}from"./vendor-bn.js-CN51n21Z.js";import{r as M}from"./vendor-bs58-DhqqakFZ.js";import{r as q}from"./vendor-text-encoding-utf-8-CyyJ4wbt.js";var s={},R;function j(){if(R)return s;R=1;var E=s&&s.__createBinding||(Object.create?function(n,e,t,r){r===void 0&&(r=t),Object.defineProperty(n,r,{enumerable:!0,get:function(){return e[t]}})}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}),x=s&&s.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),h=s&&s.__decorate||function(n,e,t,r){var i=arguments.length,o=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,f;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,e,t,r);else for(var d=n.length-1;d>=0;d--)(f=n[d])&&(o=(i<3?f(o):i>3?f(e,t,o):f(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},A=s&&s.__importStar||function(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t in n)t!=="default"&&Object.hasOwnProperty.call(n,t)&&E(e,n,t);return x(e,n),e},B=s&&s.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(s,"__esModule",{value:!0}),s.deserializeUnchecked=s.deserialize=s.serialize=s.BinaryReader=s.BinaryWriter=s.BorshError=s.baseDecode=s.baseEncode=void 0;const b=B(L()),p=B(M()),$=A(q),F=typeof TextDecoder!="function"?$.TextDecoder:TextDecoder,O=new F("utf-8",{fatal:!0});function D(n){return typeof n=="string"&&(n=a.Buffer.from(n,"utf8")),p.default.encode(a.Buffer.from(n))}s.baseEncode=D;function v(n){return a.Buffer.from(p.default.decode(n))}s.baseDecode=v;const U=1024;class u extends Error{constructor(e){super(e),this.fieldPath=[],this.originalMessage=e}addToFieldPath(e){this.fieldPath.splice(0,0,e),this.message=this.originalMessage+": "+this.fieldPath.join(".")}}s.BorshError=u;class _{constructor(){this.buf=a.Buffer.alloc(U),this.length=0}maybeResize(){this.buf.length<16+this.length&&(this.buf=a.Buffer.concat([this.buf,a.Buffer.alloc(U)]))}writeU8(e){this.maybeResize(),this.buf.writeUInt8(e,this.length),this.length+=1}writeU16(e){this.maybeResize(),this.buf.writeUInt16LE(e,this.length),this.length+=2}writeU32(e){this.maybeResize(),this.buf.writeUInt32LE(e,this.length),this.length+=4}writeU64(e){this.maybeResize(),this.writeBuffer(a.Buffer.from(new b.default(e).toArray("le",8)))}writeU128(e){this.maybeResize(),this.writeBuffer(a.Buffer.from(new b.default(e).toArray("le",16)))}writeU256(e){this.maybeResize(),this.writeBuffer(a.Buffer.from(new b.default(e).toArray("le",32)))}writeU512(e){this.maybeResize(),this.writeBuffer(a.Buffer.from(new b.default(e).toArray("le",64)))}writeBuffer(e){this.buf=a.Buffer.concat([a.Buffer.from(this.buf.subarray(0,this.length)),e,a.Buffer.alloc(U)]),this.length+=e.length}writeString(e){this.maybeResize();const t=a.Buffer.from(e,"utf8");this.writeU32(t.length),this.writeBuffer(t)}writeFixedArray(e){this.writeBuffer(a.Buffer.from(e))}writeArray(e,t){this.maybeResize(),this.writeU32(e.length);for(const r of e)this.maybeResize(),t(r)}toArray(){return this.buf.subarray(0,this.length)}}s.BinaryWriter=_;function l(n,e,t){const r=t.value;t.value=function(...i){try{return r.apply(this,i)}catch(o){if(o instanceof RangeError){const f=o.code;if(["ERR_BUFFER_OUT_OF_BOUNDS","ERR_OUT_OF_RANGE"].indexOf(f)>=0)throw new u("Reached the end of buffer when deserializing")}throw o}}}class c{constructor(e){this.buf=e,this.offset=0}readU8(){const e=this.buf.readUInt8(this.offset);return this.offset+=1,e}readU16(){const e=this.buf.readUInt16LE(this.offset);return this.offset+=2,e}readU32(){const e=this.buf.readUInt32LE(this.offset);return this.offset+=4,e}readU64(){const e=this.readBuffer(8);return new b.default(e,"le")}readU128(){const e=this.readBuffer(16);return new b.default(e,"le")}readU256(){const e=this.readBuffer(32);return new b.default(e,"le")}readU512(){const e=this.readBuffer(64);return new b.default(e,"le")}readBuffer(e){if(this.offset+e>this.buf.length)throw new u(`Expected buffer length ${e} isn't within bounds`);const t=this.buf.slice(this.offset,this.offset+e);return this.offset+=e,t}readString(){const e=this.readU32(),t=this.readBuffer(e);try{return O.decode(t)}catch(r){throw new u(`Error decoding UTF-8 string: ${r}`)}}readFixedArray(e){return new Uint8Array(this.readBuffer(e))}readArray(e){const t=this.readU32(),r=Array();for(let i=0;i<t;++i)r.push(e());return r}}h([l],c.prototype,"readU8",null),h([l],c.prototype,"readU16",null),h([l],c.prototype,"readU32",null),h([l],c.prototype,"readU64",null),h([l],c.prototype,"readU128",null),h([l],c.prototype,"readU256",null),h([l],c.prototype,"readU512",null),h([l],c.prototype,"readString",null),h([l],c.prototype,"readFixedArray",null),h([l],c.prototype,"readArray",null),s.BinaryReader=c;function z(n){return n.charAt(0).toUpperCase()+n.slice(1)}function w(n,e,t,r,i){try{if(typeof r=="string")i[`write${z(r)}`](t);else if(r instanceof Array)if(typeof r[0]=="number"){if(t.length!==r[0])throw new u(`Expecting byte array of length ${r[0]}, but got ${t.length} bytes`);i.writeFixedArray(t)}else if(r.length===2&&typeof r[1]=="number"){if(t.length!==r[1])throw new u(`Expecting byte array of length ${r[1]}, but got ${t.length} bytes`);for(let o=0;o<r[1];o++)w(n,null,t[o],r[0],i)}else i.writeArray(t,o=>{w(n,e,o,r[0],i)});else if(r.kind!==void 0)switch(r.kind){case"option":{t==null?i.writeU8(0):(i.writeU8(1),w(n,e,t,r.type,i));break}case"map":{i.writeU32(t.size),t.forEach((o,f)=>{w(n,e,f,r.key,i),w(n,e,o,r.value,i)});break}default:throw new u(`FieldType ${r} unrecognized`)}else m(n,t,i)}catch(o){throw o instanceof u&&o.addToFieldPath(e),o}}function m(n,e,t){if(typeof e.borshSerialize=="function"){e.borshSerialize(t);return}const r=n.get(e.constructor);if(!r)throw new u(`Class ${e.constructor.name} is missing in schema`);if(r.kind==="struct")r.fields.map(([i,o])=>{w(n,i,e[i],o,t)});else if(r.kind==="enum"){const i=e[r.field];for(let o=0;o<r.values.length;++o){const[f,d]=r.values[o];if(f===i){t.writeU8(o),w(n,f,e[f],d,t);break}}}else throw new u(`Unexpected schema kind: ${r.kind} for ${e.constructor.name}`)}function P(n,e,t=_){const r=new t;return m(n,e,r),r.toArray()}s.serialize=P;function g(n,e,t,r){try{if(typeof t=="string")return r[`read${z(t)}`]();if(t instanceof Array){if(typeof t[0]=="number")return r.readFixedArray(t[0]);if(typeof t[1]=="number"){const i=[];for(let o=0;o<t[1];o++)i.push(g(n,null,t[0],r));return i}else return r.readArray(()=>g(n,e,t[0],r))}if(t.kind==="option")return r.readU8()?g(n,e,t.type,r):void 0;if(t.kind==="map"){let i=new Map;const o=r.readU32();for(let f=0;f<o;f++){const d=g(n,e,t.key,r),I=g(n,e,t.value,r);i.set(d,I)}return i}return y(n,t,r)}catch(i){throw i instanceof u&&i.addToFieldPath(e),i}}function y(n,e,t){if(typeof e.borshDeserialize=="function")return e.borshDeserialize(t);const r=n.get(e);if(!r)throw new u(`Class ${e.name} is missing in schema`);if(r.kind==="struct"){const i={};for(const[o,f]of n.get(e).fields)i[o]=g(n,o,f,t);return new e(i)}if(r.kind==="enum"){const i=t.readU8();if(i>=r.values.length)throw new u(`Enum index: ${i} is out of range`);const[o,f]=r.values[i],d=g(n,o,f,t);return new e({[o]:d})}throw new u(`Unexpected schema kind: ${r.kind} for ${e.constructor.name}`)}function S(n,e,t,r=c){const i=new r(t),o=y(n,e,i);if(i.offset<t.length)throw new u(`Unexpected ${t.length-i.offset} bytes after deserialized data`);return o}s.deserialize=S;function k(n,e,t,r=c){const i=new r(t);return y(n,e,i)}return s.deserializeUnchecked=k,s}var K=j();export{K as l,j as r};

import{B as U}from"./basex-GbQJAx3e.js";import{e as v,h,c as b,d as D,a as d}from"./bytes-BFUO92dS.js";import{t as k,U as A}from"./strings-BqJBhWqj.js";import{d as c}from"./properties-Bism-GXA.js";import{c as R,S as B}from"./signing-key-DZY4IiDE.js";import{r as P,s as w,c as S,S as F}from"./sha2-C3DRumhS.js";import{g as W}from"./address-C-94Rlzo.js";import{k as j}from"./keccak256-BpI13PIi.js";import{w as I}from"./wordlists-Bgp1_tq6.js";import{L as N}from"./logger-BIOSViGG.js";import{B as z}from"./bignumber-DuyZ-PBD.js";import{p as $}from"./pbkdf2-RF0eycJB.js";var M;(function(n){n[n.legacy=0]="legacy",n[n.eip2930=1]="eip2930",n[n.eip1559=2]="eip1559"})(M||(M={}));function G(n){const t=R(n);return W(v(j(v(t,1)),12))}const Z="hdnode/5.8.0",x=new N(Z),_=z.from("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),q=k("Bitcoin seed"),y=2147483648;function L(n){return(1<<n)-1<<8-n}function J(n){return(1<<n)-1}function K(n){return D(h(n),32)}function C(n){return U.encode(b([n,v(w(w(n)),0,4)]))}function E(n){if(n==null)return I.en;if(typeof n=="string"){const t=I[n];return t==null&&x.throwArgumentError("unknown locale","wordlist",n),t}return n}const g={},he="m/44'/60'/0'/0/0";class p{constructor(t,e,i,r,o,s,l,a){if(t!==g)throw new Error("HDNode constructor cannot be called directly");if(e){const f=new B(e);c(this,"privateKey",f.privateKey),c(this,"publicKey",f.compressedPublicKey)}else c(this,"privateKey",null),c(this,"publicKey",h(i));c(this,"parentFingerprint",r),c(this,"fingerprint",v(P(w(this.publicKey)),0,4)),c(this,"address",G(this.publicKey)),c(this,"chainCode",o),c(this,"index",s),c(this,"depth",l),a==null?(c(this,"mnemonic",null),c(this,"path",null)):typeof a=="string"?(c(this,"mnemonic",null),c(this,"path",a)):(c(this,"mnemonic",a),c(this,"path",a.path))}get extendedKey(){if(this.depth>=256)throw new Error("Depth too large!");return C(b([this.privateKey!=null?"0x0488ADE4":"0x0488B21E",h(this.depth),this.parentFingerprint,D(h(this.index),4),this.chainCode,this.privateKey!=null?b(["0x00",this.privateKey]):this.publicKey]))}neuter(){return new p(g,null,this.publicKey,this.parentFingerprint,this.chainCode,this.index,this.depth,this.path)}_derive(t){if(t>4294967295)throw new Error("invalid index - "+String(t));let e=this.path;e&&(e+="/"+(t&~y));const i=new Uint8Array(37);if(t&y){if(!this.privateKey)throw new Error("cannot derive child of neutered node");i.set(d(this.privateKey),1),e&&(e+="'")}else i.set(d(this.publicKey));for(let u=24;u>=0;u-=8)i[33+(u>>3)]=t>>24-u&255;const r=d(S(F.sha512,this.chainCode,i)),o=r.slice(0,32),s=r.slice(32);let l=null,a=null;this.privateKey?l=K(z.from(o).add(this.privateKey).mod(_)):a=new B(h(o))._addPoint(this.publicKey);let f=e;const m=this.mnemonic;return m&&(f=Object.freeze({phrase:m.phrase,path:e,locale:m.locale||"en"})),new p(g,l,a,this.fingerprint,K(s),t,this.depth+1,f)}derivePath(t){const e=t.split("/");if(e.length===0||e[0]==="m"&&this.depth!==0)throw new Error("invalid path - "+t);e[0]==="m"&&e.shift();let i=this;for(let r=0;r<e.length;r++){const o=e[r];if(o.match(/^[0-9]+'$/)){const s=parseInt(o.substring(0,o.length-1));if(s>=y)throw new Error("invalid path index - "+o);i=i._derive(y+s)}else if(o.match(/^[0-9]+$/)){const s=parseInt(o);if(s>=y)throw new Error("invalid path index - "+o);i=i._derive(s)}else throw new Error("invalid path component - "+o)}return i}static _fromSeed(t,e){const i=d(t);if(i.length<16||i.length>64)throw new Error("invalid seed");const r=d(S(F.sha512,q,i));return new p(g,K(r.slice(0,32)),null,"0x00000000",K(r.slice(32)),0,0,e)}static fromMnemonic(t,e,i){return i=E(i),t=X(V(t,i),i),p._fromSeed(Q(t,e),{phrase:t,path:"m",locale:i.locale})}static fromSeed(t){return p._fromSeed(t,null)}static fromExtendedKey(t){const e=U.decode(t);(e.length!==82||C(e.slice(0,78))!==t)&&x.throwArgumentError("invalid extended key","extendedKey","[REDACTED]");const i=e[4],r=h(e.slice(5,9)),o=parseInt(h(e.slice(9,13)).substring(2),16),s=h(e.slice(13,45)),l=e.slice(45,78);switch(h(e.slice(0,4))){case"0x0488b21e":case"0x043587cf":return new p(g,null,h(l),r,s,o,i,null);case"0x0488ade4":case"0x04358394 ":if(l[0]!==0)break;return new p(g,h(l.slice(1)),null,r,s,o,i,null)}return x.throwArgumentError("invalid extended key","extendedKey","[REDACTED]")}}function Q(n,t){t||(t="");const e=k("mnemonic"+t,A.NFKD);return $(k(n,A.NFKD),e,2048,64,"sha512")}function V(n,t){t=E(t),x.checkNormalize();const e=t.split(n);if(e.length%3!==0)throw new Error("invalid mnemonic");const i=d(new Uint8Array(Math.ceil(11*e.length/8)));let r=0;for(let f=0;f<e.length;f++){let m=t.getWordIndex(e[f].normalize("NFKD"));if(m===-1)throw new Error("invalid mnemonic");for(let u=0;u<11;u++)m&1<<10-u&&(i[r>>3]|=1<<7-r%8),r++}const o=32*e.length/3,s=e.length/3,l=L(s);if((d(w(i.slice(0,o/8)))[0]&l)!==(i[i.length-1]&l))throw new Error("invalid checksum");return h(i.slice(0,o/8))}function X(n,t){if(t=E(t),n=d(n),n.length%4!==0||n.length<16||n.length>32)throw new Error("invalid entropy");const e=[0];let i=11;for(let s=0;s<n.length;s++)i>8?(e[e.length-1]<<=8,e[e.length-1]|=n[s],i-=8):(e[e.length-1]<<=i,e[e.length-1]|=n[s]>>8-i,e.push(n[s]&J(8-i)),i+=3);const r=n.length/4,o=d(w(n))[0]&L(r);return e[e.length-1]<<=r,e[e.length-1]|=o>>8-r,t.join(e.map(s=>t.getWord(s)))}export{p as H,he as d,X as e,V as m};

import{u as I,a as K}from"./vendor-vue-router-PmQVL-xb.js";import{u as q}from"./solana-vendors-DGPAp7Fj.js";import{a as B}from"./vendor-axios-Hz4xvOoZ.js";import{C as G,P as J}from"./CancelListingModal-C1HCKVes.js";import{_ as Q}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{h as r,i as s,b as x,k as a,j as S,e as E,m as w,c as u,E as X,r as C,o as l}from"./vendor-vue/runtime-core-CL52-QWR.js";import{t as n,b as Y}from"./vendor-vue/shared-lLteBOIO.js";import{r as g}from"./vendor-vue/reactivity-CqT5sv9X.js";import"./vendor-buffer-DVXvU5G6.js";import"./vendor-base64-js-C2zTC7ec.js";import"./vendor-ieee754-vIlwft-x.js";import"./vendor-events-cQ9mhZQJ.js";import"./vendor-process-DXjpGiAn.js";import"./vendor-lodash.isequal-D20p4pc-.js";import"./vendor-elliptic-BTxzAQL_.js";import"./vendor-minimalistic-assert-OF9c2MWr.js";import"./vendor-minimalistic-crypto-utils-DpWPKLSp.js";import"./vendor-brorand-6pV8Y5jC.js";import"./vendor-crypto-browserify-NMg_40A5.js";import"./vendor-randombytes-ndKo2FAH.js";import"./vendor-safe-buffer-BPihLaHX.js";import"./vendor-create-hash-BsmGkCgx.js";import"./vendor-inherits-BICa84dG.js";import"./vendor-md5.js-BmCTTIue.js";import"./vendor-hash-base-CXljNKss.js";import"./vendor-readable-stream-BpYOL4VF.js";import"./vendor-asn1.js-Cgb4HcA4.js";import"./vendor-util-deprecate-C5bwERXh.js";import"./vendor-string_decoder-CzqD1_ea.js";import"./vendor-ripemd160-B-g9_ZaO.js";import"./vendor-sha.js-C_Iv65sP.js";import"./vendor-cipher-base-CVoreX1z.js";import"./vendor-stream-browserify-BiXhMpOM.js";import"./vendor-create-hmac-Dt8PQ7js.js";import"./vendor-browserify-sign-DLX2f2Lw.js";import"./vendor-process-nextick-args-DZA8cFXf.js";import"./vendor-core-util-is-OG-hh3cz.js";import"./vendor-browserify-rsa-DRghgnJS.js";import"./vendor-bn.js-CN51n21Z.js";import"./vendor-parse-asn1-CnRUGrVC.js";import"./vendor-evp_bytestokey-V5JLH1pP.js";import"./vendor-browserify-aes-Dzp1Wr7h.js";import"./vendor-buffer-xor-BGVZWPAd.js";import"./vendor-pbkdf2-D8c51p7I.js";import"./vendor-browserify-cipher-CRpPeA_V.js";import"./vendor-browserify-des-7ZFmx5Md.js";import"./vendor-des.js-DyWMuwdI.js";import"./vendor-diffie-hellman-CdruneMD.js";import"./vendor-miller-rabin-D60nYGZr.js";import"./vendor-create-ecdh-D3sJE6Oq.js";import"./vendor-public-encrypt-BRl7BMPZ.js";import"./vendor-randomfill-PyDjCq6P.js";import"./vendor-hash.js-Dda3EUYz.js";import"./vendor-hmac-drbg-Ss9liF53.js";import"./vendor-vue/runtime-dom-Ll8vq9eS.js";import"./vendor-vueuse/core-Dowf-keF.js";import"./vendor-vueuse/shared-D4hqHlE2.js";import"./vendor-eventemitter3-C1FPriCL.js";import"./vendor-bignumber.js-Dj_rIxHg.js";import"./vendor-bigint-buffer-5mUCZ2jv.js";import"./vendor-noble/ed25519-DHS8bCE8.js";import"./vendor-node-fetch-DFwHyKwz.js";import"./vendor-url-Fv_L5Bhg.js";import"./vendor-qs-CKXrMD_V.js";import"./vendor-side-channel-CjkecZmv.js";import"./vendor-es-errors-CxTyLFAO.js";import"./vendor-object-inspect-C0kqJKki.js";import"./vendor-side-channel-list-DJbPV7dX.js";import"./vendor-side-channel-map-OCAkmCSB.js";import"./vendor-get-intrinsic-Ci-jyTpD.js";import"./vendor-es-object-atoms-BR76m4z7.js";import"./vendor-math-intrinsics-DP1tGiab.js";import"./vendor-gopd-C1lCZ5Qs.js";import"./vendor-es-define-property-D_7cP-M3.js";import"./vendor-has-symbols-CySAGvJ4.js";import"./vendor-get-proto-BI0zWv-p.js";import"./vendor-dunder-proto-5sdYuMkY.js";import"./vendor-call-bind-apply-helpers-BfAPCzjd.js";import"./vendor-function-bind-CHqF18-c.js";import"./vendor-hasown-CH2RbkDu.js";import"./vendor-call-bound-nPIHF2bX.js";import"./vendor-side-channel-weakmap-D938crsm.js";import"./vendor-whatwg-url-BNoC3hI6.js";import"./vendor-webidl-conversions-DuBT_cRJ.js";import"./vendor-punycode-BGZJxaHx.js";import"./vendor-tr46-_6nBz5KS.js";import"./vendor-mime-DOJa-gVj.js";import"./vendor-assert-CCtLV3vt.js";import"./vendor-util-BEO2nGWh.js";import"./vendor-is-arguments-D-oLGwWh.js";import"./vendor-has-tostringtag-BU9GnA_1.js";import"./vendor-is-generator-function-Bk_W3rfd.js";import"./vendor-safe-regex-test-BtqTbUmV.js";import"./vendor-is-regex-BKTFpgjH.js";import"./vendor-which-typed-array-Bufg-IXZ.js";import"./vendor-for-each-HvIZAWYy.js";import"./vendor-is-callable-BYFz_UGF.js";import"./vendor-available-typed-arrays-uQGnJldC.js";import"./vendor-possible-typed-array-names-BKRybAhF.js";import"./vendor-call-bind-3YpglFCb.js";import"./vendor-set-function-length-Cm7PFPrZ.js";import"./vendor-define-data-property-BppnLwnj.js";import"./vendor-has-property-descriptors-ChC8uhsk.js";import"./vendor-is-typed-array-CZaxorcA.js";import"./vendor-object.assign-D0NKsUk4.js";import"./vendor-object-keys-BRu_Tray.js";import"./vendor-object-is-DkNyiNMZ.js";import"./vendor-define-properties-CgTwYkbs.js";import"./vendor-is-nan-BtAA6g8u.js";import"./vendor-debug-DLVl9QA3.js";import"./vendor-ms-CzQ2E3wO.js";import"./vendor-babel/runtime-w7AU6ifp.js";import"./vendor-js-sha3-DkKfOMXT.js";import"./vendor-typescript-collections-DaJ0MJpz.js";import"./vendor-lodash.clonedeep-C3jeG2fR.js";import"./vendor-ansicolors-BFAL4nhq.js";import"./vendor-bs58-DhqqakFZ.js";import"./vendor-base-x-BHV1Xppf.js";import"./vendor-base64url-D1J1q9RC.js";import"./vendor-arbundles-CR3XhIxB.js";import"./vendor-async-retry-DWdC6xTk.js";import"./vendor-retry-ByBYrtbW.js";import"./vendor-irys/arweave-CO_npObX.js";import"./vendor-safer-buffer-CIAg7E_-.js";import"./vendor-secp256k1-gx_3s_gH.js";import"./vendor-keccak-Bl_8Z6TM.js";import"./vendor-ethersproject/bytes-BFUO92dS.js";import"./vendor-ethersproject/logger-BIOSViGG.js";import"./vendor-ethersproject/wallet-_-D8aoNy.js";import"./vendor-ethersproject/address-C-94Rlzo.js";import"./vendor-ethersproject/keccak256-BpI13PIi.js";import"./vendor-ethersproject/rlp-L8r_OHwd.js";import"./vendor-ethersproject/bignumber-DuyZ-PBD.js";import"./vendor-ethersproject/abstract-provider-BJATZ19F.js";import"./vendor-ethersproject/properties-Bism-GXA.js";import"./vendor-ethersproject/abstract-signer-vaofOY7d.js";import"./vendor-ethersproject/strings-BqJBhWqj.js";import"./vendor-ethersproject/hdnode-De1GriMn.js";import"./vendor-ethersproject/basex-GbQJAx3e.js";import"./vendor-ethersproject/signing-key-DZY4IiDE.js";import"./vendor-ethersproject/sha2-C3DRumhS.js";import"./vendor-ethersproject/wordlists-Bgp1_tq6.js";import"./vendor-ethersproject/pbkdf2-RF0eycJB.js";import"./vendor-ethersproject/json-wallets-DmRppK22.js";import"./vendor-aes-js-CVO7b-af.js";import"./vendor-scrypt-js-pU08l4Iy.js";import"./vendor-ethersproject/random-UwHXQyRf.js";import"./vendor-ethersproject/hash-CaQkUgof.js";import"./vendor-ethersproject/transactions-DgEmUiir.js";import"./vendor-irys/sdk-zMcAFY0m.js";import"./vendor-irys/query-BJ-9co3k.js";import"./vendor-near-js/crypto-DYaHgGqH.js";import"./vendor-borsh-uT6VLZDJ.js";import"./vendor-text-encoding-utf-8-CyyJ4wbt.js";import"./vendor-tweetnacl-DH0kfJ7g.js";import"./vendor-crypto-js-TDtrdbi3.js";import"./vendor-near-js/types-BW5UzBhQ.js";import"./vendor-near-js/keystores-browser-C7Ipq7jt.js";import"./vendor-near-js/keystores-DZ_AKmgs.js";import"./vendor-near-js/transactions-CNW8gb_X.js";import"./vendor-js-sha256-J9Bkl3or.js";import"./vendor-ethersproject/contracts-BfB5cMkz.js";import"./vendor-ethersproject/abi-BZPj2eRn.js";import"./vendor-ethersproject/constants-DnPC-4nq.js";import"./vendor-aptos-COdaePwy.js";import"./vendor-scure/base-BmqIkRj2.js";import"./vendor-supercharge/promise-pool-CxlJr3BL.js";import"./vendor-noble/curves-Bi3lEKLw.js";import"./vendor-noble/hashes-DJrKYuPd.js";import"./vendor-jayson-C-feTq4c.js";import"./vendor-uuid-42xqzRtG.js";import"./vendor-rpc-websockets-CS_NMCMZ.js";const Z={name:"NftListingDetailPage",components:{PlaceBidModal:J,CancelListingModal:G},setup(){const P=I();K();const{wallet:t,connected:v,publicKey:i}=q(),e=g(null),M=P.params.mintAddress,m=g(!0),_=g(!1),p=g(!1),d=g(!1),A=g(!1),f=u(()=>i.value?i.value.toString():""),F=u(()=>e.value&&e.value.highestBidder&&f.value===e.value.highestBidder),L=u(()=>v.value&&e.value&&e.value.status==="active"&&e.value.sellerWallet!==f.value&&new Date(e.value.endTime)>new Date),N=u(()=>L.value&&e.value.instantPrice),W=u(()=>v.value&&e.value&&e.value.status==="active"&&e.value.sellerWallet===f.value),h=async()=>{try{m.value=!0;const o=await B.get(`/nft-market/listings/mint/${M}`);e.value=o.data.data}catch(o){console.error("Error loading listing:",o),e.value=null}finally{m.value=!1}},O=()=>{N.value&&(d.value=!0)},R=async o=>{try{_.value=!0;const c=await B.post("/nft-market/bid",{mintAddress:o.mintAddress,bidAmount:o.amount});d.value=!1,await h()}catch(c){console.error("Error placing bid:",c),alert("Failed to place bid. Please try again.")}finally{_.value=!1}},U=async()=>{try{p.value=!0;const o=await B.post("/nft-market/listings/cancel",{mintAddress:e.value.mintAddress});A.value=!1,await h()}catch(o){console.error("Error cancelling listing:",o),alert("Failed to cancel listing. Please try again.")}finally{p.value=!1}},V=o=>parseFloat(o).toFixed(3),H=o=>{const c=new Date(o),D=new Date;if(c<=D)return"Ended";const b=c-D,T=Math.floor(b/(1e3*60*60*24)),k=Math.floor(b%(1e3*60*60*24)/(1e3*60*60)),y=Math.floor(b%(1e3*60*60)/(1e3*60));return T>0?`${T}d ${k}h ${y}m`:k>0?`${k}h ${y}m`:`${y}m`},j=o=>new Date(o).toLocaleString(),z=o=>o?`${o.substring(0,4)}...${o.substring(o.length-4)}`:"";return X(()=>{h()}),{listing:e,isLoading:m,isPlacingBid:_,isCancelling:p,showBidModal:d,showCancelModal:A,isCurrentUserHighestBidder:F,canBid:L,canBuyNow:N,canCancel:W,buyNow:O,handlePlaceBid:R,handleCancelListing:U,formatPrice:V,formatTimeRemaining:H,formatDate:j,shortenAddress:z}}},$={class:"listing-detail"},ii={class:"listing-detail__container"},ti={key:0,class:"listing-detail__loader-container"},si={key:1,class:"listing-detail__not-found"},oi={key:2,class:"listing-detail__content"},li={class:"listing-detail__grid"},ei={class:"listing-detail__image-section"},ri={class:"listing-detail__image-container"},ni=["src","alt"],ai={key:1,class:"listing-detail__image-placeholder"},di={class:"listing-detail__info-section"},mi={class:"listing-detail__header"},ci={class:"listing-detail__title"},gi={class:"listing-detail__address"},_i={key:0,class:"listing-detail__status"},pi={key:0,class:"listing-detail__seller-info"},ui={class:"listing-detail__seller-tag"},vi={class:"listing-detail__seller"},fi={class:"listing-detail__seller-value"},hi={class:"listing-detail__price-section"},bi={class:"listing-detail__price-block"},ki={class:"listing-detail__price-value"},yi={key:0,class:"listing-detail__price-block"},Bi={class:"listing-detail__price-value"},wi={class:"listing-detail__time-block"},Ci={class:"listing-detail__time-value"},Pi={class:"listing-detail__time-date"},Mi={key:1,class:"listing-detail__bid-section"},Ai={key:0,class:"listing-detail__highest-bid"},Li={class:"listing-detail__bid-value"},Ni={class:"listing-detail__bidder"},Di={key:0,class:"listing-detail__bidder-you"},Ti={class:"listing-detail__actions"},xi={key:2,class:"listing-detail__description"},Si={class:"listing-detail__description-text"},Ei={class:"listing-detail__back-link-container"};function Fi(P,t,v,i,e,M){const m=C("router-link"),_=C("PlaceBidModal"),p=C("CancelListingModal");return l(),r("div",$,[s("div",ii,[i.isLoading?(l(),r("div",ti,t[5]||(t[5]=[s("div",{class:"listing-detail__loader"},null,-1)]))):i.listing?(l(),r("div",oi,[s("div",li,[s("div",ei,[s("div",ri,[i.listing.imageUrl?(l(),r("img",{key:0,src:i.listing.imageUrl,alt:i.listing.name,class:"listing-detail__image"},null,8,ni)):(l(),r("div",ai,t[9]||(t[9]=[s("i",{class:"fas fa-image listing-detail__placeholder-icon"},null,-1)])))])]),s("div",di,[s("div",mi,[s("div",null,[s("h1",ci,n(i.listing.name||`NFT #${i.listing.mintAddress.substring(0,8)}`),1),s("p",gi,n(i.shortenAddress(i.listing.mintAddress)),1)]),i.listing.status!=="active"?(l(),r("div",_i,[s("span",{class:Y(["listing-detail__status-badge",{"listing-detail__status-badge--sold":i.listing.status==="sold","listing-detail__status-badge--cancelled":i.listing.status==="cancelled","listing-detail__status-badge--expired":i.listing.status==="expired"}])},n(i.listing.status),3)])):a("",!0)]),i.listing.seller&&i.listing.seller.userTag?(l(),r("div",pi,[t[10]||(t[10]=s("h3",{class:"listing-detail__seller-title"},"Seller",-1)),s("p",ui,n(i.listing.seller.userTag),1)])):a("",!0),s("div",vi,[t[11]||(t[11]=s("p",{class:"listing-detail__seller-label"},"Продавец",-1)),s("p",fi,n(i.listing.seller&&(i.listing.seller.displayName||i.listing.seller.userTag)||i.shortenAddress(i.listing.sellerWallet)),1)]),s("div",hi,[s("div",bi,[t[12]||(t[12]=s("p",{class:"listing-detail__price-label"},"Текущая цена",-1)),s("p",ki,n(i.formatPrice(i.listing.highestBid||i.listing.initialPrice))+" SOL",1)]),i.listing.instantPrice?(l(),r("div",yi,[t[13]||(t[13]=s("p",{class:"listing-detail__price-label"},"Цена мгновенной покупки",-1)),s("p",Bi,n(i.formatPrice(i.listing.instantPrice))+" SOL",1)])):a("",!0)]),s("div",wi,[t[14]||(t[14]=s("p",{class:"listing-detail__time-label"},"Аукцион завершается",-1)),s("p",Ci,n(i.formatTimeRemaining(i.listing.endTime)),1),s("p",Pi,n(i.formatDate(i.listing.endTime)),1)]),i.listing.status==="active"?(l(),r("div",Mi,[i.listing.highestBid?(l(),r("div",Ai,[t[15]||(t[15]=s("p",{class:"listing-detail__bid-label"},"Текущая ставка",-1)),s("p",Li,n(i.formatPrice(i.listing.highestBid))+" SOL",1),s("p",Ni,[w(" от "+n(i.listing.highestBidder&&i.listing.highestBidder.userTag||i.shortenAddress(i.listing.highestBidder))+" ",1),i.isCurrentUserHighestBidder?(l(),r("span",Di,"(Вы)")):a("",!0)])])):a("",!0),s("div",Ti,[i.canBid?(l(),r("button",{key:0,onClick:t[0]||(t[0]=d=>i.showBidModal=!0),class:"listing-detail__bid-button"}," Сделать ставку ")):a("",!0),i.canBuyNow?(l(),r("button",{key:1,onClick:t[1]||(t[1]=(...d)=>i.buyNow&&i.buyNow(...d)),class:"listing-detail__buy-button"}," Купить сейчас за "+n(i.formatPrice(i.listing.instantPrice))+" SOL ",1)):a("",!0),i.canCancel?(l(),r("button",{key:2,onClick:t[2]||(t[2]=d=>i.showCancelModal=!0),class:"listing-detail__cancel-button"}," Отменить листинг ")):a("",!0)])])):a("",!0),i.listing.nftDetails&&i.listing.nftDetails.description?(l(),r("div",xi,[t[16]||(t[16]=s("h3",{class:"listing-detail__description-title"},"Описание",-1)),s("p",Si,n(i.listing.nftDetails.description),1)])):a("",!0)])])])):(l(),r("div",si,[t[7]||(t[7]=s("h2",{class:"listing-detail__not-found-title"},"Листинг не найден",-1)),t[8]||(t[8]=s("p",{class:"listing-detail__not-found-message"},"NFT листинг, который вы ищете, не существует или был удален.",-1)),S(m,{to:"/nft-market",class:"listing-detail__back-button"},{default:E(()=>t[6]||(t[6]=[w("Вернуться на маркетплейс")])),_:1})])),s("div",Ei,[S(m,{to:"/nft-market",class:"listing-detail__back-link"},{default:E(()=>t[17]||(t[17]=[s("i",{class:"fas fa-arrow-left listing-detail__back-icon"},null,-1),w(" Назад к маркетплейсу ")])),_:1})])]),i.showBidModal&&i.listing?(l(),x(_,{key:0,listing:i.listing,"is-submitting":i.isPlacingBid,onClose:t[3]||(t[3]=d=>i.showBidModal=!1),onSubmit:i.handlePlaceBid},null,8,["listing","is-submitting","onSubmit"])):a("",!0),i.showCancelModal&&i.listing?(l(),x(p,{key:1,"is-submitting":i.isCancelling,onClose:t[4]||(t[4]=d=>i.showCancelModal=!1),onConfirm:i.handleCancelListing},null,8,["is-submitting","onConfirm"])):a("",!0)])}const Go=Q(Z,[["render",Fi],["__scopeId","data-v-1e339c82"]]);export{Go as default};

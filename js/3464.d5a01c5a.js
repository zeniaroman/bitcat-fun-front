"use strict";(self["webpackChunkapp"]=self["webpackChunkapp"]||[]).push([[3464],{3464:function(n,e,a){a.r(e),a.d(e,{default:function(){return W}});var t=a(56768),s=a(24232),o=a(90144),i=a(86659),l=a(75290),r=a(1845),c=a(96529),u=a(63410),g=a(56675),d=a(22123),k=a(68881),w=a(94348);const v={class:"nft-mart-container"},f={class:"actions"},h=["disabled"],A={key:0,class:"tx-info"},p=["href"],T={key:1,class:"error"},y="G26L5YGdj9PaYuePz2jj7Qez2S3PJ39xGEKbAnoYHfVE",b="bcexaZs8HW4TabokwHVJ2Wnpb7yBw5iJ4JHiHfWJCi4",m=.1,L=24,P="https://sleek-icy-frog.solana-mainnet.quiknode.pro/9d4845e2d4c60caf45dc4f10d0bdcfdbcd6a321c";var H={__name:"NftMartPage",setup(n){const e=(0,o.KR)(!1),a=(0,o.KR)(""),H=(0,o.KR)(""),{wallet:S,publicKey:E,signTransaction:W,signAllTransactions:K,signMessage:C,connected:_,sendTransaction:M}=(0,i.vT)(),x=k.A.getters.walletAddress,B=new l.Connection(P),j=(0,o.KR)(null);async function J(){if(_.value)try{e.value=!0,H.value="",w.log("Using wallet address:",x),j.value=c.X.make(B).use((0,u.W)());const t=j.value.auctionHouse(),s=await t.findByAddress({address:new l.PublicKey(y)});w.log("Found Auction House:",s),w.log("for nft: ",b),w.log("Skipping NFT metadata check for testing purposes");const o=new Date;o.setHours(o.getHours()+L);try{w.log("Создаем листинг через Metaplex...");const{blockhash:n,lastValidBlockHeight:e}=await B.getLatestBlockhash("finalized");w.log("Создаем транзакцию для листинга..."),w.log("Создаем листинг через auctionHouse.list..."),w.log("Wallet address:",x),w.log("Public key:",E.value?.toString());const t={publicKey:E.value,signTransaction:async n=>(w.log("Signing transaction with Phantom..."),await window.solana.signTransaction(n)),signAllTransactions:async n=>(w.log("Signing multiple transactions with Phantom..."),await window.solana.signAllTransactions(n)),signMessage:async n=>{w.log("Signing message with Phantom...");const e=(new TextEncoder).encode(n);return await window.solana.signMessage(e)}};w.log("Создаем Metaplex с адаптером Phantom...");const o=c.X.make(B).use((0,g.H)(t)).use((0,u.W)()),i=new l.PublicKey(x);w.log("Wallet public key:",i.toString());const k=await B.getParsedTokenAccountsByOwner(i,{mint:new l.PublicKey(b)});w.log("Token accounts:",k);const v=await(0,r.Ob)(new l.PublicKey(b),i);w.log("Associated Token Account (ATA):",v.toString());try{w.log("Проверяем существование ATA...");const n=await B.getAccountInfo(v);if(null===n)w.log("ATA не существует. Пробуем продолжить без проверки баланса.");else{w.log("ATA существует, проверяем баланс");const n=await B.getTokenAccountBalance(v);w.log("ATA balance:",n.value.uiAmount),n.value.uiAmount||w.warn("Баланс ATA равен 0")}}catch(H){w.error("Error checking ATA:",H),w.log("Продолжаем без проверки ATA...")}w.log("Получаем Auction House клиент...");const f=o.auctionHouse();w.log("Создаем листинг...",s);const{response:h}=await f.list({auctionHouse:s,mintAccount:new l.PublicKey(b),price:(0,d.jN)(1)}),A=h.signature;w.log("Транзакция отправлена с подписью:",A),a.value=A,w.log("Ожидаем подтверждения транзакции...");const p=await B.confirmTransaction({signature:A,blockhash:n,lastValidBlockHeight:e},"finalized");w.log("Транзакция подтверждена:",p),await N(A)}catch(n){return w.error("Error in auction house listing:",n),H.value=`Listing error: ${n.message}`,void(e.value=!1)}}catch(t){w.error("Error creating listing:",t),H.value=`Error: ${t.message}`}finally{e.value=!1}else H.value="Please connect your wallet first"}async function N(n){try{const e=await fetch("/api/nft-market/listings",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({mintAddress:b,initialPrice:m,instantPrice:m,endTime:new Date(Date.now()+60*L*60*1e3).toISOString(),sellerWallet:E.value.toString(),transactionSignature:n})}),a=await e.json();if(!a.success)throw new Error(a.message||"Failed to create listing record");w.log("Listing record created:",a)}catch(e){w.error("Error creating listing record:",e),H.value=`Error creating record: ${e.message}`}}return(0,t.sV)((()=>{_.value&&(j.value=c.X.make(B).use((0,u.W)()))})),(n,o)=>((0,t.uX)(),(0,t.CE)("div",v,[o[7]||(o[7]=(0,t.Lk)("h1",null,"NFT Mart Test Page",-1)),(0,t.Lk)("div",{class:"auction-house-info"},[o[1]||(o[1]=(0,t.Lk)("h2",null,"Auction House Info",-1)),(0,t.Lk)("p",null,[o[0]||(o[0]=(0,t.Lk)("strong",null,"Address:",-1)),(0,t.eW)(" "+(0,s.v_)(y))])]),(0,t.Lk)("div",{class:"nft-info"},[o[4]||(o[4]=(0,t.Lk)("h2",null,"NFT Info",-1)),(0,t.Lk)("p",null,[o[2]||(o[2]=(0,t.Lk)("strong",null,"Mint Address:",-1)),(0,t.eW)(" "+(0,s.v_)(b))]),(0,t.Lk)("p",null,[o[3]||(o[3]=(0,t.Lk)("strong",null,"Price:",-1)),(0,t.eW)(" "+(0,s.v_)(m)+" SOL")]),o[5]||(o[5]=(0,t.Lk)("p",null,[(0,t.Lk)("strong",null,"Duration:"),(0,t.eW)(" 24 hours")],-1))]),(0,t.Lk)("div",f,[(0,t.Lk)("button",{class:"create-listing-btn",onClick:J,disabled:e.value},(0,s.v_)(e.value?"Creating Listing...":"Create Listing"),9,h),a.value?((0,t.uX)(),(0,t.CE)("div",A,[o[6]||(o[6]=(0,t.Lk)("p",null,[(0,t.Lk)("strong",null,"Transaction Signature:")],-1)),(0,t.Lk)("a",{href:`https://solscan.io/tx/${a.value}`,target:"_blank"},(0,s.v_)(a.value),9,p)])):(0,t.Q3)("",!0),H.value?((0,t.uX)(),(0,t.CE)("div",T,[(0,t.Lk)("p",null,(0,s.v_)(H.value),1)])):(0,t.Q3)("",!0)])]))}},S=a(71241);const E=(0,S.A)(H,[["__scopeId","data-v-6e884fe8"]]);var W=E}}]);
//# sourceMappingURL=3464.d5a01c5a.js.map
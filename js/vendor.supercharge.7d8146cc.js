"use strict";(self["webpackChunkapp"]=self["webpackChunkapp"]||[]).push([[2638],{41918:function(r,t){Object.defineProperty(t,"__esModule",{value:!0})},98221:function(r,t,e){var s=this&&this.__createBinding||(Object.create?function(r,t,e,s){void 0===s&&(s=e);var o=Object.getOwnPropertyDescriptor(t,e);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[e]}}),Object.defineProperty(r,s,o)}:function(r,t,e,s){void 0===s&&(s=e),r[s]=t[e]}),o=this&&this.__exportStar||function(r,t){for(var e in r)"default"===e||Object.prototype.hasOwnProperty.call(t,e)||s(t,r,e)};Object.defineProperty(t,"__esModule",{value:!0});const i=e(78915);t["default"]=i.PromisePool,o(e(41918),t),o(e(78915),t),o(e(72728),t),o(e(62987),t),o(e(79661),t),o(e(47537),t)},72728:function(r,t){Object.defineProperty(t,"__esModule",{value:!0}),t.PromisePoolError=void 0;class e extends Error{constructor(r,t){super(),this.raw=r,this.item=t,this.name=this.constructor.name,this.message=this.messageFrom(r),Error.captureStackTrace&&"function"===typeof Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}static createFrom(r,t){return new this(r,t)}messageFrom(r){return r instanceof Error||"object"===typeof r?r.message:"string"===typeof r||"number"===typeof r?r.toString():""}}t.PromisePoolError=e},32625:function(r,t,e){e(44114),e(98992),e(3949),Object.defineProperty(t,"__esModule",{value:!0}),t.PromisePoolExecutor=void 0;const s=e(78915),o=e(47537),i=e(72728),n=e(79661);class a{constructor(){this.meta={tasks:[],items:[],errors:[],results:[],stopped:!1,concurrency:10,shouldResultsCorrespond:!1,processedItems:[],taskTimeout:0},this.handler=r=>r,this.errorHandler=void 0,this.onTaskStartedHandlers=[],this.onTaskFinishedHandlers=[]}useConcurrency(r){if(!this.isValidConcurrency(r))throw o.ValidationError.createFrom(`"concurrency" must be a number, 1 or up. Received "${r}" (${typeof r})`);return this.meta.concurrency=r,this}isValidConcurrency(r){return"number"===typeof r&&r>=1}withTaskTimeout(r){return this.meta.taskTimeout=r,this}concurrency(){return this.meta.concurrency}useCorrespondingResults(r){return this.meta.shouldResultsCorrespond=r,this}shouldUseCorrespondingResults(){return this.meta.shouldResultsCorrespond}taskTimeout(){return this.meta.taskTimeout}for(r){return this.meta.items=r,this}items(){return this.meta.items}itemsCount(){const r=this.items();return Array.isArray(r)?r.length:NaN}tasks(){return this.meta.tasks}activeTaskCount(){return this.activeTasksCount()}activeTasksCount(){return this.tasks().length}processedItems(){return this.meta.processedItems}processedCount(){return this.processedItems().length}processedPercentage(){return this.processedCount()/this.itemsCount()*100}results(){return this.meta.results}errors(){return this.meta.errors}withHandler(r){return this.handler=r,this}hasErrorHandler(){return!!this.errorHandler}handleError(r){return this.errorHandler=r,this}onTaskStarted(r){return this.onTaskStartedHandlers=r,this}onTaskFinished(r){return this.onTaskFinishedHandlers=r,this}hasReachedConcurrencyLimit(){return this.activeTasksCount()>=this.concurrency()}stop(){throw this.markAsStopped(),new n.StopThePromisePoolError}markAsStopped(){return this.meta.stopped=!0,this}isStopped(){return this.meta.stopped}async start(){return await this.validateInputs().prepareResultsArray().process()}validateInputs(){if("function"!==typeof this.handler)throw o.ValidationError.createFrom("The first parameter for the .process(fn) method must be a function");const r=this.taskTimeout();if(!(null==r||"number"===typeof r&&r>=0))throw o.ValidationError.createFrom(`"timeout" must be undefined or a number. A number must be 0 or up. Received "${String(r)}" (${typeof r})`);if(!this.areItemsValid())throw o.ValidationError.createFrom(`"items" must be an array, an iterable or an async iterable. Received "${typeof this.items()}"`);if(this.errorHandler&&"function"!==typeof this.errorHandler)throw o.ValidationError.createFrom(`The error handler must be a function. Received "${typeof this.errorHandler}"`);return this.onTaskStartedHandlers.forEach((r=>{if(r&&"function"!==typeof r)throw o.ValidationError.createFrom(`The onTaskStarted handler must be a function. Received "${typeof r}"`)})),this.onTaskFinishedHandlers.forEach((r=>{if(r&&"function"!==typeof r)throw o.ValidationError.createFrom(`The error handler must be a function. Received "${typeof r}"`)})),this}areItemsValid(){const r=this.items();return!!Array.isArray(r)||("function"===typeof r[Symbol.iterator]||"function"===typeof r[Symbol.asyncIterator])}prepareResultsArray(){const r=this.items();return Array.isArray(r)&&this.shouldUseCorrespondingResults()?(this.meta.results=Array(r.length).fill(s.PromisePool.notRun),this):this}async process(){let r=0;for await(const t of this.items()){if(this.isStopped())break;this.shouldUseCorrespondingResults()&&(this.results()[r]=s.PromisePool.notRun),this.startProcessing(t,r),r+=1,await this.waitForProcessingSlot()}return await this.drained()}async waitForProcessingSlot(){while(this.hasReachedConcurrencyLimit())await this.waitForActiveTaskToFinish()}async waitForActiveTaskToFinish(){await Promise.race(this.tasks())}startProcessing(r,t){const e=this.createTaskFor(r,t).then((r=>{this.save(r,t).removeActive(e)})).catch((async s=>{await this.handleErrorFor(s,r,t),this.removeActive(e)})).finally((()=>{this.processedItems().push(r),this.runOnTaskFinishedHandlers(r)}));this.tasks().push(e),this.runOnTaskStartedHandlers(r)}async createTaskFor(r,t){if(void 0===this.taskTimeout())return this.handler(r,t,this);const[e,s]=this.createTaskTimeout(r);return Promise.race([this.handler(r,t,this),e()]).finally(s)}createTaskTimeout(r){let t;const e=async()=>new Promise(((e,s)=>{t=setTimeout((()=>{s(new i.PromisePoolError(`Task in promise pool timed out after ${this.taskTimeout()}ms`,r))}),this.taskTimeout())})),s=()=>clearTimeout(t);return[e,s]}save(r,t){return this.shouldUseCorrespondingResults()?this.results()[t]=r:this.results().push(r),this}removeActive(r){return this.tasks().splice(this.tasks().indexOf(r),1),this}async handleErrorFor(r,t,e){if(this.shouldUseCorrespondingResults()&&(this.results()[e]=s.PromisePool.failed),!this.isStoppingThePoolError(r)){if(this.isValidationError(r))throw this.markAsStopped(),r;this.hasErrorHandler()?await this.runErrorHandlerFor(r,t):this.saveErrorFor(r,t)}}isStoppingThePoolError(r){return r instanceof n.StopThePromisePoolError}isValidationError(r){return r instanceof o.ValidationError}async runErrorHandlerFor(r,t){try{await(this.errorHandler?.(r,t,this))}catch(e){this.rethrowIfNotStoppingThePool(e)}}runOnTaskStartedHandlers(r){this.onTaskStartedHandlers.forEach((t=>{t(r,this)}))}runOnTaskFinishedHandlers(r){this.onTaskFinishedHandlers.forEach((t=>{t(r,this)}))}rethrowIfNotStoppingThePool(r){if(!this.isStoppingThePoolError(r))throw r}saveErrorFor(r,t){this.errors().push(i.PromisePoolError.createFrom(r,t))}async drained(){return await this.drainActiveTasks(),{errors:this.errors(),results:this.results()}}async drainActiveTasks(){await Promise.all(this.tasks())}}t.PromisePoolExecutor=a},78915:function(r,t,e){e(44114),Object.defineProperty(t,"__esModule",{value:!0}),t.PromisePool=void 0;const s=e(32625);class o{constructor(r){this.timeout=void 0,this.concurrency=10,this.items=r??[],this.errorHandler=void 0,this.onTaskStartedHandlers=[],this.onTaskFinishedHandlers=[],this.shouldResultsCorrespond=!1}withConcurrency(r){return this.concurrency=r,this}static withConcurrency(r){return(new this).withConcurrency(r)}withTaskTimeout(r){return this.timeout=r,this}static withTaskTimeout(r){return(new this).withTaskTimeout(r)}for(r){const t=new o(r).withConcurrency(this.concurrency);return"function"===typeof this.errorHandler&&t.handleError(this.errorHandler),"number"===typeof this.timeout?t.withTaskTimeout(this.timeout):t}static for(r){return(new this).for(r)}handleError(r){return this.errorHandler=r,this}onTaskStarted(r){return this.onTaskStartedHandlers.push(r),this}onTaskFinished(r){return this.onTaskFinishedHandlers.push(r),this}useCorrespondingResults(){return this.shouldResultsCorrespond=!0,this}async process(r){return(new s.PromisePoolExecutor).useConcurrency(this.concurrency).useCorrespondingResults(this.shouldResultsCorrespond).withTaskTimeout(this.timeout).withHandler(r).handleError(this.errorHandler).onTaskStarted(this.onTaskStartedHandlers).onTaskFinished(this.onTaskFinishedHandlers).for(this.items).start()}}t.PromisePool=o,o.notRun=Symbol("notRun"),o.failed=Symbol("failed")},62987:function(r,t){Object.defineProperty(t,"__esModule",{value:!0})},79661:function(r,t){Object.defineProperty(t,"__esModule",{value:!0}),t.StopThePromisePoolError=void 0;class e extends Error{}t.StopThePromisePoolError=e},47537:function(r,t){Object.defineProperty(t,"__esModule",{value:!0}),t.ValidationError=void 0;class e extends Error{constructor(r){super(r),Error.captureStackTrace&&"function"===typeof Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}static createFrom(r){return new this(r)}}t.ValidationError=e}}]);
//# sourceMappingURL=vendor.supercharge.7d8146cc.js.map
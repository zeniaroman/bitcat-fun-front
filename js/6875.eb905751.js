"use strict";(self["webpackChunkapp"]=self["webpackChunkapp"]||[]).push([[6875],{71241:function(a,e){e.A=(a,e)=>{const t=a.__vccOpts||a;for(const[s,l]of e)t[s]=l;return t}},10587:function(a,e,t){t.d(e,{A:function(){return u}});var s=t(56768),l=t(24232);const n={class:"toast-content"};function r(a,e,t,r,i,o){return t.show?((0,s.uX)(),(0,s.CE)("div",{key:0,class:(0,l.C4)(["toast",`toast-${t.type}`])},[(0,s.Lk)("div",n,(0,l.v_)(t.message),1),(0,s.Lk)("button",{class:"toast-close",onClick:e[0]||(e[0]=(...a)=>o.close&&o.close(...a))},"×")],2)):(0,s.Q3)("",!0)}var i={name:"AppToast",props:{message:{type:String,default:""},type:{type:String,default:"info",validator:a=>["success","error","warning","info"].includes(a)},duration:{type:Number,default:3e3},show:{type:Boolean,default:!1}},emits:["close"],watch:{show(a){a&&this.duration>0&&(this.timer=setTimeout((()=>{this.close()}),this.duration))}},methods:{close(){this.timer&&clearTimeout(this.timer),this.$emit("close")}},beforeUnmount(){this.timer&&clearTimeout(this.timer)},data(){return{timer:null}}},o=t(71241);const c=(0,o.A)(i,[["render",r],["__scopeId","data-v-9f6ec8d0"]]);var u=c},56875:function(a,e,t){t.r(e),t.d(e,{default:function(){return os}});var s=t(56768),l=t(24232);const n={class:"nft-rental-page"},r={class:"nft-rental-container"},i={class:"rent-listing-section"},o={class:"rental-tabs-section"},c={class:"tab-container"},u={class:"tabs"},d={class:"tabs-navigation"},v={key:0,class:"active-indicator"},m={key:0,class:"active-indicator"},y={key:0,class:"active-indicator"},p={class:"tab-content"},k={class:"rental-history-section"},f={key:0,class:"transaction-modal"},g={class:"modal-content"},L={key:0,class:"loading-spinner"},b={key:1,class:"error-message"};function h(a,e,t,h,T,C){const w=(0,s.g2)("ListNftForRent"),R=(0,s.g2)("AvailableNfts"),E=(0,s.g2)("MyListedNfts"),F=(0,s.g2)("MyRentedNfts"),N=(0,s.g2)("RentalHistory");return(0,s.uX)(),(0,s.CE)("div",n,[(0,s.Lk)("div",r,[e[10]||(e[10]=(0,s.Lk)("h1",{class:"page-title"},"NFT Rental Market",-1)),e[11]||(e[11]=(0,s.Lk)("p",{class:"subtitle"},"List your NFTs for rental or rent NFTs from other users",-1)),(0,s.Lk)("section",i,[(0,s.bF)(w,{wallet:h.walletPublicKey,userTag:h.userTag,onNftListed:h.handleNftListed},null,8,["wallet","userTag","onNftListed"])]),(0,s.Lk)("section",o,[(0,s.Lk)("div",c,[(0,s.Lk)("div",u,[(0,s.Lk)("div",d,[(0,s.Lk)("button",{class:(0,l.C4)(["tab-button",{active:"available"===h.currentTab}]),onClick:e[0]||(e[0]=a=>h.currentTab="available")},[e[4]||(e[4]=(0,s.Lk)("i",{class:"fas fa-store tab-icon"},null,-1)),e[5]||(e[5]=(0,s.eW)(" Available ")),"available"===h.currentTab?((0,s.uX)(),(0,s.CE)("div",v)):(0,s.Q3)("",!0)],2),(0,s.Lk)("button",{class:(0,l.C4)(["tab-button",{active:"my-listed"===h.currentTab}]),onClick:e[1]||(e[1]=a=>h.currentTab="my-listed")},[e[6]||(e[6]=(0,s.Lk)("i",{class:"fas fa-list tab-icon"},null,-1)),e[7]||(e[7]=(0,s.eW)(" Listed ")),"my-listed"===h.currentTab?((0,s.uX)(),(0,s.CE)("div",m)):(0,s.Q3)("",!0)],2),(0,s.Lk)("button",{class:(0,l.C4)(["tab-button",{active:"my-rented"===h.currentTab}]),onClick:e[2]||(e[2]=a=>h.currentTab="my-rented")},[e[8]||(e[8]=(0,s.Lk)("i",{class:"fas fa-box-open tab-icon"},null,-1)),e[9]||(e[9]=(0,s.eW)(" Rented ")),"my-rented"===h.currentTab?((0,s.uX)(),(0,s.CE)("div",y)):(0,s.Q3)("",!0)],2)])]),(0,s.Lk)("div",p,["available"===h.currentTab?((0,s.uX)(),(0,s.Wv)(R,{key:"available",onRentalSuccess:h.handleRentalSuccess},null,8,["onRentalSuccess"])):(0,s.Q3)("",!0),"my-listed"===h.currentTab?((0,s.uX)(),(0,s.Wv)(E,{key:"my-listed",wallet:h.walletPublicKey,userTag:h.userTag},null,8,["wallet","userTag"])):(0,s.Q3)("",!0),"my-rented"===h.currentTab?((0,s.uX)(),(0,s.Wv)(F,{key:"my-rented",wallet:h.walletPublicKey,userTag:h.userTag},null,8,["wallet","userTag"])):(0,s.Q3)("",!0)])])]),(0,s.Lk)("section",k,[(0,s.bF)(N)])]),h.transactionStatus?((0,s.uX)(),(0,s.CE)("div",f,[(0,s.Lk)("div",g,[(0,s.Lk)("h3",null,(0,l.v_)(h.transactionStatus.title),1),(0,s.Lk)("p",null,(0,l.v_)(h.transactionStatus.message),1),h.transactionStatus.isLoading?((0,s.uX)(),(0,s.CE)("div",L)):(0,s.Q3)("",!0),h.transactionStatus.error?((0,s.uX)(),(0,s.CE)("div",b,(0,l.v_)(h.transactionStatus.error),1)):(0,s.Q3)("",!0),h.transactionStatus.isLoading?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("button",{key:2,onClick:e[3]||(e[3]=a=>h.transactionStatus=null),class:"close-button"}," Close "))])])):(0,s.Q3)("",!0)])}var T=t(90144),C=t(81387),w=t(68881),R=t(45130);const E={class:"available-nfts"},F={key:1,class:"loading-container"},N={key:2,class:"empty-state"},P={key:3,class:"nft-grid"},A={class:"nft-image-container"},D=["src","alt"],_={class:"nft-info"},X={class:"nft-name"},S={class:"nft-owner"},M={class:"nft-price"},K={class:"price-amount"},x={class:"nft-details"},I={class:"detail-item"},$={class:"detail-value"},U={key:0,class:"rent-controls"},W={key:0,class:"own-nft-message"},Q={key:1,class:"rent-options"},O={class:"rental-period"},B=["onClick"],V={class:"selected-option"},z={key:0,class:"options-dropdown"},H=["onClick"],Y=["onClick","disabled"],j={key:1,class:"auth-message"},J={key:2,class:"discount-info"},q={class:"discount-row"},G={class:"discount-value"},Z={key:0,class:"discount-row discount"},aa={class:"discount-value"},ea={class:"discount-row total"},ta={class:"discount-label"},sa={class:"discount-value"},la={key:0},na={key:0,class:"rental-summary"},ra={class:"summary-item"},ia={class:"summary-value"},oa={class:"summary-item"},ca={class:"summary-value"},ua={class:"summary-item"},da={class:"summary-value"},va={key:0,class:"summary-item discount"},ma={class:"summary-value"},ya={key:1,class:"summary-item"},pa={class:"summary-value"},ka={class:"summary-item total"},fa={class:"summary-value"},ga={class:"summary-item end-date"},La={class:"summary-value"},ba={key:1,class:"loading-info"},ha={class:"modal-actions"},Ta=["disabled"],Ca={key:0,class:"loading-spinner small"},wa={key:1},Ra={key:1},Ea={class:"transaction-processing"},Fa={class:"transaction-info"},Na={class:"pending-details"},Pa={class:"pending-detail"},Aa={class:"pending-detail"},Da={key:2},_a={class:"transaction-success"},Xa={class:"rental-summary success-summary"},Sa={class:"summary-item"},Ma={class:"summary-value"},Ka={class:"summary-item"},xa={class:"summary-value"},Ia={class:"summary-item"},$a={class:"summary-value"},Ua={class:"summary-item"},Wa={class:"summary-value"},Qa={class:"summary-item"},Oa=["href"],Ba={class:"modal-actions success-actions"},Va={key:3},za={class:"transaction-error"},Ha={class:"error-content"},Ya={class:"error-message"},ja={class:"modal-actions error-actions"};function Ja(a,e,t,n,r,i){const o=(0,s.g2)("router-link"),c=(0,s.g2)("AppToast");return(0,s.uX)(),(0,s.CE)("div",E,[e[48]||(e[48]=(0,s.Lk)("h2",{class:"section-title"},"Available NFTs for Rent",-1)),(0,s.Q3)("",!0),n.loading?((0,s.uX)(),(0,s.CE)("div",F,e[11]||(e[11]=[(0,s.Lk)("div",{class:"loading-spinner"},null,-1),(0,s.Lk)("p",null,"Loading available NFTs...",-1)]))):0===n.filteredNfts.length?((0,s.uX)(),(0,s.CE)("div",N,[e[12]||(e[12]=(0,s.Lk)("p",null,"No NFTs available for rent right now.",-1)),(0,s.Lk)("button",{onClick:e[2]||(e[2]=(...a)=>n.refreshData&&n.refreshData(...a)),class:"refresh-btn"},"Refresh")])):((0,s.uX)(),(0,s.CE)("div",P,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.filteredNfts,(a=>((0,s.uX)(),(0,s.CE)("div",{key:a.id,class:"nft-card"},[(0,s.Lk)("div",A,[(0,s.Lk)("img",{src:a.imageUrl||"/images/default-nft.png",alt:a.name,class:"nft-image"},null,8,D)]),(0,s.Lk)("div",_,[(0,s.Lk)("h3",X,[(0,s.bF)(o,{to:`/nft/${a.nftMint}`},{default:(0,s.k6)((()=>[(0,s.eW)((0,l.v_)(a.name||"Unnamed NFT"),1)])),_:2},1032,["to"])]),(0,s.Lk)("p",S,[e[13]||(e[13]=(0,s.eW)("Owner: ")),(0,s.bF)(o,{to:`/player/${a.userTag}`},{default:(0,s.k6)((()=>[(0,s.eW)((0,l.v_)(n.formatUserTag(a.userTag)),1)])),_:2},1032,["to"])]),(0,s.Lk)("div",M,[e[14]||(e[14]=(0,s.Lk)("span",{class:"price-label"},"Daily Price:",-1)),(0,s.Lk)("span",K,(0,l.v_)(n.formatPrice(a.dayPrice))+" SOL",1)]),(0,s.Lk)("div",x,[(0,s.Lk)("div",I,[e[15]||(e[15]=(0,s.Lk)("span",{class:"detail-label"},"Max rental duration:",-1)),(0,s.Lk)("span",$,(0,l.v_)(a.maxDays)+" day(s)",1)])]),n.isAuthenticated&&n.walletAddress?((0,s.uX)(),(0,s.CE)("div",U,[a.userTag===n.userTag?((0,s.uX)(),(0,s.CE)("div",W,e[16]||(e[16]=[(0,s.Lk)("div",{class:"own-nft-label"},"Your Listed NFT",-1),(0,s.Lk)("p",{class:"own-nft-description"},"This NFT is listed by you for rent",-1)]))):(0,s.Q3)("",!0),a.userTag!==n.userTag?((0,s.uX)(),(0,s.CE)("div",Q,[(0,s.Lk)("div",O,[e[17]||(e[17]=(0,s.Lk)("label",{for:"rental-days",class:"rental-period-label"},"Rental period:",-1)),(0,s.Lk)("div",{class:(0,l.C4)(["custom-select",{"is-open":n.openDropdown===a.id}]),onClick:e=>n.toggleDropdown(a.id)},[(0,s.Lk)("div",V,(0,l.v_)(n.rentDays[a.id]?`${n.rentDays[a.id]} day${n.rentDays[a.id]>1?"s":""} ${n.getDiscountText(n.rentDays[a.id])}`:"Select period"),1),n.openDropdown===a.id?((0,s.uX)(),(0,s.CE)("div",z,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.getRentDaysOptions(a.maxDays),(e=>((0,s.uX)(),(0,s.CE)("div",{key:e,class:(0,l.C4)(["option",{selected:n.rentDays[a.id]===e}]),onClick:(0,R.D$)((t=>n.selectDays(a,e)),["stop"])},(0,l.v_)(e)+" day"+(0,l.v_)(e>1?"s":"")+" "+(0,l.v_)(n.getDiscountText(e)),11,H)))),128))])):(0,s.Q3)("",!0)],10,B)]),(0,s.Lk)("button",{onClick:e=>n.rentNft(a),class:"rent-button",disabled:!n.rentDays[a.id]}," Rent NFT ",8,Y)])):(0,s.Q3)("",!0)])):((0,s.uX)(),(0,s.CE)("div",j,e[18]||(e[18]=[(0,s.Lk)("p",null,"Please connect your wallet to rent NFTs",-1)]))),n.rentDays[a.id]&&n.discountInfo[a.id]&&a.userTag!==n.userTag?((0,s.uX)(),(0,s.CE)("div",J,[(0,s.Lk)("div",q,[e[19]||(e[19]=(0,s.Lk)("span",{class:"discount-label"},"Base price:",-1)),(0,s.Lk)("span",G,(0,l.v_)(n.formatPrice(a.dayPrice))+" SOL/day",1)]),n.discountInfo[a.id].discountPercent>0?((0,s.uX)(),(0,s.CE)("div",Z,[e[20]||(e[20]=(0,s.Lk)("span",{class:"discount-label"},"Discount:",-1)),(0,s.Lk)("span",aa,"-"+(0,l.v_)(n.discountInfo[a.id].discountPercent)+"% OFF",1)])):(0,s.Q3)("",!0),(0,s.Lk)("div",ea,[(0,s.Lk)("span",ta,"Total for "+(0,l.v_)(n.rentDays[a.id])+" days:",1),(0,s.Lk)("span",sa,(0,l.v_)(n.formatPrice(n.discountInfo[a.id].totalPrice))+" SOL",1)])])):(0,s.Q3)("",!0)])])))),128))])),n.showRentModal?((0,s.uX)(),(0,s.CE)("div",{key:4,class:"modal-overlay",onClick:e[9]||(e[9]=(...a)=>n.closeRentModal&&n.closeRentModal(...a))},[(0,s.Lk)("div",{class:"modal-content",onClick:e[8]||(e[8]=(0,R.D$)((()=>{}),["stop"]))},[n.transactionStatus?"pending"===n.transactionStatus?((0,s.uX)(),(0,s.CE)("div",Ra,[e[35]||(e[35]=(0,s.Lk)("h3",{class:"modal-title pending-title"},"Processing Transaction",-1)),(0,s.Lk)("div",Ea,[e[33]||(e[33]=(0,s.Lk)("div",{class:"loading-spinner pending-spinner"},null,-1)),e[34]||(e[34]=(0,s.Lk)("p",{class:"pending-message"},"Your rental transaction is being processed...",-1)),(0,s.Lk)("div",Fa,[e[32]||(e[32]=(0,s.Lk)("p",{class:"small-text"},"Please wait while we confirm your transaction on the Solana blockchain.",-1)),(0,s.Lk)("div",Na,[(0,s.Lk)("div",Pa,[e[30]||(e[30]=(0,s.Lk)("span",{class:"detail-icon"},"💰",-1)),(0,s.Lk)("span",null,(0,l.v_)(n.formatPrice(n.currentRentalInfo.subtotal))+" SOL",1)]),(0,s.Lk)("div",Aa,[e[31]||(e[31]=(0,s.Lk)("span",{class:"detail-icon"},"⏱️",-1)),(0,s.Lk)("span",null,(0,l.v_)(n.rentDays[n.selectedNft.id])+" days rental",1)])])])])])):"success"===n.transactionStatus?((0,s.uX)(),(0,s.CE)("div",Da,[e[44]||(e[44]=(0,s.Lk)("h3",{class:"modal-title success-title"},"Rental Successful!",-1)),(0,s.Lk)("div",_a,[e[41]||(e[41]=(0,s.Lk)("div",{class:"success-icon-container"},[(0,s.Lk)("div",{class:"success-icon"},"✓")],-1)),(0,s.Lk)("div",Xa,[(0,s.Lk)("div",Sa,[e[36]||(e[36]=(0,s.Lk)("span",{class:"summary-label"},"NFT:",-1)),(0,s.Lk)("span",Ma,(0,l.v_)(n.selectedNft.name),1)]),(0,s.Lk)("div",Ka,[e[37]||(e[37]=(0,s.Lk)("span",{class:"summary-label"},"Rental Period:",-1)),(0,s.Lk)("span",xa,(0,l.v_)(n.currentRentalInfo.days)+" days",1)]),(0,s.Lk)("div",Ia,[e[38]||(e[38]=(0,s.Lk)("span",{class:"summary-label"},"Total Cost:",-1)),(0,s.Lk)("span",$a,(0,l.v_)(n.formatPrice(n.currentRentalInfo.subtotal))+" SOL",1)]),(0,s.Lk)("div",Ua,[e[39]||(e[39]=(0,s.Lk)("span",{class:"summary-label"},"Rental End Date:",-1)),(0,s.Lk)("span",Wa,(0,l.v_)(n.formatDate(n.currentRentalInfo.rentalEndTime)),1)]),(0,s.Lk)("div",Qa,[e[40]||(e[40]=(0,s.Lk)("span",{class:"summary-label"},"Transaction:",-1)),(0,s.Lk)("a",{href:`https://explorer.solana.com/tx/${n.transactionSignature}`,target:"_blank",class:"transaction-link"}," View on Solana Explorer ",8,Oa)])]),e[42]||(e[42]=(0,s.Lk)("p",{class:"success-message"},'Your rented NFT is now available in the "My Rented NFTs" tab.',-1))]),(0,s.Lk)("div",Ba,[(0,s.Lk)("button",{onClick:e[5]||(e[5]=(...a)=>n.closeRentModal&&n.closeRentModal(...a)),class:"cancel-button"},"Close"),(0,s.bF)(o,{to:`/nft/${n.selectedNft.nftMint}`,class:"view-nft-button"},{default:(0,s.k6)((()=>e[43]||(e[43]=[(0,s.eW)(" Open NFT Page ")]))),_:1},8,["to"])])])):"error"===n.transactionStatus?((0,s.uX)(),(0,s.CE)("div",Va,[e[47]||(e[47]=(0,s.Lk)("h3",{class:"modal-title error-title"},"Rental Failed",-1)),(0,s.Lk)("div",za,[e[46]||(e[46]=(0,s.Lk)("div",{class:"error-icon-container"},[(0,s.Lk)("div",{class:"error-icon"},"✗")],-1)),(0,s.Lk)("div",Ha,[(0,s.Lk)("p",Ya,(0,l.v_)(n.transactionError||"There was an error processing your rental transaction."),1),e[45]||(e[45]=(0,s.Lk)("div",{class:"error-details"},[(0,s.Lk)("p",{class:"small-text"},"Please try again or contact support if the problem persists.")],-1))])]),(0,s.Lk)("div",ja,[(0,s.Lk)("button",{onClick:e[6]||(e[6]=(...a)=>n.closeRentModal&&n.closeRentModal(...a)),class:"cancel-button"},"Close"),(0,s.Lk)("button",{onClick:e[7]||(e[7]=(...a)=>n.retryRental&&n.retryRental(...a)),class:"retry-button"},"Try Again")])])):(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",la,[e[29]||(e[29]=(0,s.Lk)("h3",null,"Confirm NFT Rental",-1)),n.selectedNft&&n.currentRentalInfo?((0,s.uX)(),(0,s.CE)("div",na,[(0,s.Lk)("div",ra,[e[21]||(e[21]=(0,s.Lk)("span",{class:"summary-label"},"NFT:",-1)),(0,s.Lk)("span",ia,(0,l.v_)(n.selectedNft.name),1)]),(0,s.Lk)("div",oa,[e[22]||(e[22]=(0,s.Lk)("span",{class:"summary-label"},"Rental Period:",-1)),(0,s.Lk)("span",ca,(0,l.v_)(n.rentDays[n.selectedNft.id])+" days",1)]),(0,s.Lk)("div",ua,[e[23]||(e[23]=(0,s.Lk)("span",{class:"summary-label"},"Original Daily Price:",-1)),(0,s.Lk)("span",da,(0,l.v_)(n.formatPrice(n.selectedNft.dayPrice))+" SOL",1)]),n.currentRentalInfo.discountPercent>0?((0,s.uX)(),(0,s.CE)("div",va,[e[24]||(e[24]=(0,s.Lk)("span",{class:"summary-label"},"Discount:",-1)),(0,s.Lk)("span",ma,(0,l.v_)(n.currentRentalInfo.discountPercent)+"% OFF",1)])):(0,s.Q3)("",!0),n.currentRentalInfo.discountPercent>0?((0,s.uX)(),(0,s.CE)("div",ya,[e[25]||(e[25]=(0,s.Lk)("span",{class:"summary-label"},"Discounted Daily Price:",-1)),(0,s.Lk)("span",pa,(0,l.v_)(n.formatPrice(n.currentRentalInfo.discountedDailyPrice))+" SOL",1)])):(0,s.Q3)("",!0),(0,s.Lk)("div",ka,[e[26]||(e[26]=(0,s.Lk)("span",{class:"summary-label"},"Total Cost:",-1)),(0,s.Lk)("span",fa,(0,l.v_)(n.formatPrice(n.currentRentalInfo.subtotal))+" SOL",1)]),(0,s.Lk)("div",ga,[e[27]||(e[27]=(0,s.Lk)("span",{class:"summary-label"},"Rental End Date:",-1)),(0,s.Lk)("span",La,(0,l.v_)(n.formatDate(n.currentRentalInfo.rentalEndTime)),1)])])):n.selectedNft?((0,s.uX)(),(0,s.CE)("div",ba,e[28]||(e[28]=[(0,s.Lk)("div",{class:"loading-spinner small"},null,-1),(0,s.Lk)("p",null,"Loading rental details...",-1)]))):(0,s.Q3)("",!0),(0,s.Lk)("div",ha,[(0,s.Lk)("button",{onClick:e[3]||(e[3]=(...a)=>n.closeRentModal&&n.closeRentModal(...a)),class:"cancel-button"},"Cancel"),(0,s.Lk)("button",{onClick:e[4]||(e[4]=(...a)=>n.confirmRent&&n.confirmRent(...a)),disabled:n.rentLoading,class:"confirm-button"},[n.rentLoading?((0,s.uX)(),(0,s.CE)("span",Ca)):((0,s.uX)(),(0,s.CE)("span",wa,"Confirm Rental"))],8,Ta)])]))])])):(0,s.Q3)("",!0),(0,s.bF)(c,{show:n.toast.show,message:n.toast.message,type:n.toast.type,onClose:e[10]||(e[10]=a=>n.toast.show=!1),duration:n.toast.duration},null,8,["show","message","type","duration"])])}t(16573),t(78100),t(77936),t(37467),t(44732),t(79577),t(98992),t(54520),t(3949),t(64979);var qa=t(94373),Ga=t(75290),Za=t(10587),ae=t(94348),ee={name:"AvailableNfts",components:{AppToast:Za.A},props:{},setup(){const a=(0,T.KR)(!0),e=(0,T.KR)(!1),t=(0,T.KR)([]),l=(0,T.KR)(""),n=(0,T.KR)(10),r=(0,T.Kh)({}),i=(0,T.Kh)({}),o=(0,T.KR)(!1),c=(0,T.KR)(null),u=(0,T.KR)(null),d=(0,T.KR)(null),v=(0,T.KR)(null),m=(0,T.KR)(null),y=(0,T.KR)(null),p=(0,T.Kh)({show:!1,message:"",type:"info",duration:5e3}),k=(0,s.EW)((()=>w.A.getters.isAuthenticated)),f=(0,s.EW)((()=>w.A.getters.walletAddress)),g=(0,s.EW)((()=>w.A.getters.userTag)),L=(0,s.EW)((()=>t.value.filter((a=>{const e=a.name&&a.name.toLowerCase().includes(l.value.toLowerCase()),t=parseFloat(a.dayPrice)<=n.value;return e&&t})).sort(((a,e)=>parseFloat(a.dayPrice)-parseFloat(e.dayPrice))))),b=async()=>{try{a.value=!0;const e=await qa.A.get("/nft-rental/all",{params:{available_for_rent:1}});t.value=e.data}catch(e){ae.error("Error fetching available NFTs:",e)}finally{a.value=!1}},h=()=>{b()},C=a=>parseFloat(a).toFixed(3),R=a=>a||"Unknown",E=a=>{const e=Math.min(a,7);return Array.from({length:e},((a,e)=>e+1))},F=a=>{const e={1:0,2:5,3:10,4:15,5:18,6:22,7:25},t=e[a]||0;return t>0?`(-${t}%)`:""},N=a=>{const e=new Date;return e.setDate(e.getDate()+parseInt(a)),e.toLocaleDateString()},P=a=>{if(!a)return"";const e=new Date(a);return e.toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})},A=a=>{const e=r[a.id];if(!e)return;const t={1:0,2:5,3:10,4:15,5:18,6:22,7:25},s=t[e]||0,l=(100-s)/100,n=parseFloat(a.dayPrice),o=n*l,c=o*e,u=.05*c;i[a.id]={days:e,discountPercent:s,originalDailyPrice:n,discountedDailyPrice:o,totalPrice:c,platformFee:u}},D=a=>{if(ae.log("Comparing nft.userTag:",a.userTag,"with userTag:",g.value),!a.userTag||!g.value)return!1;const e=a.userTag.toLowerCase().trim(),t=g.value.toLowerCase().trim();return ae.log("Normalized comparison:",e,"===",t),e===t},_=a=>{if(k.value){if(D(a))return p.type="error",p.message="You cannot rent your own NFT",void(p.show=!0);c.value=a,u.value=null,o.value=!0,X(a)}},X=async a=>{if(a&&r[a.id])try{const e=await qa.A.post("/nft-rental/rent",{rentalId:a.id,days:r[a.id],renterWallet:w.A.getters.walletAddress},{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});u.value=e.data.rental}catch(e){ae.error("Error fetching rent transaction info:",e),p.type="error",p.message=`Failed to get rental information: ${e.response?.data?.error||e.message||"Unknown error"}`,p.show=!0}},S=()=>{"pending"!==v.value&&(o.value=!1,c.value=null,u.value=null,v.value=null,m.value=null,y.value=null)},M=()=>{v.value=null,m.value=null,y.value=null},K=async()=>{if(c.value&&r[c.value.id]&&u.value)try{e.value=!0,v.value=null,m.value=null,y.value=null;const t=await qa.A.post("/nft-rental/rent",{rentalId:c.value.id,days:r[c.value.id],renterWallet:w.A.getters.walletAddress},{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}}),{transaction:s}=t.data,l=Uint8Array.from(atob(s),(a=>a.charCodeAt(0))),n=Ga.Transaction.from(l);v.value="pending";try{const a=window.solana;if(!a)throw new Error("Phantom wallet not found");const e=await a.signAndSendTransaction(n);m.value=e.signature;await qa.A.post("/nft-rental/confirm",{rentalId:c.value.id,signature:e.signature,rentedBy:w.A.state.userTag,days:r[c.value.id]},{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});u.value&&(u.value.days=r[c.value.id]),v.value="success",setTimeout((async()=>{await w.A.dispatch("fetchRentalHistory")}),2e3),setTimeout((()=>{r[c.value.id]="",b()}),500)}catch(a){ae.error("Transaction error:",a),v.value="error",y.value=a.message||"Failed to sign or confirm transaction"}}catch(a){ae.error("Rent error:",a),v.value="error",y.value=a.response?.data?.error||a.message||"Failed to create rental transaction"}finally{e.value=!1}},x=a=>{d.value=d.value===a?null:a},I=(a,e)=>{r[a.id]=e,A(a),d.value=null};return(0,s.sV)((()=>{b(),t.value.forEach((a=>{r[a.id]||(r[a.id]=1,A(a))})),document.addEventListener("click",(a=>{null===d.value||a.target.closest(".custom-select")||(d.value=null)}))})),{loading:a,rentLoading:e,nfts:t,filteredNfts:L,searchQuery:l,maxPriceFilter:n,rentDays:r,discountInfo:i,showRentModal:o,selectedNft:c,currentRentalInfo:u,isAuthenticated:k,walletAddress:f,userTag:g,toast:p,refreshData:h,formatPrice:C,formatUserTag:R,getRentDaysOptions:E,getDiscountText:F,calculateEndDate:N,formatDate:P,selectedDaysChanged:A,rentNft:_,closeRentModal:S,confirmRent:K,isOwnNft:D,openDropdown:d,toggleDropdown:x,selectDays:I,retryRental:M,transactionStatus:v,transactionSignature:m,transactionError:y}}},te=t(71241);const se=(0,te.A)(ee,[["render",Ja],["__scopeId","data-v-5b95cba0"]]);var le=se;const ne={class:"my-listed-nfts"},re={key:0,class:"auth-message"},ie={key:1,class:"loading-container"},oe={key:2,class:"empty-state"},ce={key:3,class:"nft-grid"},ue={class:"nft-image-container"},de=["src","alt"],ve={class:"nft-info"},me={class:"nft-name"},ye={class:"nft-price"},pe={class:"price-amount"},ke={class:"nft-details"},fe={class:"detail-item"},ge={class:"detail-value"},Le={class:"detail-item"},be={key:0,class:"detail-item"},he={key:1,class:"detail-item"},Te={class:"detail-value"},Ce={class:"nft-actions"},we=["onClick"],Re=["onClick"],Ee=["onClick"],Fe={class:"modal-actions"},Ne=["disabled"],Pe={key:0,class:"loading-spinner small"},Ae={key:1},De={class:"form-group"},_e={class:"form-group"},Xe={class:"modal-actions"},Se=["disabled"],Me={key:0,class:"loading-spinner small"},Ke={key:1};function xe(a,e,t,n,r,i){const o=(0,s.g2)("router-link"),c=(0,s.g2)("AppToast");return(0,s.uX)(),(0,s.CE)(s.FK,null,[(0,s.Lk)("div",ne,[e[22]||(e[22]=(0,s.Lk)("h2",{class:"section-title"},"My Listed NFTs",-1)),n.isAuthenticated?n.loading?((0,s.uX)(),(0,s.CE)("div",ie,e[12]||(e[12]=[(0,s.Lk)("div",{class:"loading-spinner"},null,-1),(0,s.Lk)("p",null,"Loading your listed NFTs...",-1)]))):0===n.listedNfts.length?((0,s.uX)(),(0,s.CE)("div",oe,e[13]||(e[13]=[(0,s.Lk)("p",null,[(0,s.eW)("You haven't listed any NFTs for rent yet."),(0,s.Lk)("br"),(0,s.eW)("List an NFT for Rent")],-1)]))):((0,s.uX)(),(0,s.CE)("div",ce,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.listedNfts,(a=>((0,s.uX)(),(0,s.CE)("div",{key:a.id,class:"nft-card"},[(0,s.Lk)("div",ue,[(0,s.Lk)("img",{src:a.imageUrl||"/images/default-nft.png",alt:a.name,class:"nft-image"},null,8,de)]),(0,s.Lk)("div",ve,[(0,s.Lk)("h3",me,[(0,s.bF)(o,{to:`/nft/${a.nftMint}`},{default:(0,s.k6)((()=>[(0,s.eW)((0,l.v_)(a.name||"Unnamed NFT"),1)])),_:2},1032,["to"])]),(0,s.Lk)("div",ye,[e[14]||(e[14]=(0,s.Lk)("span",{class:"price-label"},"Daily Price:",-1)),(0,s.Lk)("span",pe,(0,l.v_)(n.formatPrice(a.dayPrice))+" SOL",1)]),(0,s.Lk)("div",ke,[(0,s.Lk)("div",fe,[e[15]||(e[15]=(0,s.Lk)("span",{class:"detail-label"},"Max Rental Period:",-1)),(0,s.Lk)("span",ge,(0,l.v_)(a.maxDays)+" days",1)]),(0,s.Lk)("div",Le,[e[16]||(e[16]=(0,s.Lk)("span",{class:"detail-label"},"Status:",-1)),(0,s.Lk)("span",{class:(0,l.C4)(["status-badge",n.getRentalStatusClass(a)])},(0,l.v_)(n.getRentalStatus(a)),3)]),a.rentedBy?((0,s.uX)(),(0,s.CE)("div",be,[e[17]||(e[17]=(0,s.Lk)("span",{class:"detail-label"},"Rented By:",-1)),(0,s.bF)(o,{to:`/player/${a.rentedBy}`,class:"detail-value"},{default:(0,s.k6)((()=>[(0,s.eW)((0,l.v_)(a.rentedBy),1)])),_:2},1032,["to"])])):(0,s.Q3)("",!0),a.rentalEndTime?((0,s.uX)(),(0,s.CE)("div",he,[e[18]||(e[18]=(0,s.Lk)("span",{class:"detail-label"},"Rental Ends:",-1)),(0,s.Lk)("span",Te,(0,l.v_)(n.formatDate(a.rentalEndTime)),1)])):(0,s.Q3)("",!0)]),(0,s.Lk)("div",Ce,[a.availableForRent?((0,s.uX)(),(0,s.CE)("button",{key:0,onClick:e=>n.openAvailabilityModal(a.id,!1),class:"close-rental-button"}," Close Rental ",8,we)):((0,s.uX)(),(0,s.CE)("button",{key:1,onClick:e=>n.openAvailabilityModal(a.id,!0),class:"open-rental-button"}," Open Rental ",8,Re)),(0,s.Lk)("button",{onClick:e=>n.openUpdateParametersModal(a),class:"update-parameters-button"}," Update Rental ",8,Ee)])])])))),128))])):((0,s.uX)(),(0,s.CE)("div",re,e[11]||(e[11]=[(0,s.Lk)("p",null,"Please connect your wallet to view your listed NFTs.",-1)]))),n.showAvailabilityModal?((0,s.uX)(),(0,s.CE)("div",{key:4,class:"modal-overlay",onClick:e[3]||(e[3]=(...a)=>n.closeAvailabilityModal&&n.closeAvailabilityModal(...a))},[(0,s.Lk)("div",{class:"modal-content",onClick:e[2]||(e[2]=(0,R.D$)((()=>{}),["stop"]))},[(0,s.Lk)("h3",null,(0,l.v_)(n.availabilityModalTitle),1),(0,s.Lk)("p",null,(0,l.v_)(n.availabilityModalMessage),1),(0,s.Lk)("div",Fe,[(0,s.Lk)("button",{onClick:e[0]||(e[0]=(...a)=>n.closeAvailabilityModal&&n.closeAvailabilityModal(...a)),class:"secondary-button"},"Cancel"),(0,s.Lk)("button",{onClick:e[1]||(e[1]=(...a)=>n.confirmAvailabilityChange&&n.confirmAvailabilityChange(...a)),disabled:n.availabilityLoading,class:(0,l.C4)(["primary-button",n.availabilityModalType])},[n.availabilityLoading?((0,s.uX)(),(0,s.CE)("span",Pe)):((0,s.uX)(),(0,s.CE)("span",Ae,(0,l.v_)(n.availabilityModalAction),1))],10,Ne)])])])):(0,s.Q3)("",!0),n.showUpdateParametersModal?((0,s.uX)(),(0,s.CE)("div",{key:5,class:"modal-overlay",onClick:e[9]||(e[9]=(...a)=>n.closeUpdateParametersModal&&n.closeUpdateParametersModal(...a))},[(0,s.Lk)("div",{class:"modal-content",onClick:e[8]||(e[8]=(0,R.D$)((()=>{}),["stop"]))},[e[21]||(e[21]=(0,s.Lk)("h3",null,"Update Rental Parameters",-1)),(0,s.Lk)("div",De,[e[19]||(e[19]=(0,s.Lk)("label",{for:"dayPrice"},"Daily Price (SOL)",-1)),(0,s.bo)((0,s.Lk)("input",{type:"number",id:"dayPrice","onUpdate:modelValue":e[4]||(e[4]=a=>n.updateParameters.dayPrice=a),min:"0.001",step:"0.001",class:"form-input"},null,512),[[R.Jo,n.updateParameters.dayPrice]])]),(0,s.Lk)("div",_e,[e[20]||(e[20]=(0,s.Lk)("label",{for:"maxDays"},"Maximum Rental Period (days)",-1)),(0,s.bo)((0,s.Lk)("input",{type:"number",id:"maxDays","onUpdate:modelValue":e[5]||(e[5]=a=>n.updateParameters.maxDays=a),min:"1",step:"1",class:"form-input"},null,512),[[R.Jo,n.updateParameters.maxDays]])]),(0,s.Lk)("div",Xe,[(0,s.Lk)("button",{onClick:e[6]||(e[6]=(...a)=>n.closeUpdateParametersModal&&n.closeUpdateParametersModal(...a)),class:"secondary-button"},"Cancel"),(0,s.Lk)("button",{onClick:e[7]||(e[7]=(...a)=>n.confirmUpdateParameters&&n.confirmUpdateParameters(...a)),disabled:n.updateParametersLoading,class:"primary-button update"},[n.updateParametersLoading?((0,s.uX)(),(0,s.CE)("span",Me)):((0,s.uX)(),(0,s.CE)("span",Ke,"Update Parameters"))],8,Se)])])])):(0,s.Q3)("",!0)]),(0,s.bF)(c,{show:n.toast.show,message:n.toast.message,type:n.toast.type,onClose:e[10]||(e[10]=a=>n.toast.show=!1),duration:n.toast.duration},null,8,["show","message","type","duration"])],64)}var Ie=t(4249),$e=t(94348),Ue={name:"MyListedNfts",components:{AppToast:Za.A},props:{wallet:{type:String,default:""},userTag:{type:String,default:""}},setup(a,{emit:e}){(0,Ie.Pj)();const t=(0,T.KR)(!0),l=(0,T.KR)([]),n=(0,T.Kh)({}),r=(0,T.KR)(!1),i=(0,T.KR)(null),o=(0,T.KR)(!1),c=(0,T.KR)(!1),u=(0,T.KR)(""),d=(0,T.KR)(""),v=(0,T.KR)(""),m=(0,T.KR)(""),y=(0,T.KR)(!1),p=(0,T.KR)(null),k=(0,T.KR)(null),f=(0,T.Kh)({show:!1,message:"",type:"info",duration:5e3}),g=(0,T.KR)(!1),L=(0,T.KR)({dayPrice:"",maxDays:""}),b=(0,T.KR)(!1),h=(0,T.KR)(null),C=(0,s.EW)((()=>!!a.wallet&&!!a.userTag)),w=async()=>{if(C.value)try{t.value=!0;const e=await qa.A.get(`/nft-rental/user/${a.userTag}`,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});l.value=e.data}catch(e){$e.error("Error fetching listed NFTs:",e),f.type="error",f.message="Failed to load your listed NFTs",f.show=!0}finally{t.value=!1}else l.value=[]},R=a=>parseFloat(a).toFixed(3),E=a=>{if(!a)return"";const e=new Date(a);return e.toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})},F=a=>!a.availableForRent&&a.rentedBy?"Rented":a.availableForRent?a.availableForRent?"Available":"Unavailable":"Paused",N=a=>!a.availableForRent&&a.rentedBy?"status-rented":a.availableForRent?a.availableForRent?"status-available":"status-unavailable":"status-paused",P=a=>{i.value=a,r.value=!0},A=()=>{r.value=!1,i.value=null},D=async()=>{if(i.value)try{o.value=!0,n[i.value.id]=!0,await qa.A.post("/nft-rental/cancel",{rentalId:i.value.id,userTag:a.userTag},{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}}),l.value=l.value.filter((a=>a.id!==i.value.id)),A()}catch(e){$e.error("Error cancelling rental listing:",e),f.type="error",f.message=`Failed to cancel listing: ${e.response?.data?.error||e.message||"Unknown error"}`,f.show=!0}finally{o.value=!1,i.value&&(n[i.value.id]=!1)}},_=async(a,e)=>{try{const t=await qa.A.put(`/nft-rental/listings/${a}/availability`,{available_for_rent:e?1:0},{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});if(t.data.success){const t=l.value.findIndex((e=>e.id===a));-1!==t&&(l.value[t].availableForRent=e?1:0)}}catch(t){$e.error("Error updating NFT availability:",t),f.type="error",f.message=t.response?.data?.error||"Failed to update NFT availability",f.show=!0}},X=(a,e)=>{p.value=a,k.value=e,e?(u.value="Open NFT for Rental",d.value="By opening this NFT for rental, it will become available for anyone to rent. Are you sure you want to proceed?",v.value="Open Rental",m.value="open"):(u.value="Close NFT Rental",d.value="By closing this NFT for rental, it will no longer be available for new rentals. If the NFT is currently rented, the current rental will continue until its end date. Are you sure you want to proceed?",v.value="Close Rental",m.value="close"),c.value=!0},S=()=>{c.value=!1,p.value=null,k.value=null,y.value=!1},M=async()=>{if(p.value&&null!==k.value)try{y.value=!0,await _(p.value,k.value),S()}catch(a){$e.error("Error confirming availability change:",a)}},K=a=>{h.value=a,L.value={dayPrice:a.dayPrice,maxDays:a.maxDays},g.value=!0},x=()=>{g.value=!1,h.value=null,L.value={dayPrice:"",maxDays:""},b.value=!1},I=async()=>{if(h.value)try{b.value=!0;const a=await qa.A.put(`/nft-rental/listings/${h.value.id}/parameters`,L.value,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});if(a.data.success){const a=l.value.findIndex((a=>a.id===h.value.id));-1!==a&&(l.value[a].dayPrice=L.value.dayPrice,l.value[a].maxDays=L.value.maxDays),x()}}catch(a){$e.error("Error updating rental parameters:",a),f.type="error",f.message=a.response?.data?.error||"Failed to update rental parameters",f.show=!0}finally{b.value=!1}};return(0,s.sV)((()=>{w()})),{loading:t,listedNfts:l,cancelLoading:n,showCancelModal:r,confirmCancelLoading:o,isAuthenticated:C,formatPrice:R,formatDate:E,getRentalStatus:F,getRentalStatusClass:N,cancelListing:P,closeCancelModal:A,confirmCancel:D,updateAvailability:_,showAvailabilityModal:c,availabilityModalTitle:u,availabilityModalMessage:d,availabilityModalAction:v,availabilityModalType:m,availabilityLoading:y,selectedNftId:p,selectedAvailability:k,openAvailabilityModal:X,closeAvailabilityModal:S,confirmAvailabilityChange:M,showUpdateParametersModal:g,updateParameters:L,toast:f,updateParametersLoading:b,selectedNftForUpdate:h,openUpdateParametersModal:K,closeUpdateParametersModal:x,confirmUpdateParameters:I}}};const We=(0,te.A)(Ue,[["render",xe],["__scopeId","data-v-06cf5ba9"]]);var Qe=We;const Oe={class:"my-rented-nfts"},Be={key:0,class:"auth-message"},Ve={key:1,class:"loading-container"},ze={key:2,class:"empty-state"},He={key:3,class:"nft-grid"},Ye={class:"nft-image-container"},je=["src","alt"],Je={class:"nft-info"},qe={class:"nft-name"},Ge={class:"nft-details"},Ze={class:"detail-item"},at={class:"detail-item"},et={class:"detail-value"},tt={class:"detail-item"},st={class:"detail-value"},lt={class:"transaction-info"},nt=["onClick"],rt={class:"nft-actions"};function it(a,e,t,n,r,i){const o=(0,s.g2)("router-link");return(0,s.uX)(),(0,s.CE)("div",Oe,[e[8]||(e[8]=(0,s.Lk)("h2",{class:"section-title"},"My Rented NFTs",-1)),n.isAuthenticated?n.loading?((0,s.uX)(),(0,s.CE)("div",Ve,e[2]||(e[2]=[(0,s.Lk)("div",{class:"loading-spinner"},null,-1),(0,s.Lk)("p",null,"Loading your rented NFTs...",-1)]))):0===n.rentedNfts.length?((0,s.uX)(),(0,s.CE)("div",ze,[e[3]||(e[3]=(0,s.Lk)("p",null,"You haven't rented any NFTs yet.",-1)),(0,s.Lk)("button",{onClick:e[0]||(e[0]=(...a)=>n.goToAvailableNfts&&n.goToAvailableNfts(...a)),class:"primary-button"},"Browse Available NFTs")])):((0,s.uX)(),(0,s.CE)("div",He,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.rentedNfts,(a=>((0,s.uX)(),(0,s.CE)("div",{key:a.id,class:"nft-card"},[(0,s.Lk)("div",Ye,[(0,s.Lk)("img",{src:a.imageUrl||"/images/default-nft.png",alt:a.name,class:"nft-image"},null,8,je),(0,s.Lk)("div",{class:(0,l.C4)(["time-remaining-badge",n.getTimeRemainingClass(a)])},(0,l.v_)(n.getTimeRemaining(a)),3)]),(0,s.Lk)("div",Je,[(0,s.Lk)("h3",qe,(0,l.v_)(a.name||"Unnamed NFT"),1),(0,s.Lk)("div",Ge,[(0,s.Lk)("div",Ze,[e[4]||(e[4]=(0,s.Lk)("span",{class:"detail-label"},"Owner:",-1)),(0,s.bF)(o,{to:`/player/${a.userTag}`,class:"detail-value"},{default:(0,s.k6)((()=>[(0,s.eW)((0,l.v_)(a.userTag),1)])),_:2},1032,["to"])]),(0,s.Lk)("div",at,[e[5]||(e[5]=(0,s.Lk)("span",{class:"detail-label"},"Daily Price:",-1)),(0,s.Lk)("span",et,(0,l.v_)(n.formatPrice(a.dayPrice))+" SOL",1)]),(0,s.Lk)("div",tt,[e[6]||(e[6]=(0,s.Lk)("span",{class:"detail-label"},"Rental End:",-1)),(0,s.Lk)("span",st,(0,l.v_)(n.formatDate(a.rentalEndTime)),1)])]),(0,s.Lk)("div",lt,[a.transactionSignature?((0,s.uX)(),(0,s.CE)("button",{key:0,onClick:e=>n.viewTransaction(a.transactionSignature),class:"view-tx-button"}," View Transaction ",8,nt)):(0,s.Q3)("",!0)]),(0,s.Lk)("div",rt,[(0,s.bF)(o,{to:`/nft/${a.mint}`,class:"view-details-button"},{default:(0,s.k6)((()=>e[7]||(e[7]=[(0,s.eW)(" View NFT Details ")]))),_:2},1032,["to"])])])])))),128))])):((0,s.uX)(),(0,s.CE)("div",Be,e[1]||(e[1]=[(0,s.Lk)("p",null,"Please connect your wallet to view your rented NFTs.",-1)])))])}var ot=t(94348),ct={name:"MyRentedNfts",props:{wallet:{type:String,default:""},userTag:{type:String,default:""}},setup(a){(0,Ie.Pj)(),(0,C.rd)();const e=(0,T.KR)(!0),t=(0,T.KR)([]),l=(0,s.EW)((()=>!!a.wallet&&!!a.userTag)),n=async()=>{if(l.value)try{e.value=!0;const s=await qa.A.get(`/nft-rental/rented-by/${a.userTag}`,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});t.value=s.data}catch(s){ot.error("Error fetching rented NFTs:",s)}finally{e.value=!1}else t.value=[]},r=a=>parseFloat(a).toFixed(3),i=a=>{if(!a)return"";const e=new Date(a);return e.toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})},o=a=>{const e=new Date,t=new Date(a.rentalEndTime),s=t-e;if(s<=0)return"Expired";const l=Math.floor(s/864e5),n=Math.floor(s%864e5/36e5);if(l>0)return`${l}d ${n}h left`;{const a=Math.floor(s%36e5/6e4);return`${n}h ${a}m left`}},c=a=>{const e=new Date,t=new Date(a.rentalEndTime),s=t-e;if(s<=0)return"expired";const l=Math.floor(s/864e5);return l<=1?"expiring-soon":"active"},u=a=>{const e=new Date,t=new Date(a.rentalEndTime),s=t-e;if(s<=0)return!1;const l=Math.floor(s/864e5);return l<=2},d=a=>{const e=`https://explorer.solana.com/tx/${a}`;window.open(e,"_blank")},v=()=>{window.dispatchEvent(new CustomEvent("switch-tab",{detail:"available"}))};return(0,s.sV)((()=>{n();const a=setInterval((()=>{t.value.length>0&&(t.value=[...t.value])}),6e4);return()=>{clearInterval(a)}})),{loading:e,rentedNfts:t,isAuthenticated:l,formatPrice:r,formatDate:i,getTimeRemaining:o,getTimeRemainingClass:c,isRentalExpiring:u,viewTransaction:d,goToAvailableNfts:v}}};const ut=(0,te.A)(ct,[["render",it],["__scopeId","data-v-51dfa89a"]]);var dt=ut;const vt={class:"rental-history"},mt={key:0,class:"loading-container"},yt={key:1,class:"empty-state"},pt={key:2,class:"rental-history-grid"},kt={class:"rental-card-header"},ft={class:"rental-price"},gt=["onClick"],Lt={class:"rental-card-body"},bt={class:"rental-detail-row"},ht={class:"rental-detail-row"},Tt={class:"rental-detail-row"},Ct={class:"detail-label"};function wt(a,e,t,n,r,i){const o=(0,s.g2)("router-link");return(0,s.uX)(),(0,s.CE)("div",vt,[e[7]||(e[7]=(0,s.Lk)("h2",{class:"section-title"},"Rental History",-1)),e[8]||(e[8]=(0,s.Lk)("p",{class:"section-subtitle"},"Last 20 rented NFTs",-1)),n.loading?((0,s.uX)(),(0,s.CE)("div",mt,e[0]||(e[0]=[(0,s.Lk)("div",{class:"loading-spinner"},null,-1),(0,s.Lk)("p",null,"Loading rental history...",-1)]))):0===n.nftRentalHistory.length?((0,s.uX)(),(0,s.CE)("div",yt,e[1]||(e[1]=[(0,s.Lk)("p",null,"No rental history available yet.",-1)]))):((0,s.uX)(),(0,s.CE)("div",pt,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.nftRentalHistory,(a=>((0,s.uX)(),(0,s.CE)("div",{key:a.id,class:"rental-card"},[(0,s.Lk)("div",kt,[(0,s.Lk)("div",ft,[e[2]||(e[2]=(0,s.Lk)("i",{class:"fas fa-coins"},null,-1)),(0,s.eW)(" "+(0,l.v_)(n.formatPrice(a.price))+" SOL ",1)]),a.transaction?((0,s.uX)(),(0,s.CE)("button",{key:0,onClick:e=>n.viewTransaction(a.transaction),class:"view-tx-button"},e[3]||(e[3]=[(0,s.Lk)("i",{class:"fas fa-receipt"},null,-1),(0,s.eW)(" TX ")]),8,gt)):(0,s.Q3)("",!0)]),(0,s.Lk)("div",Lt,[(0,s.Lk)("div",bt,[e[4]||(e[4]=(0,s.Lk)("span",{class:"detail-label"},[(0,s.Lk)("i",{class:"fas fa-image"}),(0,s.eW)(" NFT:")],-1)),(0,s.bF)(o,{to:`/nft/${a.mint}`,class:"nft-link"},{default:(0,s.k6)((()=>[(0,s.eW)((0,l.v_)(n.shortenAddress(a.mint)),1)])),_:2},1032,["to"])]),(0,s.Lk)("div",ht,[e[5]||(e[5]=(0,s.Lk)("span",{class:"detail-label"},[(0,s.Lk)("i",{class:"fas fa-user"}),(0,s.eW)(" Rented By:")],-1)),(0,s.bF)(o,{to:`/player/${a.rentedBy}`,class:"user-link"},{default:(0,s.k6)((()=>[(0,s.eW)((0,l.v_)(a.rentedBy),1)])),_:2},1032,["to"])]),(0,s.Lk)("div",Tt,[(0,s.Lk)("span",Ct,[e[6]||(e[6]=(0,s.Lk)("i",{class:"fas fa-calendar-day"},null,-1)),(0,s.eW)(" "+(0,l.v_)(n.formatDate(a.startDate))+" for "+(0,l.v_)(a.days)+" day(s)",1)])])])])))),128))]))])}var Rt=t(94348),Et={name:"RentalHistory",setup(){const a=(0,Ie.Pj)(),e=(0,T.KR)(!0),t=(0,s.EW)((()=>a.getters.nftRentalHistory)),l=async()=>{try{e.value=!0,await a.dispatch("fetchRentalHistory")}catch(t){Rt.error("Error fetching rental history:",t)}finally{e.value=!1}},n=a=>a?`${a.substring(0,4)}...${a.substring(a.length-4)}`:"-",r=a=>parseFloat(a).toFixed(3),i=a=>{if(!a)return"";const e=new Date(a);return e.toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})},o=a=>{const e=`https://explorer.solana.com/tx/${a}`;window.open(e,"_blank")};return(0,s.sV)((()=>{l()})),{loading:e,formatPrice:r,formatDate:i,shortenAddress:n,viewTransaction:o,nftRentalHistory:t}}};const Ft=(0,te.A)(Et,[["render",wt],["__scopeId","data-v-761c6c7f"]]);var Nt=Ft;const Pt={class:"list-nft-for-rent"},At={key:0,class:"auth-message"},Dt={key:1},_t={key:0,class:"loading-container"},Xt={key:1,class:"empty-state"},St={class:"empty-actions"},Mt={key:2},Kt={class:"nft-selection"},xt={class:"nft-grid"},It=["onClick"],$t={class:"nft-image-container"},Ut=["src","alt"],Wt={class:"nft-info"},Qt={class:"nft-name"},Ot={key:0,class:"rental-form"},Bt={class:"form-group"},Vt={key:0,class:"error-message"},zt={class:"form-group"},Ht={key:0,class:"error-message"},Yt={key:0,class:"discount-table"},jt={class:"discount-table-container"},Jt={key:1,class:"backend-error-message error-message"},qt={class:"buttons-container"},Gt=["disabled"],Zt={key:0,class:"loading-spinner small"},as={key:1};function es(a,e,t,n,r,i){const o=(0,s.g2)("router-link"),c=(0,s.g2)("AppToast");return(0,s.uX)(),(0,s.CE)(s.FK,null,[(0,s.Lk)("div",Pt,[e[19]||(e[19]=(0,s.Lk)("h2",{class:"section-title"},"List Your NFT for Rent",-1)),n.isAuthenticated?((0,s.uX)(),(0,s.CE)("div",Dt,[n.loading?((0,s.uX)(),(0,s.CE)("div",_t,e[6]||(e[6]=[(0,s.Lk)("div",{class:"loading-spinner"},null,-1),(0,s.Lk)("p",null,"Loading your NFTs...",-1)]))):0===n.userNfts.length?((0,s.uX)(),(0,s.CE)("div",Xt,[e[8]||(e[8]=(0,s.Lk)("p",null,"You don't have any NFTs to list for rent.",-1)),(0,s.Lk)("div",St,[(0,s.bF)(o,{to:"/nft-mint",class:"mint-btn"},{default:(0,s.k6)((()=>e[7]||(e[7]=[(0,s.eW)("Mint new NFT")]))),_:1})])])):((0,s.uX)(),(0,s.CE)("div",Mt,[(0,s.Lk)("div",Kt,[e[9]||(e[9]=(0,s.Lk)("label",{class:"section-label"},"1. Choose an NFT to list for rent",-1)),(0,s.Lk)("div",xt,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.userNfts,((a,e)=>((0,s.uX)(),(0,s.CE)("div",{key:e,class:(0,l.C4)(["nft-card",{selected:n.selectedNft&&n.selectedNft.createdAt===a.createdAt}]),onClick:e=>n.selectNft(a)},[(0,s.Lk)("div",$t,[(0,s.Lk)("img",{src:a.imageUri||"/images/default-nft.png",alt:a.name,class:"nft-image",loading:"lazy"},null,8,Ut)]),(0,s.Lk)("div",Wt,[(0,s.Lk)("h3",Qt,(0,l.v_)(a.name||"Unnamed NFT"),1)])],10,It)))),128))])]),n.selectedNft?((0,s.uX)(),(0,s.CE)("div",Ot,[e[17]||(e[17]=(0,s.Lk)("div",{class:"section-divider"},null,-1)),e[18]||(e[18]=(0,s.Lk)("label",{class:"section-label"},"2. Set rental details",-1)),(0,s.Lk)("div",Bt,[e[10]||(e[10]=(0,s.Lk)("label",{for:"day-price"},"Daily Price (SOL)",-1)),(0,s.bo)((0,s.Lk)("input",{id:"day-price","onUpdate:modelValue":e[0]||(e[0]=a=>n.dayPrice=a),type:"number",min:"0.001",step:"0.001",placeholder:"Daily rental price in SOL",class:"input-field"},null,512),[[R.Jo,n.dayPrice]]),n.priceError?((0,s.uX)(),(0,s.CE)("div",Vt,(0,l.v_)(n.priceError),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("div",zt,[e[11]||(e[11]=(0,s.Lk)("label",{for:"max-days"},"Maximum Rental Period (days)",-1)),(0,s.bo)((0,s.Lk)("input",{id:"max-days","onUpdate:modelValue":e[1]||(e[1]=a=>n.maxDays=a),type:"number",min:"1",max:"7",placeholder:"Maximum rental period in days",class:"input-field"},null,512),[[R.Jo,n.maxDays]]),e[12]||(e[12]=(0,s.Lk)("small",{class:"helper-text"},"Maximum allowed rental period is 7 days",-1)),n.daysError?((0,s.uX)(),(0,s.CE)("div",Ht,(0,l.v_)(n.daysError),1)):(0,s.Q3)("",!0)]),n.dayPrice&&n.maxDays&&!n.priceError&&!n.daysError?((0,s.uX)(),(0,s.CE)("div",Yt,[e[14]||(e[14]=(0,s.Lk)("h4",{class:"discount-table-title"},"Rental Discount Rates",-1)),e[15]||(e[15]=(0,s.Lk)("p",{class:"discount-table-description"},"Longer rental periods offer discounts to encourage extended use:",-1)),(0,s.Lk)("div",jt,[(0,s.Lk)("table",null,[e[13]||(e[13]=(0,s.Lk)("thead",null,[(0,s.Lk)("tr",null,[(0,s.Lk)("th",null,"Days"),(0,s.Lk)("th",null,"Discount"),(0,s.Lk)("th",null,"Daily Price"),(0,s.Lk)("th",null,"Total")])],-1)),(0,s.Lk)("tbody",null,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.discountTable,((a,e)=>((0,s.uX)(),(0,s.CE)("tr",{key:e,class:(0,l.C4)({highlight:a.days===parseInt(n.maxDays)})},[(0,s.Lk)("td",null,(0,l.v_)(a.days),1),(0,s.Lk)("td",null,(0,l.v_)(a.discountPercent)+"%",1),(0,s.Lk)("td",null,(0,l.v_)(n.formatPrice(a.discountedDailyPrice))+" SOL",1),(0,s.Lk)("td",null,(0,l.v_)(n.formatPrice(a.totalPrice))+" SOL",1)],2)))),128))])])]),e[16]||(e[16]=(0,s.Lk)("p",{class:"platform-fee-note"},"Note: A 5% platform fee will be charged to the tenant at time of rental.",-1))])):(0,s.Q3)("",!0),n.backendError?((0,s.uX)(),(0,s.CE)("div",Jt,[(0,s.Lk)("p",null,"Error: "+(0,l.v_)(n.backendError),1)])):(0,s.Q3)("",!0),(0,s.Lk)("div",qt,[(0,s.Lk)("button",{onClick:e[2]||(e[2]=(...a)=>n.cancelSelection&&n.cancelSelection(...a)),class:"cancel-button"}," Cancel "),(0,s.Lk)("button",{onClick:e[3]||(e[3]=(...a)=>n.listNftForRent&&n.listNftForRent(...a)),class:"list-button",disabled:n.listLoading||!n.isFormValid},[n.listLoading?((0,s.uX)(),(0,s.CE)("span",Zt)):((0,s.uX)(),(0,s.CE)("span",as,"List NFT for Rent"))],8,Gt)])])):(0,s.Q3)("",!0)]))])):((0,s.uX)(),(0,s.CE)("div",At,e[5]||(e[5]=[(0,s.Lk)("p",null,"Please connect your wallet to list NFTs for rent.",-1)])))]),(0,s.bF)(c,{show:n.toast.show,message:n.toast.message,type:n.toast.type,onClose:e[4]||(e[4]=a=>n.toast.show=!1),duration:n.toast.duration},null,8,["show","message","type","duration"])],64)}t(44114);var ts=t(94348),ss={name:"ListNftForRent",components:{AppToast:Za.A},props:{wallet:{type:String,default:""},userTag:{type:String,default:""}},emits:["nft-listed"],setup(a,{emit:e}){(0,Ie.Pj)();const t=(0,T.KR)(!0),l=(0,T.KR)(!1),n=(0,T.KR)([]),r=(0,T.KR)(null),i=(0,T.KR)("0.1"),o=(0,T.KR)(7),c=(0,T.Kh)({show:!1,message:"",type:"info",duration:5e3}),u=(0,T.KR)(""),d=(0,T.KR)(""),v=(0,T.KR)(""),m=(0,s.EW)((()=>!!a.wallet&&!!a.userTag)),y=(0,s.EW)((()=>!u.value&&!d.value&&i.value&&parseFloat(i.value)>0&&o.value&&parseInt(o.value)>0)),p=()=>{u.value="";const a=parseFloat(i.value);return isNaN(a)?(u.value="Please enter a valid price",!1):a<=0?(u.value="Price must be greater than 0",!1):!(a<.001)||(u.value="Minimum price is 0.001 SOL",!1)},k=()=>{d.value="";const a=parseInt(o.value);return isNaN(a)?(d.value="Please enter a valid number of days",!1):a<=0?(d.value="Rental period must be at least 1 day",!1):!(a>7)||(d.value="Maximum rental period is 7 days",!1)},f=(0,s.EW)((()=>{if(!i.value||parseFloat(i.value)<=0)return[];const a={1:0,2:5,3:10,4:15,5:18,6:22,7:25},e=[],t=parseFloat(i.value),s=parseInt(o.value)||7,l=Math.min(s,7);for(let n=1;n<=l;n++){const s=a[n]||0,l=(100-s)/100,r=t*l,i=r*n;e.push({days:n,discountPercent:s,discountedDailyPrice:r,totalPrice:i})}return e})),g=async()=>{if(!m.value)return n.value=[],void(t.value=!1);try{t.value=!0,ts.log("Fetching user NFTs...");const a=await qa.A.get("/nft-rental/nfts",{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});ts.log("NFT response:",a.data),a.data?a.data.success?(n.value=a.data.nfts||[],ts.log(`Loaded ${n.value.length} NFTs`)):(ts.error("Error in NFT response:",a.data.error||"Unknown error"),c.type="error",c.message=a.data.error||"Failed to load your NFTs",c.show=!0,n.value=[]):(ts.error("No data in NFT response"),n.value=[])}catch(a){ts.error("Error fetching user NFTs:",a),c.type="error",c.message=a.response?.data?.error||"Failed to load your NFTs",c.show=!0,n.value=[]}finally{t.value=!1}},L=a=>{r.value=a,p(),k()},b=()=>{r.value=null,i.value="0.1",o.value=7,u.value="",d.value="",v.value=""},h=async()=>{if(!r.value||!m.value)return;const t=p(),s=k();if(t&&s)try{v.value="",l.value=!0;const t={userTag:a.userTag,nftMint:r.value.assetPublicKey,dayPrice:parseFloat(i.value),maxDays:parseInt(o.value),wallet:a.wallet},s=await qa.A.post("/nft-rental/create",t,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});s.data&&s.data.discounts&&ts.log("Discounts from server:",s.data.discounts),c.type="success",c.message="Your NFT has been listed for rent successfully!",c.show=!0,b(),await g(),e("nft-listed")}catch(n){ts.error("Error listing NFT for rent:",n.response.data.error),v.value=n.response.data.error||"Failed to list NFT",c.type="error",c.message=`Failed to list NFT: ${v.value}`,c.show=!0}finally{l.value=!1}};(0,s.sV)((()=>{g()}));const C=a=>parseFloat(a).toFixed(3);return{loading:t,listLoading:l,userNfts:n,selectedNft:r,dayPrice:i,maxDays:o,priceError:u,daysError:d,discountTable:f,isAuthenticated:m,isFormValid:y,selectNft:L,cancelSelection:b,listNftForRent:h,formatPrice:C,backendError:v,toast:c}}};const ls=(0,te.A)(ss,[["render",es],["__scopeId","data-v-5d06295b"]]);var ns=ls,rs={name:"NftRentalPage",components:{AvailableNfts:le,MyListedNfts:Qe,MyRentedNfts:dt,RentalHistory:Nt,ListNftForRent:ns},setup(){(0,C.rd)();const a=(0,T.KR)("available"),e=(0,s.EW)((()=>{const a=[{id:"available",label:"Available NFTs"},{id:"my-listed",label:"My Listed NFTs"},{id:"my-rented",label:"My Rented NFTs"}];return a}));(0,s.sV)((()=>{w.A.getters.isAuthenticated||"available"===a.value||(a.value="available"),window.addEventListener("switch-tab",(e=>{a.value=e.detail}))})),(0,s.hi)((()=>{window.removeEventListener("switch-tab",(e=>{a.value=e.detail}))}));const t=()=>{a.value="my-listed"},l=(0,s.EW)((()=>w.A.getters.userTag||"")),n=(0,s.EW)((()=>w.A.getters.walletAddress||"")),r=(0,T.KR)(null),i=a=>{r.value={title:"Аренда успешна",message:`NFT успешно арендован до ${new Date(a.rentalEndTime).toLocaleDateString()}`,isLoading:!1,error:null}};return{currentTab:a,tabs:e,handleNftListed:t,userTag:l,walletPublicKey:n,transactionStatus:r,handleRentalSuccess:i}}};const is=(0,te.A)(rs,[["render",h],["__scopeId","data-v-5cf4eb5e"]]);var os=is}}]);
//# sourceMappingURL=6875.eb905751.js.map